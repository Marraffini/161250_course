{
  "hash": "d56c51ea018de689e3bc0cb07eec015f",
  "result": {
    "markdown": "---\ntitle: \"Chapter 4 Workshop\"\n---\n\n::: {.cell}\n\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n\n\n# Elephants\n\n## Load the data\n\nLoad a dataset on elephants.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nele <- read_table(\n  \"https://www.massey.ac.nz/~anhsmith/data/elephant.txt\"\n  ) |> \n  rename(\"Height\" = `Shoulder.height`) # renames the variable\n\nstr(ele)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nspc_tbl_ [312 x 3] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\n $ Sex   : chr [1:312] \"F\" \"F\" \"F\" \"F\" ...\n $ Age   : num [1:312] 0 0 0 0 0 0 0 0 1 1 ...\n $ Height: num [1:312] 79 83 86 90 91 93 96 102 94 96 ...\n - attr(*, \"spec\")=\n  .. cols(\n  ..   Sex = col_character(),\n  ..   Age = col_double(),\n  ..   Shoulder.height = col_double()\n  .. )\n```\n:::\n:::\n\n\n\nThere are three variables: \n\n- `Sex`: M or F\n- `Age`: in years\n- `Height`: shoulder height in cm\n\n\n## Explore the distribution of heights\n\nExamine the distribution of the heights.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(ele) + \n  aes(x = Height) +\n  geom_histogram(\n    aes(y = after_stat(density)) # this aes goes here because \n                                 # it only applies to geom_histogram\n    ) + \n  geom_density()\n```\n\n::: {.cell-output-display}\n![](ws04_files/figure-pdf/unnamed-chunk-4-1.pdf){fig-align='center' fig-pos='H' width=50%}\n:::\n:::\n\n\n\nDoes that look normally distributed to you? Is it symmetrical and bell-shaped?\n\nWe can test whether these data conform to a normal distribution model with a Shipiro-Wilk test for normality. The null hypothesis is that the data came from a population that is normal. \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nshapiro.test(ele$Height)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tShapiro-Wilk normality test\n\ndata:  ele$Height\nW = 0.96785, p-value = 2.043e-06\n```\n:::\n:::\n\n\n\nThe very low p-value says that we can reject the null hypothesis, and conclude that these data are very unlikely to have come from a normal distribution. \n\nThe data have both male and female elephants, so we should probably look at the sexes separately. \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(ele) + \n   aes(x = Height) +\n   geom_histogram(\n     aes(y = after_stat(density)) # this aes goes here because \n                                  # it only applies to geom_histogram\n     ) + \n   geom_density() + \n   facet_grid( ~ Sex)\n```\n\n::: {.cell-output-display}\n![](ws04_files/figure-pdf/unnamed-chunk-6-1.pdf){fig-align='center' fig-pos='H' width=50%}\n:::\n\n```{.r .cell-code}\nggplot(ele) + \n  aes(x = Height, fill = Sex, colour = Sex) +\n  geom_density(alpha = .3)\n```\n\n::: {.cell-output-display}\n![](ws04_files/figure-pdf/unnamed-chunk-6-2.pdf){fig-align='center' fig-pos='H' width=50%}\n:::\n:::\n\n\n\nIt doesn't look like there's a major difference between the sexes in terms of the distribution of heights. Males might be a bit more variable than females (seeing the thicker tails).\n\nHave a look at the values of age.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(ele) + aes(Age) + geom_bar()\n```\n\n::: {.cell-output-display}\n![](ws04_files/figure-pdf/unnamed-chunk-7-1.pdf){fig-align='center' fig-pos='H' width=50%}\n:::\n:::\n\n\n\nThere is a wide range of ages, from 0 to 15 years old. Many elephants (49, to be exact) are 0 or 1 year old. Are the data normal if we remove these? We'll first make a new copy of the data with the baby elephants removed and then repeat our tests for normality.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nele2 <- ele |> filter(Age > 1) # make new dataset with babies removed\n\nggplot(ele2) +\n  aes(x = Height) +\n   geom_histogram(\n     aes(y = after_stat(density)) \n                                  \n     ) + \n   geom_density() \n```\n\n::: {.cell-output-display}\n![](ws04_files/figure-pdf/unnamed-chunk-8-1.pdf){fig-align='center' fig-pos='H' width=50%}\n:::\n:::\n\n\n\nThat looks a bit more normal. \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nshapiro.test(ele2$Height)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tShapiro-Wilk normality test\n\ndata:  ele2$Height\nW = 0.99394, p-value = 0.3726\n```\n:::\n:::\n\n\n\nOf elephants 2 years or older, there is no evidence that the heights do not come from a normal distribution (W = 1.0, p = 0.37). So, the heights of non-baby elephants appear approximately normally distributed.\n\n## Confidence interval for the sample\n\nLet's now estimate the population mean (with a 95% confidence interval) of `Heights` in the dataset with the baby elephants removed.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nt.test(ele2$Height)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tOne Sample t-test\n\ndata:  ele2$Height\nt = 101.24, df = 262, p-value < 2.2e-16\nalternative hypothesis: true mean is not equal to 0\n95 percent confidence interval:\n 178.0425 185.1058\nsample estimates:\nmean of x \n 181.5741 \n```\n:::\n:::\n\n\n\n\nThe `t.test()` function is very flexible. When given a single sample, it will provide the mean and 95% confidence interval. How would you interpret this confidence interval? \n\nIt also provides a test of whether the mean of the sample is significantly different from zero. If the *p*-value is less than 0.05, then we can say that there is evidence against the null hypothesis of a mean of zero. Now, in this case, of course this isn't useful. Elephants can never have zero or negative height, so a mean height of zero is nonsensical. \n\nNote that we can extract the estimate of the population mean and its confidence interval in the following way.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nt.test(ele2$Height)$estimate\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nmean of x \n 181.5741 \n```\n:::\n\n```{.r .cell-code}\nt.test(ele2$Height)$conf.int\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 178.0425 185.1058\nattr(,\"conf.level\")\n[1] 0.95\n```\n:::\n:::\n\n\nHow was this confidence interval calculated? \n\nThe standard error (the standard deviation over multiple samples) for a sample mean can be estimated by $s / \\sqrt n$, where $s$ is the sample standard deviation and $n$ is the sample size.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nn = length(ele2$Height)\ns = sd(ele2$Height)\n\n( se = s / sqrt(n) )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1.793566\n```\n:::\n:::\n\n\n\nOnce you have estimated the standard error, a confidence interval for a sample mean $\\bar x$ is simply\n\n$$ \n\\bar x \\pm t \\times \\text{se}\n$$\n\nThe $t$ value is the 0.975 quantile of the $t$ distribution with the degrees of freedom given by $n-1$. \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nqt(p = 0.975, df = n - 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1.96906\n```\n:::\n:::\n\n\n\nSo, the sample mean and confidence interval is:\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n( xbar <- mean(ele2$Height) )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 181.5741\n```\n:::\n\n```{.r .cell-code}\n( xbar - qt(p = 0.975, df = n - 1) * se )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 178.0425\n```\n:::\n\n```{.r .cell-code}\n( xbar + qt(p = 0.975, df = n - 1) * se )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 185.1058\n```\n:::\n:::\n\n\n\n## t-test for difference of two sample means\n\nLet's say we are interested in testing whether the mean heights of male and female elephants are different. First, we can test for differences in the variances in the two sexes using Levene's test, which is an important assumption of the t-test. In other words, if the assumption is violated, the results of the test may be misleading.\n\nLet's do the Levene's test.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncar::leveneTest(Height ~ Sex, data = ele2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLevene's Test for Homogeneity of Variance (center = median)\n       Df F value Pr(>F)\ngroup   1  2.6478 0.1049\n      261               \n```\n:::\n:::\n\n\n\nA p-value of 0.1 is not huge, but it's not enough evidence to reject the null hypothesis that the variance of male heights is equal to the variance of female heights (at the 5% level).\n\nThe default option for a t-test using the `t.test()` function is to *not* assume equal variances. \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nt.test(formula = Height ~ Sex, data = ele2) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tWelch Two Sample t-test\n\ndata:  Height by Sex\nt = -1.3991, df = 251.38, p-value = 0.163\nalternative hypothesis: true difference in means between group F and group M is not equal to 0\n95 percent confidence interval:\n -12.111371   2.050723\nsample estimates:\nmean in group F mean in group M \n       179.1259        184.1562 \n```\n:::\n:::\n\n\n\nBy this test, there is no strong evidence against the null hypothesis that the mean heights of male and female elephants are equal. \n\nWelch Test does not assume equal variances. If we wanted to make this assumption (and therefore get more power):\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nt.test(formula = Height ~ Sex, var.equal = T,  data = ele2) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tTwo Sample t-test\n\ndata:  Height by Sex\nt = -1.4044, df = 261, p-value = 0.1614\nalternative hypothesis: true difference in means between group F and group M is not equal to 0\n95 percent confidence interval:\n -12.083154   2.022506\nsample estimates:\nmean in group F mean in group M \n       179.1259        184.1562 \n```\n:::\n:::\n\n\n\nThe result is essentially the same in this case. \n\n\n# Dataset **`Prestige`**\n\nWe will again be using a well-known dataset called `Prestige` from the `car`\tR package.  This dataset deals with prestige ratings of Canadian Occupations. The `Prestige` dataset has 102 rows and 6 columns. The observations are occupations.\n\nThis data frame contains the following columns:\n\n* **`education`** - Average education of occupational incumbents, years, in 1971.\n\n* **`income`** - Average income of incumbents, dollars, in 1971.\n\n* **`women`** - Percentage of incumbents who are women.\n\n*  **`prestige`** - Pineo-Porter prestige score for occupation, from a social survey conducted in the mid-1960s.\n\n* **`census`** - Canadian Census occupational code.\n\n*  **`type`** - Type of occupation. A factor with levels: `bc`, Blue Collar; `prof`, Professional, Managerial, and Technical; `wc`, White Collar. (includes four missing values).\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\n\n\n## One-sample t-tests\n\nPerform a one-sample t-test to test the hypothesis that the true mean `prestige` is exactly 50.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(car)\ndata(Prestige)\n\n# Alternative hyp: greater or less than 50\nt.test(Prestige$prestige, mu=50)\n\n# Alternative hyp: greater than 50\nt.test(Prestige$prestige, mu=50, alternative=\"greater\")\n```\n:::\n\n\n\nTest whether the true mean `prestige` score for professionals is 50% more than the true mean `prestige` score for white collar occupations. \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprof.data <- Prestige |> \n  filter(type==\"prof\") |> \n  pull(prestige)\n\nwc.data <- Prestige |> \n  filter(type==\"wc\") |> \n  pull(prestige) \n\nt.test(prof.data, \n       wc.data, \n       mu = 0.5 * mean(wc.data),\n       alternative = 'greater')\n```\n:::\n\n\n\n## Skewness\n\nExplore the skewness in the `income` variable using a boxplot. \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nPrestige |> \n  ggplot() +\n  aes(income) + \n  geom_boxplot() \n```\n\n```{.r .cell-code}\n# or\nboxplot(Prestige$income, horizontal = TRUE)\n```\n:::\n\n\n\n## Transformation\n\nFind a suitable power transformation to correct the skewness. \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(lindia)\n\ngg_boxcox(lm(income ~ 1, data = Prestige))\n```\n:::\n\n\n\n## Confidence interval\n\nCompute the 95% confidence interval for the true mean income using the raw and log-transformed data.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nt.test(Prestige$income)\nt.test(log(Prestige$income))\n```\n:::\n\n\n\n\n\nMore R code examples are  [here](../exercises/Chap4more.R)",
    "supporting": [
      "ws04_files\\figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}