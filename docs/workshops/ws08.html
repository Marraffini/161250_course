<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>161250 Data Analysis - Chapter 8 Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../workshops/ws07.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">161250 Data Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../slides.html" rel="" target="">
 <span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../studyguide/index.html" rel="" target="">
 <span class="menu-text">Study Guide</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../workshops/ws01.html" rel="" target="" aria-current="page">
 <span class="menu-text">Workshops</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-extra-code" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Extra Code</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-extra-code">    
        <li>
    <a class="dropdown-item" href="../exercises/Chap2more.R" rel="" target="">
 <span class="dropdown-text">Ex2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap3more.R" rel="" target="">
 <span class="dropdown-text">Ex3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap4more.R" rel="" target="">
 <span class="dropdown-text">Ex4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap5more.R" rel="" target="">
 <span class="dropdown-text">Ex5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap6more.R" rel="" target="">
 <span class="dropdown-text">Ex6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap7more.R" rel="" target="">
 <span class="dropdown-text">Ex7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap8more.R" rel="" target="">
 <span class="dropdown-text">Ex8</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../workshops/ws08.html">Chapter 8 Workshop</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started With R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 2 Workshop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 3 Workshop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 4 Workshop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 5 Workshop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 6 Workshop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 7 Workshop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workshops/ws08.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Chapter 8 Workshop</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#insect-sprays-analysis-of-variance" id="toc-insect-sprays-analysis-of-variance" class="nav-link active" data-scroll-target="#insect-sprays-analysis-of-variance">Insect Sprays – Analysis of Variance</a>
  <ul class="collapse">
  <li><a href="#load-and-look-at-the-data" id="toc-load-and-look-at-the-data" class="nav-link" data-scroll-target="#load-and-look-at-the-data">Load and look at the data</a></li>
  <li><a href="#plotting-the-data" id="toc-plotting-the-data" class="nav-link" data-scroll-target="#plotting-the-data">Plotting the data</a></li>
  <li><a href="#fitting-an-anova-model" id="toc-fitting-an-anova-model" class="nav-link" data-scroll-target="#fitting-an-anova-model">Fitting an ANOVA model</a></li>
  <li><a href="#examining-the-assumptions-of-anova" id="toc-examining-the-assumptions-of-anova" class="nav-link" data-scroll-target="#examining-the-assumptions-of-anova">Examining the assumptions of ANOVA</a></li>
  <li><a href="#anova-for-transformed-counts" id="toc-anova-for-transformed-counts" class="nav-link" data-scroll-target="#anova-for-transformed-counts">ANOVA for transformed counts</a></li>
  <li><a href="#fitting-an-anova-to-the-transformed-data" id="toc-fitting-an-anova-to-the-transformed-data" class="nav-link" data-scroll-target="#fitting-an-anova-to-the-transformed-data">Fitting an ANOVA to the transformed data</a></li>
  <li><a href="#post-hoc-multiple-comparisons" id="toc-post-hoc-multiple-comparisons" class="nav-link" data-scroll-target="#post-hoc-multiple-comparisons">Post-hoc multiple comparisons</a></li>
  </ul></li>
  <li><a href="#goats-analysis-of-covariance" id="toc-goats-analysis-of-covariance" class="nav-link" data-scroll-target="#goats-analysis-of-covariance">Goats – Analysis of <strong>Co</strong>variance</a>
  <ul class="collapse">
  <li><a href="#load-the-data" id="toc-load-the-data" class="nav-link" data-scroll-target="#load-the-data">Load the data</a></li>
  <li><a href="#fitting-treatment-only" id="toc-fitting-treatment-only" class="nav-link" data-scroll-target="#fitting-treatment-only">Fitting treatment only</a></li>
  <li><a href="#fitting-initial-weight-only" id="toc-fitting-initial-weight-only" class="nav-link" data-scroll-target="#fitting-initial-weight-only">Fitting Initial Weight only</a></li>
  <li><a href="#fitting-both-anova" id="toc-fitting-both-anova" class="nav-link" data-scroll-target="#fitting-both-anova">Fitting both… ANOVA!</a></li>
  <li><a href="#plotting-the-model" id="toc-plotting-the-model" class="nav-link" data-scroll-target="#plotting-the-model">Plotting the model</a></li>
  </ul></li>
  <li><a href="#dataset-alfalfa" id="toc-dataset-alfalfa" class="nav-link" data-scroll-target="#dataset-alfalfa">Dataset <strong><code>alfalfa</code></strong></a>
  <ul class="collapse">
  <li><a href="#exercise-8.1" id="toc-exercise-8.1" class="nav-link" data-scroll-target="#exercise-8.1">Exercise 8.1</a></li>
  <li><a href="#exercise-8.2" id="toc-exercise-8.2" class="nav-link" data-scroll-target="#exercise-8.2">Exercise 8.2</a></li>
  <li><a href="#exercise-8.3" id="toc-exercise-8.3" class="nav-link" data-scroll-target="#exercise-8.3">Exercise 8.3</a></li>
  <li><a href="#exercise-8.4" id="toc-exercise-8.4" class="nav-link" data-scroll-target="#exercise-8.4">Exercise 8.4</a></li>
  <li><a href="#exercise-8.5" id="toc-exercise-8.5" class="nav-link" data-scroll-target="#exercise-8.5">Exercise 8.5</a></li>
  <li><a href="#exercise-8.6" id="toc-exercise-8.6" class="nav-link" data-scroll-target="#exercise-8.6">Exercise 8.6</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="ws08.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Chapter 8 Workshop</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="insect-sprays-analysis-of-variance" class="level1">
<h1>Insect Sprays – Analysis of Variance</h1>
<p>For this ANOVA tutorial, we will use the <code>InsectSprays</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> dataset provided in R, which gives the results of an experiment that examined the effects of six types of insecticide spray on the numbers of insects.</p>
<section id="load-and-look-at-the-data" class="level2">
<h2 class="anchored" data-anchor-id="load-and-look-at-the-data">Load and look at the data</h2>
<p>Load and examine the dataset.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(InsectSprays)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(InsectSprays)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   72 obs. of  2 variables:
 $ count: num  10 7 20 14 14 12 10 23 17 20 ...
 $ spray: Factor w/ 6 levels "A","B","C","D",..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(InsectSprays)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  count spray
1    10     A
2     7     A
3    20     A
4    14     A
5    14     A
6    12     A</code></pre>
</div>
</div>
<p>You can read a bit about it here: <code>help(InsectSprays)</code>.</p>
<p>There are two variables. <code>count</code> is the response variable and represents the number of insects found in a plot, and <code>spray</code> is the predictor variable which indicates the type of insecticide used. Modelling a quantitative response variable with a categorical factor should make you immediately think of ANOVA!</p>
<p>Let’s give the dataset a shorter name, so we don’t have to write out InsectSprays whenever we want to use it.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>IS <span class="ot">=</span> InsectSprays</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check the number of replicates (data points) for each group.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(IS<span class="sc">$</span>spray)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 A  B  C  D  E  F 
12 12 12 12 12 12 </code></pre>
</div>
</div>
<p>This shows that there are 12 replicates in each group. Because n is the same for each level, we can say that this is a balanced design.</p>
</section>
<section id="plotting-the-data" class="level2">
<h2 class="anchored" data-anchor-id="plotting-the-data">Plotting the data</h2>
<p>Let’s plot the data using a boxplot.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> spray) <span class="sc">+</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>What are your first impressions? Does it look like there is much difference among the groups?</p>
<p>Boxplots are useful, but for small datasets it can be revealing to plot the actual data.</p>
<p>We can use a dotplot with violins.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dvp <span class="ot">&lt;-</span> IS <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> spray) <span class="sc">+</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="dv">0</span>, <span class="at">height =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>dvp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Do you think the dot/violinplot is more or less informative than the boxplot?</p>
<p>Analysis of variance compares the variation among groups (group means from the overall mean) with the variation within groups (data points from their group means). Recall that, while useful, boxplots do not actually show us the means. So, to help with our visual impression of these data in the context of ANOVA, we’ll now add the means to the dotplot.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>meanIS <span class="ot">&lt;-</span> IS <span class="sc">|&gt;</span> <span class="fu">group_by</span>(spray) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">mean</span>(count))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>dvp <span class="sc">+</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> meanIS,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"darkorange"</span> ,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="st">"|"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">8</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Though I do like boxplots, I think this is probably a more useful and revealing plot in this case, especially since we’re about to do an ANOVA, which tests for differences among means.</p>
</section>
<section id="fitting-an-anova-model" class="level2">
<h2 class="anchored" data-anchor-id="fitting-an-anova-model">Fitting an ANOVA model</h2>
<p>An ANOVA model is fit in R using the function <code>aov()</code>. There is a function <code>anova()</code>, but this instead can be used to produce an ANOVA table from an existing model.</p>
<p>Let’s do it.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data =</span> IS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
   aov(formula = count ~ spray, data = IS)

Terms:
                   spray Residuals
Sum of Squares  2668.833  1015.167
Deg. of Freedom        5        66

Residual standard error: 3.921902
Estimated effects may be unbalanced</code></pre>
</div>
</div>
<p>This shows the among-groups (<code>spray</code>) and within-groups (<code>Residuals</code>) sum of squares, and degrees of freedom. The <code>Residual standard error</code> is the square root of the error variance (<span class="math inline">\(\sigma_\varepsilon^2\)</span>). It is the expected (average) absolute deviation from the individual data points to their respective group means. If required, you can remind yourself what these values represent from the lecture slides.</p>
<p>We can get the full ANOVA table by commanding a <code>summary()</code> of an <code>aov</code> object. (Note, a very similar output can be achieved by applying the <code>anova()</code> function to an <code>aov</code> object.)</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)    
spray        5   2669   533.8    34.7 &lt;2e-16 ***
Residuals   66   1015    15.4                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The full ANOVA table also gives us the Mean Squares (the SS divided by their respective df), the F value (the ratio of the within-to-among-groups Mean Squares), and the P-value.</p>
<p>The null hypothesis tested here is that there is no difference between the group means in the population.</p>
<p><span class="math display">\[H_0 : \mu_1 = \mu_2 = ... = \mu_g\]</span></p>
<p>The alternative hypothesis is that at least one of the groups is different to the others.</p>
<p>Remember that we assume that we have taken a sample of data at random from a population. The P-value is the proportion of equivalent samples in which we would obtain the observed test statistic or greater <strong>if the null hypothesis is true</strong> (i.e.&nbsp;no difference among groups). In other words, how likely is it that the observed differences among means have occurred just through chance? Here, the F ratio is high and P-value is tiny (&lt; 0.0000000000000002). So, there is extremely strong evidence against the null hypothesis and we can conclude that there is indeed a difference among the group means—plants subjected to different types of spray have, on average, different numbers of insects on them.</p>
<p>This, in itself, is not immensely informative. Naturally, we wish to examine which groups (spray types) are different from one another.</p>
<p>But, first, we need to examine our assumptions.</p>
</section>
<section id="examining-the-assumptions-of-anova" class="level2">
<h2 class="anchored" data-anchor-id="examining-the-assumptions-of-anova">Examining the assumptions of ANOVA</h2>
<p>Like for regression, diagnostic plots are the first step for examining how well the assumptions of ANOVA are met by our model. If these assumptions are not met, then the F-ratio might not behave as it should (i.e.&nbsp;follow an F-distribution) with repeated sampling under a true null hypothesis.</p>
<p>Those assumptions are:</p>
<ol type="1">
<li>Appropriateness of an additive linear model</li>
<li>Independent errors</li>
<li>Normally distributed errors</li>
<li>Homogeneity of errors</li>
</ol>
<p>We will focus on 3 and 4 because 1 and 2 cannot really be checked at this stage of the analysis.</p>
<p>Let’s make the plots.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data=</span>IS))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-11-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-11-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There is cause for concern here. As is often the case with counts, there seems to be some heteroscedasticity in the residuals. That is, the residual variance does not appear constant, but rather increases with the fitted value. In an ANOVA context, this means that the groups with high means have greater within-group variation. Let’s have a look at the standard deviations of the groups.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> <span class="fu">group_by</span>(spray) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">sd =</span> <span class="fu">sd</span>(count))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  spray    sd
  &lt;fct&gt; &lt;dbl&gt;
1 A      4.72
2 B      4.27
3 C      1.98
4 D      2.50
5 E      1.73
6 F      6.21</code></pre>
</div>
</div>
<p>Indeed, there is a huge difference between the largest and smallest standard deviation (roughly 3.5-fold).</p>
<p>We can use a Levene’s test to explicitly test for evidence of heterogeneous variances. The function <code>leveneTest()</code> in the <code>car</code> package does this. Remember, the null hypothesis is that the average absolute deviations are the same in all groups.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">leveneTest</span>(<span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data=</span>IS))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Levene's Test for Homogeneity of Variance (center = median)
      Df F value   Pr(&gt;F)   
group  5  3.8214 0.004223 **
      66                    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The low P-value here indicates that the null hypothesis is rejected and our suspicions were correct—there are significant differences in the variations among groups.</p>
<p>The assumption of normality also seems suspect here, according to the fact that many data do not fall along the dotted line in the Q-Q plot. This is probably part of the same problem.</p>
<p>We can try transforming the response variable <code>count</code> and see if that helps.</p>
</section>
<section id="anova-for-transformed-counts" class="level2">
<h2 class="anchored" data-anchor-id="anova-for-transformed-counts">ANOVA for transformed counts</h2>
<p>We will try a log(x+1) transformation. We add the constant 1 because there are some (two) zeros in the dataset.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(IS<span class="sc">$</span>count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 0  1  2  3  4  5  6  7  9 10 11 12 13 14 15 16 17 19 20 21 22 23 24 26 
 2  6  4  8  4  7  3  3  1  3  3  2  4  4  2  2  4  1  2  2  1  1  1  2 </code></pre>
</div>
</div>
<p>Let’s test the assumption for the transformed data.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">lcount  =</span> <span class="fu">log</span>(count<span class="sc">+</span><span class="dv">1</span>) </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aov</span>(<span class="at">formula =</span> lcount <span class="sc">~</span> spray) <span class="sc">|&gt;</span> </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">leveneTest</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Levene's Test for Homogeneity of Variance (center = median)
      Df F value Pr(&gt;F)
group  5  1.8821 0.1093
      66               </code></pre>
</div>
</div>
<p>The test is now non-significant, but 0.1 is still a fairly small P-value. Looking at the following boxplot, it seems like the log transformation might be too severe—the groups with smaller means now seem to have higher variance than those with larger means.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">lcount  =</span> <span class="fu">log</span>(count<span class="sc">+</span><span class="dv">1</span>) </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lcount, <span class="at">y =</span> spray) <span class="sc">|&gt;</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now try instead a square-root transformation.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">sqrt_count  =</span> <span class="fu">sqrt</span>(count) </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aov</span>(<span class="at">formula =</span> sqrt_count <span class="sc">~</span> spray) <span class="sc">|&gt;</span> </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">leveneTest</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Levene's Test for Homogeneity of Variance (center = median)
      Df F value Pr(&gt;F)
group  5  0.8836 0.4971
      66               </code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a> <span class="at">sqrt_count  =</span> <span class="fu">sqrt</span>(count) </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> sqrt_count, <span class="at">y =</span> spray) <span class="sc">|&gt;</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This looks like a better transformation for this model.</p>
</section>
<section id="fitting-an-anova-to-the-transformed-data" class="level2">
<h2 class="anchored" data-anchor-id="fitting-an-anova-to-the-transformed-data">Fitting an ANOVA to the transformed data</h2>
<p>Fit the model.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>IS <span class="ot">&lt;-</span> IS <span class="sc">|&gt;</span> <span class="fu">mutate</span>( <span class="at">sqrt_count  =</span> <span class="fu">sqrt</span>(count) )</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(sqrt_count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)    
spray        5  88.44  17.688    44.8 &lt;2e-16 ***
Residuals   66  26.06   0.395                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Now show up the diagnostic plots for this model.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(sqrt_count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-20-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-20-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Much better!</p>
<p>This clearly has not made a substantial impact on the result of the hypothesis test for a difference among group means, but we can be happier that the inference is correct.</p>
<p>Now let’s look at the differences among groups.</p>
</section>
<section id="post-hoc-multiple-comparisons" class="level2">
<h2 class="anchored" data-anchor-id="post-hoc-multiple-comparisons">Post-hoc multiple comparisons</h2>
<p>Tukey’s Honest Significant Differences (HSD) are a method of adjusting for the fact that, in a post-hoc analysis such as this, there are simultaneously hypothesis tests being done. Across all these tests, the probability of erroneously finding a significant difference (i.e.&nbsp;making a Type I error) is greater than the nominated alpha value (usually 0.05). The HSD method makes each individual test slightly more conservative so that the family-wise error rate across all tests is conserved.</p>
<p>Tukey’s HSD can be implemented in R as follows.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(sqrt_count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">TukeyHSD</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = sqrt_count ~ spray, data = IS)

$spray
          diff        lwr        upr     p adj
B-A  0.1159530 -0.6369601  0.8688661 0.9975245
C-A -2.5158217 -3.2687349 -1.7629086 0.0000000
D-A -1.5963245 -2.3492377 -0.8434114 0.0000006
E-A -1.9512174 -2.7041305 -1.1983042 0.0000000
F-A  0.2579388 -0.4949744  1.0108519 0.9144964
C-B -2.6317747 -3.3846879 -1.8788616 0.0000000
D-B -1.7122775 -2.4651907 -0.9593644 0.0000001
E-B -2.0671704 -2.8200835 -1.3142572 0.0000000
F-B  0.1419858 -0.6109274  0.8948989 0.9935788
D-C  0.9194972  0.1665841  1.6724103 0.0080813
E-C  0.5646043 -0.1883088  1.3175175 0.2512638
F-C  2.7737605  2.0208474  3.5266736 0.0000000
E-D -0.3548928 -1.1078060  0.3980203 0.7366389
F-D  1.8542633  1.1013502  2.6071764 0.0000000
F-E  2.2091561  1.4562430  2.9620693 0.0000000</code></pre>
</div>
</div>
<p>This table above has each possible pairwise comparison of groups. The number of comparisons is <span class="math inline">\(g(g – 1)/2 = 15\)</span> (where <span class="math inline">\(g\)</span> = the number of groups = 6).</p>
<p>For each pairwise comparison, the table gives the estimated difference (<code>diff</code>), the lower (<code>lwr</code>) and upper (<code>upr</code>) confidence intervals and the p-value (<code>p adj</code>) which tests whether the difference is statistically significant. The confidence intervals and the p-value are adjusted for the fact that multiple simultaneous comparisons are being made, and so are more conservative than if they were done separately. Out of the 15 comparisons, 10 have very low p-values.</p>
<p>Here are the intervals shown on a plot.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(sqrt_count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">TukeyHSD</span>() <span class="sc">|&gt;</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">las=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This plot provides a visual impression of the size and adjusted confidence intervals for each comparison. An interval that includes zero indicates that the difference between those groups is non-significant (i.e.&nbsp;the null hypothesis of no difference is retained). This was the case for <code>B-A</code>, <code>F-A</code>, <code>F-B</code>, <code>E-C</code>, and <code>E-D</code>. From the earlier plots, this makes sense. <code>A-B-F</code> seem to be quite similar, as do <code>E-C-D</code>.</p>
</section>
</section>
<section id="goats-analysis-of-covariance" class="level1">
<h1>Goats – Analysis of <strong>Co</strong>variance</h1>
<p>Here, we will use a dataset<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> containing the weights of 40 goats before and after an experiment where 20 were given a standard drenching treatment and 20 were given a more intensive drenching treatment. There are three columns corresponding to the treatment (<code>Tmt</code>), the gain in weight over the experiment (<code>WtGain</code>, kg), and the initial weight at the start of the experiment (<code>InitialWt</code>, kg).</p>
<p><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> Source: Saville DJ, Wood GR (1991) <em>Statistical Methods: The Geometric Approach</em>. Springer, New York.</p>
<section id="load-the-data" class="level2">
<h2 class="anchored" data-anchor-id="load-the-data">Load the data</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>goat <span class="ot">&lt;-</span> <span class="fu">read_table</span>(<span class="st">"https://www.massey.ac.nz/~anhsmith/data/goats.txt"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(goat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [40 × 3] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ Tmt      : chr [1:40] "standard" "standard" "standard" "standard" ...
 $ WtGain   : num [1:40] 5 3 8 7 6 4 8 6 7 5 ...
 $ InitialWt: num [1:40] 21 24 21 22 23 26 22 23 24 20 ...
 - attr(*, "spec")=
  .. cols(
  ..   Tmt = col_character(),
  ..   WtGain = col_double(),
  ..   InitialWt = col_double()
  .. )</code></pre>
</div>
</div>
<p>The initial weight is included because of commonly observed biological phenomenon known as “regression to the norm”, where lighter animals even the ledger by gaining more weight than the heavier animals. By using an ANCOVA model that incorporates the initial weight as a covariate can therefore give us more power to detect an effect of the treatment.</p>
</section>
<section id="fitting-treatment-only" class="level2">
<h2 class="anchored" data-anchor-id="fitting-treatment-only">Fitting treatment only</h2>
<p>Let’s start with a boxplot of the response variable by reference to the predictor of interest, treatment.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>goat <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> WtGain, <span class="at">y =</span> Tmt) <span class="sc">+</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There seems to be a reasonable effect of treatment. This is apparent in an ANOVA fitted without the covariate.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> Tmt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)  
Tmt          1   16.9  16.900    4.13 0.0492 *
Residuals   38  155.5   4.092                 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Sure enough, effect of the treatment is significant, though it is marginally so. The effect size can be viewed in a linear model summary.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(WtGain <span class="sc">~</span> Tmt, <span class="at">data=</span>goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = WtGain ~ Tmt, data = goat)

Residuals:
   Min     1Q Median     3Q    Max 
 -3.85  -1.55   0.15   1.15   4.45 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   6.8500     0.4523  15.144   &lt;2e-16 ***
Tmtstandard  -1.3000     0.6397  -2.032   0.0492 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.023 on 38 degrees of freedom
Multiple R-squared:  0.09803,   Adjusted R-squared:  0.07429 
F-statistic:  4.13 on 1 and 38 DF,  p-value: 0.04916</code></pre>
</div>
</div>
<p>From here, we can see that the estimated difference between the treatments is 1.3 kg—the mean for intensive is 6.85 kg and the mean for standard is 5.55 kg.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>goat <span class="sc">|&gt;</span> <span class="fu">group_by</span>(Tmt) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(WtGain))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  Tmt        mean
  &lt;chr&gt;     &lt;dbl&gt;
1 intensive  6.85
2 standard   5.55</code></pre>
</div>
</div>
<p>The fitted model explains only 10% of the variation in the data. The average difference between the fitted means and the observations is 2.023, which is greater than the estimated difference in means. So, all in all, there is a significant effect but it is not large. We can estimate a 95% confidence interval for this difference using <span class="math inline">\(\hat d + t_{df,[0.025,0.975]} \times \text{SE}(\hat d)\)</span>.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">1.3</span> <span class="sc">+</span> <span class="fu">qt</span>(<span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>), <span class="dv">38</span>) <span class="sc">*</span> <span class="fl">0.6397</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2.595004947 -0.004995053</code></pre>
</div>
</div>
<p>So, the confidence interval for the difference is {0.005 , 2.595}.</p>
</section>
<section id="fitting-initial-weight-only" class="level2">
<h2 class="anchored" data-anchor-id="fitting-initial-weight-only">Fitting Initial Weight only</h2>
<p>Now we will look at the effect of the covariate, <code>InitialWt</code>.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>goat <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> InitialWt, <span class="at">y =</span> WtGain) <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that there is a relationship between the initial weight of the goats and the gain in weight, in that the goats that were lighter at the start of the experiment gained more weight.</p>
<p>Look at a linear model using this predictor alone.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(WtGain <span class="sc">~</span> InitialWt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = WtGain ~ InitialWt, data = goat)

Residuals:
   Min     1Q Median     3Q    Max 
-3.607 -1.206  0.163  1.054  3.871 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 14.39581    1.85047   7.780 2.22e-09 ***
InitialWt   -0.35403    0.07906  -4.478 6.68e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.723 on 38 degrees of freedom
Multiple R-squared:  0.3454,    Adjusted R-squared:  0.3282 
F-statistic: 20.05 on 1 and 38 DF,  p-value: 6.681e-05</code></pre>
</div>
</div>
<p>For every extra kilogram of weight at the start, the goat is expected to gain 354 g less over the course of the experiment. The effect is highly significant, and explains 35% of the variation in weight gain. We are not interested in this effect though, per se, because it has been demonstrated many times before. We are most interested in the effect of the treatment.</p>
</section>
<section id="fitting-both-anova" class="level2">
<h2 class="anchored" data-anchor-id="fitting-both-anova">Fitting both… ANOVA!</h2>
<p>Now we will look at the effect of the <code>Tmt</code> in the context of the covariate, <code>InitialWt.</code></p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>ggoat <span class="ot">&lt;-</span> goat <span class="sc">|&gt;</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> InitialWt, <span class="at">y =</span> WtGain, <span class="at">colour =</span> Tmt) <span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">4</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>ggoat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This shows the effects of both predictors simultaneously. We can envisage two lines on this graph—one through the Intensive points and one through the Standard points. The difference in the heights of these lines is the effect of treatment, the slope of the lines is the effect of the initial weight, and any difference in the slopes of the lines is the interaction between the two predictors.</p>
<p>Now fit a model including both these predictors simultaneously, including any interaction.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">*</span> Tmt, <span class="at">data=</span>goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              Df Sum Sq Mean Sq F value  Pr(&gt;F)    
InitialWt      1  59.55   59.55  22.211 3.6e-05 ***
Tmt            1  16.00   16.00   5.966  0.0196 *  
InitialWt:Tmt  1   0.34    0.34   0.128  0.7230    
Residuals     36  96.51    2.68                    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The first thing is to check for a significant interaction. There is not, so we can assume that there is no difference in the slope of the lines for Intensive and Standard treatments. Thus, there is no evidence that the effect of the initial weight varies among the two treatments, or that the treatment effect varies according to the initial weight.</p>
<p>Applying the <code>drop1()</code> function supports that the more parsimonious model is that without the interaction.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">*</span> Tmt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">drop1</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Single term deletions

Model:
WtGain ~ InitialWt * Tmt
              Df Sum of Sq    RSS    AIC
&lt;none&gt;                     96.514 43.232
InitialWt:Tmt  1   0.34225 96.857 41.374</code></pre>
</div>
</div>
<p>Now we can confidently fit the model with just the two main effects.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">+</span> Tmt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value   Pr(&gt;F)    
InitialWt    1  59.55   59.55   22.75 2.87e-05 ***
Tmt          1  16.00   16.00    6.11   0.0182 *  
Residuals   37  96.86    2.62                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>I have put the treatment in the model after the initial weight, so we effectively obtain the Type II sum of squares for treatment, i.e., the variation that is attributable to treatment only, after all the variation attributable to initial weight has been accounted for. This provides a more conservative test for our effect of interest. It matters little in this case, however. Review the table for when treatment alone is fit.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> Tmt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)  
Tmt          1   16.9  16.900    4.13 0.0492 *
Residuals   38  155.5   4.092                 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The SS for treatment has decreased only slightly from the inclusion of initial weight, from 16.9 to 16.0.</p>
<p>More importantly, though, the F-ratio has increased by 50% and the P-value has decreased from 0.05 to 0.02! Just from including another (potentially competing) predictor in the model! Take a moment to consider how this might have happened.</p>
<p>The key here is the decrease in the residual SS from 156 to 97. The F-ratio is calculated from the treatment SS divided by the residual SS. Therefore, if you decrease the residual SS, you can increase the value of F. By attributing variation to a covariate, it is no longer considered to be part of the random, unexplained variation. Our ability to detect an effect of the treatment is therefore strengthened.</p>
<p>This is also apparent in the linear model summary.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">+</span> Tmt, <span class="at">data=</span>goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = WtGain ~ InitialWt + Tmt, data = goat)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.9716 -1.2419 -0.0338  0.9878  3.2231 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 14.96661    1.75261   8.540 2.82e-10 ***
InitialWt   -0.35137    0.07424  -4.733 3.21e-05 ***
Tmtstandard -1.26486    0.51169  -2.472   0.0182 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.618 on 37 degrees of freedom
Multiple R-squared:  0.4382,    Adjusted R-squared:  0.4078 
F-statistic: 14.43 on 2 and 37 DF,  p-value: 2.331e-05</code></pre>
</div>
</div>
<p>While the estimated effect of the treatment has reduced from a difference of 1.30 to 1.26, the standard error has reduced from 0.64 to 0.51. We can recalculate the confidence interval for the difference (we remove a degree of freedom for the fact that we are also estimating a regression slope).</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">1.26</span> <span class="sc">+</span> <span class="fu">qt</span>(<span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>),<span class="dv">37</span>) <span class="sc">*</span> <span class="fl">0.51169</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2.2967824 -0.2232176</code></pre>
</div>
</div>
<p>The interval for the difference {0.223 , 2.297} is quite a bit smaller than the one obtained earlier when fitting treatment alone {0.005 , 2.595}, and no longer brushes so close to zero.</p>
</section>
<section id="plotting-the-model" class="level2">
<h2 class="anchored" data-anchor-id="plotting-the-model">Plotting the model</h2>
<p>We can get <code>ggplot</code> to fit two linear models (one for each treatment) on our scatterplot.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>ggoat <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>However, notice that the slopes are different. In our model, the slopes are the same, because it doesn’t have an interaction between <code>InitialWt</code> and <code>Tmt</code>. This is where the <code>visreg</code> package is very useful!</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visreg)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">+</span> Tmt, <span class="at">data=</span>goat) <span class="sc">|&gt;</span> </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visreg</span>(<span class="at">xvar =</span> <span class="st">"InitialWt"</span>, <span class="at">by =</span> <span class="st">"Tmt"</span>, <span class="at">overlay =</span> <span class="cn">TRUE</span>, <span class="at">gg =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="dataset-alfalfa" class="level1">
<h1>Dataset <strong><code>alfalfa</code></strong></h1>
<p>This dataset is from the R package <code>faraway</code>. The alfalfa dataset frame has 25 rows and 4 columns. Data comes from an experiment to test the effects of seed inoculum, irrigation and shade on alfalfa yield.</p>
<p>This data frame contains the following columns:</p>
<p><code>shade</code> - Distance of location from tree line divided into 5 shade areas</p>
<p><code>irrigation</code> - Irrigation effect divided into 5 levels</p>
<p><code>inoculum</code> - Four types of seed incolum, A-D with E as control</p>
<p><code>yield</code> - Dry matter yield of alfalfa</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(alfalfa, <span class="at">package =</span> <span class="st">"faraway"</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(alfalfa, <span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="exercise-8.1" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-8.1">Exercise 8.1</h2>
<p>Obtain the main effects and interaction plots.</p>
<p>Old style Main effects plots:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(yield <span class="sc">~</span> shade <span class="sc">+</span> irrigation <span class="sc">+</span> inoculum, </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>alfalfa)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">allEffects</span>(mod1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Old style Interaction effects plots:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">aov</span>(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  yield <span class="sc">~</span> shade<span class="sc">*</span>irrigation<span class="sc">*</span>inoculum <span class="sc">-</span> shade<span class="sc">:</span>irrigation<span class="sc">:</span>inoculum, </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> alfalfa</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> shade <span class="sc">*</span> irrigation, <span class="at">data =</span> alfalfa) </span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="fu">effect</span>(<span class="st">'shade:irrigation'</span>, </span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">mod =</span> mod1) <span class="sc">|&gt;</span> </span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">multiline =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> shade <span class="sc">*</span> inoculum, <span class="at">data =</span> alfalfa) </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">effect</span>(<span class="st">'shade:inoculum'</span>,</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">mod=</span>mod2) <span class="sc">|&gt;</span> </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">multiline=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> irrigation <span class="sc">*</span> inoculum, <span class="at">data =</span> alfalfa) </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">effect</span>(<span class="st">'irrigation:inoculum'</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">mod=</span>mod3) <span class="sc">|&gt;</span> </span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">multiline=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><code>ggplot2</code> can produce good main effects and interaction plots but the R codes for this task are not short. For main effects plot-</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span> </span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> shade, <span class="at">y =</span> yield) <span class="sc">+</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effect of shade"</span>)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> irrigation, <span class="at">y =</span> yield) <span class="sc">+</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effect of irrigation"</span>)</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>plot3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> inoculum, <span class="at">y =</span> yield) <span class="sc">+</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effect of inoculum"</span>)</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>plot1<span class="sc">+</span>plot2<span class="sc">+</span>plot3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For interaction plot-</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Interactions Plot</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>plot4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> shade, <span class="at">y =</span> yield, </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> irrigation, <span class="at">colour =</span> irrigation) <span class="sc">+</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"point"</span>)<span class="sc">+</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"line"</span>)<span class="sc">+</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"shade*irrigation interaction"</span>)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>plot5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> inoculum, <span class="at">y =</span> yield,</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> irrigation, <span class="at">colour =</span> irrigation) <span class="sc">+</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"point"</span>)<span class="sc">+</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"line"</span>)<span class="sc">+</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"inoculum*irrigation interaction"</span>)</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>plot6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> shade, <span class="at">y =</span> yield, </span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> inoculum, <span class="at">colour =</span> inoculum) <span class="sc">+</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"point"</span>)<span class="sc">+</span></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"line"</span>)<span class="sc">+</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"shade*inoculum interaction"</span>)</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>plot4 <span class="sc">/</span> plot5 <span class="sc">/</span> plot6</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exercise-8.2" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-8.2">Exercise 8.2</h2>
<p>Fit one-way ANOVA models to this dataset.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>anova1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(yield <span class="sc">~</span> shade, <span class="at">data =</span> alfalfa)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova1)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>anova2 <span class="ot">&lt;-</span> <span class="fu">aov</span>(yield <span class="sc">~</span> irrigation, <span class="at">data =</span> alfalfa)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova2)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>anova3 <span class="ot">&lt;-</span> <span class="fu">aov</span>(yield <span class="sc">~</span> inoculum, <span class="at">data =</span> alfalfa)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova3)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">TukeyHSD</span>(anova1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">TukeyHSD</span>(anova2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">TukeyHSD</span>(anova3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exercise-8.3" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-8.3">Exercise 8.3</h2>
<p>Fit a three-factor (additive) ANOVA model without interactions.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>anova1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(yield <span class="sc">~</span> shade <span class="sc">+</span> irrigation <span class="sc">+</span> inoculum,</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> alfalfa)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova1)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(anova1, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For the base R style four diagnostic plots, use <code>plot(anova1)</code> and set the <code>par</code>.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(anova1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ws08_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="exercise-8.4" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-8.4">Exercise 8.4</h2>
<p>Fit the indicator variable regression model of <code>yield ~ inoculum</code></p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>alfalfa <span class="ot">&lt;-</span> alfalfa <span class="sc">|&gt;</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">I.A =</span> <span class="fu">as.numeric</span>(inoculum<span class="sc">==</span><span class="st">"A"</span>),</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">I.B =</span> <span class="fu">as.numeric</span>(inoculum<span class="sc">==</span><span class="st">"B"</span>),</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">I.C =</span> <span class="fu">as.numeric</span>(inoculum<span class="sc">==</span><span class="st">"C"</span>),</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">I.D =</span> <span class="fu">as.numeric</span>(inoculum<span class="sc">==</span><span class="st">"D"</span>)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>indicator.reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> I.A <span class="sc">+</span> I.B <span class="sc">+</span> I.C <span class="sc">+</span> I.D, </span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> alfalfa)</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(indicator.reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note that this regression allows the treatments to be compared with the control.</p>
</section>
<section id="exercise-8.5" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-8.5">Exercise 8.5</h2>
<p><code>shade</code> is a categorical variable of factor codes but let us (incorrectly) treat it as numerical (and if the actual distances are given, then the <code>distance</code> variable becomes a covariate). Fit ANCOVA of yield on the <code>inoculum</code> factor and <code>shade</code> covariate.</p>
<p><strong>R:</strong></p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>ancova.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> <span class="fu">as.numeric</span>(shade) <span class="sc">*</span> inoculum, </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> alfalfa)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ancova.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exercise-8.6" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="exercise-8.6">Exercise 8.6</h2>
<p>In a two-factor experiment, one of the factors was assigned to main plot (main-plot factor), the second factor, called the subplot factor, was assigned into subplots. The dataset <code>https://www.massey.ac.nz/~kgovinda/data/plots.RData</code> gives the experimental set up. Perform the ANOVA for this basic split-plot experiment.</p>
<p><strong>R:</strong></p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>url1 <span class="ot">&lt;-</span> <span class="st">"https://www.massey.ac.nz/~anhsmith/data/plots.RData"</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> url1, <span class="at">destfile =</span> <span class="st">"plots.RData"</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"plots.RData"</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>plots</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>sp.model <span class="ot">&lt;-</span> <span class="fu">aov</span>(yield <span class="sc">~</span> block <span class="sc">+</span> A<span class="sc">*</span>B <span class="sc">+</span> <span class="fu">Error</span>(block<span class="sc">/</span>A),</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>plots)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sp.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Incorrect model</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">aov</span>(yield <span class="sc">~</span> block <span class="sc">+</span> A<span class="sc">*</span>B ,</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>plots))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>More R code examples are <a href="../exercises/Chap8more.R">here</a></li>
</ul>


<!-- -->

</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Data originally sourced from Beall, G. 1942. <em>The transformation of data from entomological field experiments</em>. Biometrika 32:243.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Data originally sourced from Beall, G. 1942. <em>The transformation of data from entomological field experiments</em>. Biometrika 32:243.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Data originally sourced from Beall, G. 1942. <em>The transformation of data from entomological field experiments</em>. Biometrika 32:243.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../workshops/ws07.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Chapter 7 Workshop</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb81" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Chapter 8 Workshop"</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, message=FALSE}</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">comment=</span><span class="cn">NA</span>)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="fu"># Insect Sprays – Analysis of Variance</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>For this ANOVA tutorial, we will use the <span class="in">`InsectSprays`</span><span class="ot">[^1]</span> dataset provided in R, which gives the results of an experiment that examined the effects of six types of insecticide spray on the numbers of insects.  </span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span>Data originally sourced from Beall, G. 1942. *The transformation of data from entomological field experiments*. Biometrika 32:243.</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load and look at the data</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>Load and examine the dataset.</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(InsectSprays)</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(InsectSprays)</span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(InsectSprays)</span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a>You can read a bit about it here: <span class="in">`help(InsectSprays)`</span>.</span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>There are two variables. <span class="in">`count`</span> is the response variable and represents the number of insects found in a plot, and <span class="in">`spray`</span> is the predictor variable which indicates the type of insecticide used. Modelling a quantitative response variable with a categorical factor should make you immediately think of ANOVA!</span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a>Let’s give the dataset a shorter name, so we don’t have to write out InsectSprays whenever we want to use it.</span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a>IS <span class="ot">=</span> InsectSprays</span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a>Check the number of replicates (data points) for each group. </span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-51"><a href="#cb81-51" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(IS<span class="sc">$</span>spray)</span>
<span id="cb81-52"><a href="#cb81-52" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-53"><a href="#cb81-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-54"><a href="#cb81-54" aria-hidden="true" tabindex="-1"></a>This shows that there are 12 replicates in each group. Because n is the same for each level, we can say that this is a balanced design.</span>
<span id="cb81-55"><a href="#cb81-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-56"><a href="#cb81-56" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plotting the data</span></span>
<span id="cb81-57"><a href="#cb81-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-58"><a href="#cb81-58" aria-hidden="true" tabindex="-1"></a>Let’s plot the data using a boxplot.</span>
<span id="cb81-59"><a href="#cb81-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-62"><a href="#cb81-62" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-63"><a href="#cb81-63" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb81-64"><a href="#cb81-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb81-65"><a href="#cb81-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> spray) <span class="sc">+</span> </span>
<span id="cb81-66"><a href="#cb81-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb81-67"><a href="#cb81-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-68"><a href="#cb81-68" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-69"><a href="#cb81-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-70"><a href="#cb81-70" aria-hidden="true" tabindex="-1"></a>What are your first impressions? Does it look like there is much difference among the groups? </span>
<span id="cb81-71"><a href="#cb81-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-72"><a href="#cb81-72" aria-hidden="true" tabindex="-1"></a>Boxplots are useful, but for small datasets it can be revealing to plot the actual data.</span>
<span id="cb81-73"><a href="#cb81-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-74"><a href="#cb81-74" aria-hidden="true" tabindex="-1"></a>We can use a dotplot with violins.</span>
<span id="cb81-75"><a href="#cb81-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-78"><a href="#cb81-78" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-79"><a href="#cb81-79" aria-hidden="true" tabindex="-1"></a>dvp <span class="ot">&lt;-</span> IS <span class="sc">|&gt;</span> </span>
<span id="cb81-80"><a href="#cb81-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb81-81"><a href="#cb81-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> spray) <span class="sc">+</span> </span>
<span id="cb81-82"><a href="#cb81-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb81-83"><a href="#cb81-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="dv">0</span>, <span class="at">height =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> .<span class="dv">5</span>)</span>
<span id="cb81-84"><a href="#cb81-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-85"><a href="#cb81-85" aria-hidden="true" tabindex="-1"></a>dvp</span>
<span id="cb81-86"><a href="#cb81-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-87"><a href="#cb81-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-88"><a href="#cb81-88" aria-hidden="true" tabindex="-1"></a>Do you think the dot/violinplot is more or less informative than the boxplot?</span>
<span id="cb81-89"><a href="#cb81-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-90"><a href="#cb81-90" aria-hidden="true" tabindex="-1"></a>Analysis of variance compares the variation among groups (group means from the overall mean) with the variation within groups (data points from their group means). Recall that, while useful, boxplots do not actually show us the means. So, to help with our visual impression of these data in the context of ANOVA, we’ll now add the means to the dotplot. </span>
<span id="cb81-91"><a href="#cb81-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-92"><a href="#cb81-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-93"><a href="#cb81-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-96"><a href="#cb81-96" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-97"><a href="#cb81-97" aria-hidden="true" tabindex="-1"></a>meanIS <span class="ot">&lt;-</span> IS <span class="sc">|&gt;</span> <span class="fu">group_by</span>(spray) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">mean</span>(count))</span>
<span id="cb81-98"><a href="#cb81-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-99"><a href="#cb81-99" aria-hidden="true" tabindex="-1"></a>dvp <span class="sc">+</span> </span>
<span id="cb81-100"><a href="#cb81-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb81-101"><a href="#cb81-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> meanIS,</span>
<span id="cb81-102"><a href="#cb81-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"darkorange"</span> ,</span>
<span id="cb81-103"><a href="#cb81-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="st">"|"</span>,</span>
<span id="cb81-104"><a href="#cb81-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">8</span></span>
<span id="cb81-105"><a href="#cb81-105" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb81-106"><a href="#cb81-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-107"><a href="#cb81-107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-108"><a href="#cb81-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-109"><a href="#cb81-109" aria-hidden="true" tabindex="-1"></a>Though I do like boxplots, I think this is probably a more useful and revealing plot in this case, especially since we’re about to do an ANOVA, which tests for differences among means. </span>
<span id="cb81-110"><a href="#cb81-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-111"><a href="#cb81-111" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting an ANOVA model</span></span>
<span id="cb81-112"><a href="#cb81-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-113"><a href="#cb81-113" aria-hidden="true" tabindex="-1"></a>An ANOVA model is fit in R using the function <span class="in">`aov()`</span>. There is a function <span class="in">`anova()`</span>, but this instead can be used to produce an ANOVA table from an existing model.</span>
<span id="cb81-114"><a href="#cb81-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-115"><a href="#cb81-115" aria-hidden="true" tabindex="-1"></a>Let’s do it. </span>
<span id="cb81-116"><a href="#cb81-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-119"><a href="#cb81-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-120"><a href="#cb81-120" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data =</span> IS)</span>
<span id="cb81-121"><a href="#cb81-121" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-122"><a href="#cb81-122" aria-hidden="true" tabindex="-1"></a>This shows the among-groups (<span class="in">`spray`</span>) and within-groups (<span class="in">`Residuals`</span>) sum of squares, and degrees of freedom. The <span class="in">`Residual standard error`</span> is the square root of the error variance ($\sigma_\varepsilon^2$). It is the expected (average) absolute deviation from the individual data points to their respective group means. If required, you can remind yourself what these values represent from the lecture slides.</span>
<span id="cb81-123"><a href="#cb81-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-124"><a href="#cb81-124" aria-hidden="true" tabindex="-1"></a>We can get the full ANOVA table by commanding a <span class="in">`summary()`</span> of an <span class="in">`aov`</span> object. (Note, a very similar output can be achieved by applying the <span class="in">`anova()`</span> function to an <span class="in">`aov`</span> object.)</span>
<span id="cb81-125"><a href="#cb81-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-128"><a href="#cb81-128" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-129"><a href="#cb81-129" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb81-130"><a href="#cb81-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-131"><a href="#cb81-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-132"><a href="#cb81-132" aria-hidden="true" tabindex="-1"></a>The full ANOVA table also gives us the Mean Squares (the SS divided by their respective df), the F value (the ratio of the within-to-among-groups Mean Squares), and the P-value. </span>
<span id="cb81-133"><a href="#cb81-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-134"><a href="#cb81-134" aria-hidden="true" tabindex="-1"></a>The null hypothesis tested here is that there is no difference between the group means in the population. </span>
<span id="cb81-135"><a href="#cb81-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-136"><a href="#cb81-136" aria-hidden="true" tabindex="-1"></a>$$H_0 : \mu_1 = \mu_2 = ... = \mu_g$$</span>
<span id="cb81-137"><a href="#cb81-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-138"><a href="#cb81-138" aria-hidden="true" tabindex="-1"></a>The alternative hypothesis is that at least one of the groups is different to the others. </span>
<span id="cb81-139"><a href="#cb81-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-140"><a href="#cb81-140" aria-hidden="true" tabindex="-1"></a>Remember that we assume that we have taken a sample of data at random from a population. The P-value is the proportion of equivalent samples in which we would obtain the observed test statistic or greater **if the null hypothesis is true** (i.e. no difference among groups). In other words, how likely is it that the observed differences among means have occurred just through chance? Here, the F ratio is high and P-value is tiny (&lt; 0.0000000000000002). So, there is extremely strong evidence against the null hypothesis and we can conclude that there is indeed a difference among the group means—plants subjected to different types of spray have, on average, different numbers of insects on them. </span>
<span id="cb81-141"><a href="#cb81-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-142"><a href="#cb81-142" aria-hidden="true" tabindex="-1"></a>This, in itself, is not immensely informative. Naturally, we wish to examine which groups (spray types) are different from one another.</span>
<span id="cb81-143"><a href="#cb81-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-144"><a href="#cb81-144" aria-hidden="true" tabindex="-1"></a>But, first, we need to examine our assumptions.</span>
<span id="cb81-145"><a href="#cb81-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-146"><a href="#cb81-146" aria-hidden="true" tabindex="-1"></a><span class="fu">## Examining the assumptions of ANOVA</span></span>
<span id="cb81-147"><a href="#cb81-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-148"><a href="#cb81-148" aria-hidden="true" tabindex="-1"></a>Like for regression, diagnostic plots are the first step for examining how well the assumptions of ANOVA are met by our model. If these assumptions are not met, then the F-ratio might not behave as it should (i.e. follow an F-distribution) with repeated sampling under a true null hypothesis. </span>
<span id="cb81-149"><a href="#cb81-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-150"><a href="#cb81-150" aria-hidden="true" tabindex="-1"></a>Those assumptions are:</span>
<span id="cb81-151"><a href="#cb81-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-152"><a href="#cb81-152" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Appropriateness of an additive linear model</span>
<span id="cb81-153"><a href="#cb81-153" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Independent errors</span>
<span id="cb81-154"><a href="#cb81-154" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Normally distributed errors</span>
<span id="cb81-155"><a href="#cb81-155" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Homogeneity of errors</span>
<span id="cb81-156"><a href="#cb81-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-157"><a href="#cb81-157" aria-hidden="true" tabindex="-1"></a>We will focus on 3 and 4 because 1 and 2 cannot really be checked at this stage of the analysis. </span>
<span id="cb81-158"><a href="#cb81-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-159"><a href="#cb81-159" aria-hidden="true" tabindex="-1"></a>Let’s make the plots.</span>
<span id="cb81-160"><a href="#cb81-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-163"><a href="#cb81-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-164"><a href="#cb81-164" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data=</span>IS))</span>
<span id="cb81-165"><a href="#cb81-165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-166"><a href="#cb81-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-167"><a href="#cb81-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-168"><a href="#cb81-168" aria-hidden="true" tabindex="-1"></a>There is cause for concern here. As is often the case with counts, there seems to be some heteroscedasticity in the residuals. That is, the residual variance does not appear constant, but rather increases with the fitted value. In an ANOVA context, this means that the groups with high means have greater within-group variation. Let’s have a look at the standard deviations of the groups.</span>
<span id="cb81-169"><a href="#cb81-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-172"><a href="#cb81-172" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-173"><a href="#cb81-173" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> <span class="fu">group_by</span>(spray) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">sd =</span> <span class="fu">sd</span>(count))</span>
<span id="cb81-174"><a href="#cb81-174" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-175"><a href="#cb81-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-176"><a href="#cb81-176" aria-hidden="true" tabindex="-1"></a>Indeed, there is a huge difference between the largest and smallest standard deviation (roughly 3.5-fold).</span>
<span id="cb81-177"><a href="#cb81-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-178"><a href="#cb81-178" aria-hidden="true" tabindex="-1"></a>We can use a Levene’s test to explicitly test for evidence of heterogeneous variances. The function <span class="in">`leveneTest()`</span> in the <span class="in">`car`</span> package does this. Remember, the null hypothesis is that the average absolute deviations are the same in all groups. </span>
<span id="cb81-179"><a href="#cb81-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-182"><a href="#cb81-182" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-183"><a href="#cb81-183" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">leveneTest</span>(<span class="fu">aov</span>(count <span class="sc">~</span> spray, <span class="at">data=</span>IS))</span>
<span id="cb81-184"><a href="#cb81-184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-185"><a href="#cb81-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-186"><a href="#cb81-186" aria-hidden="true" tabindex="-1"></a>The low P-value here indicates that the null hypothesis is rejected and our suspicions were correct—there are significant differences in the variations among groups. </span>
<span id="cb81-187"><a href="#cb81-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-188"><a href="#cb81-188" aria-hidden="true" tabindex="-1"></a>The assumption of normality also seems suspect here, according to the fact that many data do not fall along the dotted line in the Q-Q plot. This is probably part of the same problem. </span>
<span id="cb81-189"><a href="#cb81-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-190"><a href="#cb81-190" aria-hidden="true" tabindex="-1"></a>We can try transforming the response variable <span class="in">`count`</span> and see if that helps. </span>
<span id="cb81-191"><a href="#cb81-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-192"><a href="#cb81-192" aria-hidden="true" tabindex="-1"></a><span class="fu">## ANOVA for transformed counts</span></span>
<span id="cb81-193"><a href="#cb81-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-194"><a href="#cb81-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-195"><a href="#cb81-195" aria-hidden="true" tabindex="-1"></a>We will try a log(x+1) transformation. We add the constant 1 because there are some (two) zeros in the dataset.</span>
<span id="cb81-196"><a href="#cb81-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-199"><a href="#cb81-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-200"><a href="#cb81-200" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(IS<span class="sc">$</span>count)</span>
<span id="cb81-201"><a href="#cb81-201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-202"><a href="#cb81-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-203"><a href="#cb81-203" aria-hidden="true" tabindex="-1"></a>Let’s test the assumption for the transformed data. </span>
<span id="cb81-204"><a href="#cb81-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-207"><a href="#cb81-207" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-208"><a href="#cb81-208" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb81-209"><a href="#cb81-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb81-210"><a href="#cb81-210" aria-hidden="true" tabindex="-1"></a>    <span class="at">lcount  =</span> <span class="fu">log</span>(count<span class="sc">+</span><span class="dv">1</span>) </span>
<span id="cb81-211"><a href="#cb81-211" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb81-212"><a href="#cb81-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aov</span>(<span class="at">formula =</span> lcount <span class="sc">~</span> spray) <span class="sc">|&gt;</span> </span>
<span id="cb81-213"><a href="#cb81-213" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">leveneTest</span>()</span>
<span id="cb81-214"><a href="#cb81-214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-215"><a href="#cb81-215" aria-hidden="true" tabindex="-1"></a>The test is now non-significant, but 0.1 is still a fairly small P-value. Looking at the following boxplot, it seems like the log transformation might be too severe—the groups with smaller means now seem to have higher variance than those with larger means. </span>
<span id="cb81-216"><a href="#cb81-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-217"><a href="#cb81-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-220"><a href="#cb81-220" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-221"><a href="#cb81-221" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb81-222"><a href="#cb81-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb81-223"><a href="#cb81-223" aria-hidden="true" tabindex="-1"></a>    <span class="at">lcount  =</span> <span class="fu">log</span>(count<span class="sc">+</span><span class="dv">1</span>) </span>
<span id="cb81-224"><a href="#cb81-224" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb81-225"><a href="#cb81-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-226"><a href="#cb81-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> lcount, <span class="at">y =</span> spray) <span class="sc">|&gt;</span> </span>
<span id="cb81-227"><a href="#cb81-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb81-228"><a href="#cb81-228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-229"><a href="#cb81-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-230"><a href="#cb81-230" aria-hidden="true" tabindex="-1"></a>Now try instead a square-root transformation.  </span>
<span id="cb81-231"><a href="#cb81-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-234"><a href="#cb81-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-235"><a href="#cb81-235" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb81-236"><a href="#cb81-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb81-237"><a href="#cb81-237" aria-hidden="true" tabindex="-1"></a>    <span class="at">sqrt_count  =</span> <span class="fu">sqrt</span>(count) </span>
<span id="cb81-238"><a href="#cb81-238" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb81-239"><a href="#cb81-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aov</span>(<span class="at">formula =</span> sqrt_count <span class="sc">~</span> spray) <span class="sc">|&gt;</span> </span>
<span id="cb81-240"><a href="#cb81-240" aria-hidden="true" tabindex="-1"></a>  car<span class="sc">::</span><span class="fu">leveneTest</span>()</span>
<span id="cb81-241"><a href="#cb81-241" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-242"><a href="#cb81-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-245"><a href="#cb81-245" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-246"><a href="#cb81-246" aria-hidden="true" tabindex="-1"></a>IS <span class="sc">|&gt;</span> </span>
<span id="cb81-247"><a href="#cb81-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb81-248"><a href="#cb81-248" aria-hidden="true" tabindex="-1"></a> <span class="at">sqrt_count  =</span> <span class="fu">sqrt</span>(count) </span>
<span id="cb81-249"><a href="#cb81-249" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb81-250"><a href="#cb81-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-251"><a href="#cb81-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> sqrt_count, <span class="at">y =</span> spray) <span class="sc">|&gt;</span> </span>
<span id="cb81-252"><a href="#cb81-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb81-253"><a href="#cb81-253" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-254"><a href="#cb81-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-255"><a href="#cb81-255" aria-hidden="true" tabindex="-1"></a>This looks like a better transformation for this model.</span>
<span id="cb81-256"><a href="#cb81-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-257"><a href="#cb81-257" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting an ANOVA to the transformed data </span></span>
<span id="cb81-258"><a href="#cb81-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-259"><a href="#cb81-259" aria-hidden="true" tabindex="-1"></a>Fit the model.</span>
<span id="cb81-260"><a href="#cb81-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-263"><a href="#cb81-263" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-264"><a href="#cb81-264" aria-hidden="true" tabindex="-1"></a>IS <span class="ot">&lt;-</span> IS <span class="sc">|&gt;</span> <span class="fu">mutate</span>( <span class="at">sqrt_count  =</span> <span class="fu">sqrt</span>(count) )</span>
<span id="cb81-265"><a href="#cb81-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-266"><a href="#cb81-266" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(sqrt_count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb81-267"><a href="#cb81-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-268"><a href="#cb81-268" aria-hidden="true" tabindex="-1"></a>Now show up the diagnostic plots for this model.</span>
<span id="cb81-269"><a href="#cb81-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-272"><a href="#cb81-272" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-273"><a href="#cb81-273" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(sqrt_count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb81-274"><a href="#cb81-274" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-275"><a href="#cb81-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-276"><a href="#cb81-276" aria-hidden="true" tabindex="-1"></a>Much better!</span>
<span id="cb81-277"><a href="#cb81-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-278"><a href="#cb81-278" aria-hidden="true" tabindex="-1"></a>This clearly has not made a substantial impact on the result of the hypothesis test for a difference among group means, but we can be happier that the inference is correct.</span>
<span id="cb81-279"><a href="#cb81-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-280"><a href="#cb81-280" aria-hidden="true" tabindex="-1"></a>Now let’s look at the differences among groups. </span>
<span id="cb81-281"><a href="#cb81-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-282"><a href="#cb81-282" aria-hidden="true" tabindex="-1"></a><span class="fu">## Post-hoc multiple comparisons </span></span>
<span id="cb81-283"><a href="#cb81-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-284"><a href="#cb81-284" aria-hidden="true" tabindex="-1"></a>Tukey’s Honest Significant Differences (HSD) are a method of adjusting for the fact that, in a post-hoc analysis such as this, there are simultaneously hypothesis tests being done. Across all these tests, the probability of erroneously finding a significant difference (i.e. making a Type I error) is greater than the nominated alpha value (usually 0.05). The HSD method makes each individual test slightly more conservative so that the family-wise error rate across all tests is conserved. </span>
<span id="cb81-285"><a href="#cb81-285" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb81-286"><a href="#cb81-286" aria-hidden="true" tabindex="-1"></a>Tukey’s HSD can be implemented in R as follows. </span>
<span id="cb81-287"><a href="#cb81-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-290"><a href="#cb81-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-291"><a href="#cb81-291" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(sqrt_count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> <span class="fu">TukeyHSD</span>()</span>
<span id="cb81-292"><a href="#cb81-292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-293"><a href="#cb81-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-294"><a href="#cb81-294" aria-hidden="true" tabindex="-1"></a>This table above has each possible pairwise comparison of groups. The number of comparisons is $g(g – 1)/2 = 15$ (where $g$ = the number of groups = 6). </span>
<span id="cb81-295"><a href="#cb81-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-296"><a href="#cb81-296" aria-hidden="true" tabindex="-1"></a>For each pairwise comparison, the table gives the estimated difference (<span class="in">`diff`</span>), the lower (<span class="in">`lwr`</span>) and upper (<span class="in">`upr`</span>) confidence intervals and the p-value (<span class="in">`p adj`</span>) which tests whether the difference is statistically significant. The confidence intervals and the p-value are adjusted for the fact that multiple simultaneous comparisons are being made, and so are more conservative than if they were done separately. Out of the 15 comparisons, 10 have very low p-values. </span>
<span id="cb81-297"><a href="#cb81-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-298"><a href="#cb81-298" aria-hidden="true" tabindex="-1"></a>Here are the intervals shown on a plot.</span>
<span id="cb81-299"><a href="#cb81-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-300"><a href="#cb81-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-303"><a href="#cb81-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-304"><a href="#cb81-304" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(sqrt_count <span class="sc">~</span> spray, <span class="at">data=</span>IS) <span class="sc">|&gt;</span> </span>
<span id="cb81-305"><a href="#cb81-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">TukeyHSD</span>() <span class="sc">|&gt;</span> </span>
<span id="cb81-306"><a href="#cb81-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb81-307"><a href="#cb81-307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-308"><a href="#cb81-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-309"><a href="#cb81-309" aria-hidden="true" tabindex="-1"></a>This plot provides a visual impression of the size and adjusted confidence intervals for each comparison. An interval that includes zero indicates that the difference between those groups is non-significant (i.e. the null hypothesis of no difference is retained). This was the case for <span class="in">`B-A`</span>, <span class="in">`F-A`</span>, <span class="in">`F-B`</span>, <span class="in">`E-C`</span>, and <span class="in">`E-D`</span>. From the earlier plots, this makes sense. <span class="in">`A-B-F`</span> seem to be quite similar, as do <span class="in">`E-C-D`</span>. </span>
<span id="cb81-310"><a href="#cb81-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-311"><a href="#cb81-311" aria-hidden="true" tabindex="-1"></a><span class="fu"># Goats – Analysis of **Co**variance</span></span>
<span id="cb81-312"><a href="#cb81-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-313"><a href="#cb81-313" aria-hidden="true" tabindex="-1"></a>Here, we will use a dataset<span class="ot">[^1]</span> containing the weights of 40 goats before and after an experiment where 20 were given a standard drenching treatment and 20 were given a more intensive drenching treatment. There are three columns corresponding to the treatment (<span class="in">`Tmt`</span>), the gain in weight over the experiment (<span class="in">`WtGain`</span>, kg), and the initial weight at the start of the experiment (<span class="in">`InitialWt`</span>, kg). </span>
<span id="cb81-314"><a href="#cb81-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-315"><a href="#cb81-315" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]</span> Source: Saville DJ, Wood GR (1991) *Statistical Methods: The Geometric Approach*. Springer, New York.</span>
<span id="cb81-316"><a href="#cb81-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-317"><a href="#cb81-317" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load the data</span></span>
<span id="cb81-318"><a href="#cb81-318" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb81-321"><a href="#cb81-321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-322"><a href="#cb81-322" aria-hidden="true" tabindex="-1"></a>goat <span class="ot">&lt;-</span> <span class="fu">read_table</span>(<span class="st">"https://www.massey.ac.nz/~anhsmith/data/goats.txt"</span>)</span>
<span id="cb81-323"><a href="#cb81-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-324"><a href="#cb81-324" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(goat)</span>
<span id="cb81-325"><a href="#cb81-325" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-326"><a href="#cb81-326" aria-hidden="true" tabindex="-1"></a>The initial weight is included because of commonly observed biological phenomenon known as "regression to the norm", where lighter animals even the ledger by gaining more weight than the heavier animals. By using an ANCOVA model that incorporates the initial weight as a covariate can therefore give us more power to detect an effect of the treatment. </span>
<span id="cb81-327"><a href="#cb81-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-328"><a href="#cb81-328" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting treatment only </span></span>
<span id="cb81-329"><a href="#cb81-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-330"><a href="#cb81-330" aria-hidden="true" tabindex="-1"></a>Let’s start with a boxplot of the response variable by reference to the predictor of interest, treatment.</span>
<span id="cb81-331"><a href="#cb81-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-334"><a href="#cb81-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-335"><a href="#cb81-335" aria-hidden="true" tabindex="-1"></a>goat <span class="sc">|&gt;</span> </span>
<span id="cb81-336"><a href="#cb81-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-337"><a href="#cb81-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> WtGain, <span class="at">y =</span> Tmt) <span class="sc">+</span> </span>
<span id="cb81-338"><a href="#cb81-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb81-339"><a href="#cb81-339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-340"><a href="#cb81-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-341"><a href="#cb81-341" aria-hidden="true" tabindex="-1"></a>There seems to be a reasonable effect of treatment. This is apparent in an ANOVA fitted without the covariate. </span>
<span id="cb81-342"><a href="#cb81-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-345"><a href="#cb81-345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-346"><a href="#cb81-346" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> Tmt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb81-347"><a href="#cb81-347" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-348"><a href="#cb81-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-349"><a href="#cb81-349" aria-hidden="true" tabindex="-1"></a>Sure enough, effect of the treatment is significant, though it is marginally so. The effect size can be viewed in a linear model summary.</span>
<span id="cb81-350"><a href="#cb81-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-353"><a href="#cb81-353" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-354"><a href="#cb81-354" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(WtGain <span class="sc">~</span> Tmt, <span class="at">data=</span>goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb81-355"><a href="#cb81-355" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-356"><a href="#cb81-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-357"><a href="#cb81-357" aria-hidden="true" tabindex="-1"></a>From here, we can see that the estimated difference between the treatments is 1.3 kg—the mean for intensive is 6.85 kg and the mean for standard is 5.55 kg. </span>
<span id="cb81-358"><a href="#cb81-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-361"><a href="#cb81-361" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-362"><a href="#cb81-362" aria-hidden="true" tabindex="-1"></a>goat <span class="sc">|&gt;</span> <span class="fu">group_by</span>(Tmt) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(WtGain))</span>
<span id="cb81-363"><a href="#cb81-363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-364"><a href="#cb81-364" aria-hidden="true" tabindex="-1"></a>The fitted model explains only 10% of the variation in the data. The average difference between the fitted means and the observations is 2.023, which is greater than the estimated difference in means. So, all in all, there is a significant effect but it is not large. We can estimate a 95% confidence interval for this difference using $\hat d + t_{df,<span class="co">[</span><span class="ot">0.025,0.975</span><span class="co">]</span>} \times \text{SE}(\hat d)$. </span>
<span id="cb81-365"><a href="#cb81-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-368"><a href="#cb81-368" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-369"><a href="#cb81-369" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">1.3</span> <span class="sc">+</span> <span class="fu">qt</span>(<span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>), <span class="dv">38</span>) <span class="sc">*</span> <span class="fl">0.6397</span></span>
<span id="cb81-370"><a href="#cb81-370" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-371"><a href="#cb81-371" aria-hidden="true" tabindex="-1"></a>So, the confidence interval for the difference is <span class="sc">\{</span>0.005 , 2.595<span class="sc">\}</span>.</span>
<span id="cb81-372"><a href="#cb81-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-373"><a href="#cb81-373" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting Initial Weight only</span></span>
<span id="cb81-374"><a href="#cb81-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-375"><a href="#cb81-375" aria-hidden="true" tabindex="-1"></a>Now we will look at the effect of the covariate, <span class="in">`InitialWt`</span>. </span>
<span id="cb81-376"><a href="#cb81-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-379"><a href="#cb81-379" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-380"><a href="#cb81-380" aria-hidden="true" tabindex="-1"></a>goat <span class="sc">|&gt;</span> </span>
<span id="cb81-381"><a href="#cb81-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-382"><a href="#cb81-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> InitialWt, <span class="at">y =</span> WtGain) <span class="sc">+</span></span>
<span id="cb81-383"><a href="#cb81-383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">4</span>)</span>
<span id="cb81-384"><a href="#cb81-384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-385"><a href="#cb81-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-386"><a href="#cb81-386" aria-hidden="true" tabindex="-1"></a>We can see that there is a relationship between the initial weight of the goats and the gain in weight, in that the goats that were lighter at the start of the experiment gained more weight. </span>
<span id="cb81-387"><a href="#cb81-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-388"><a href="#cb81-388" aria-hidden="true" tabindex="-1"></a>Look at a linear model using this predictor alone.</span>
<span id="cb81-389"><a href="#cb81-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-392"><a href="#cb81-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-393"><a href="#cb81-393" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(WtGain <span class="sc">~</span> InitialWt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb81-394"><a href="#cb81-394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-395"><a href="#cb81-395" aria-hidden="true" tabindex="-1"></a>For every extra kilogram of weight at the start, the goat is expected to gain 354 g less over the course of the experiment. The effect is highly significant, and explains 35% of the variation in weight gain. We are not interested in this effect though, per se, because it has been demonstrated many times before. We are most interested in the effect of the treatment.</span>
<span id="cb81-396"><a href="#cb81-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-397"><a href="#cb81-397" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting both... ANOVA!</span></span>
<span id="cb81-398"><a href="#cb81-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-399"><a href="#cb81-399" aria-hidden="true" tabindex="-1"></a>Now we will look at the effect of the <span class="in">`Tmt`</span> in the context of the covariate, <span class="in">`InitialWt.`</span> </span>
<span id="cb81-400"><a href="#cb81-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-403"><a href="#cb81-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-404"><a href="#cb81-404" aria-hidden="true" tabindex="-1"></a>ggoat <span class="ot">&lt;-</span> goat <span class="sc">|&gt;</span> </span>
<span id="cb81-405"><a href="#cb81-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-406"><a href="#cb81-406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> InitialWt, <span class="at">y =</span> WtGain, <span class="at">colour =</span> Tmt) <span class="sc">+</span></span>
<span id="cb81-407"><a href="#cb81-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">4</span>)</span>
<span id="cb81-408"><a href="#cb81-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-409"><a href="#cb81-409" aria-hidden="true" tabindex="-1"></a>ggoat</span>
<span id="cb81-410"><a href="#cb81-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-411"><a href="#cb81-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-412"><a href="#cb81-412" aria-hidden="true" tabindex="-1"></a>This shows the effects of both predictors simultaneously. We can envisage two lines on this graph—one through the Intensive points and one through the Standard points. The difference in the heights of these lines is the effect of treatment, the slope of the lines is the effect of the initial weight, and any difference in the slopes of the lines is the interaction between the two predictors. </span>
<span id="cb81-413"><a href="#cb81-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-414"><a href="#cb81-414" aria-hidden="true" tabindex="-1"></a>Now fit a model including both these predictors simultaneously, including any interaction. </span>
<span id="cb81-415"><a href="#cb81-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-418"><a href="#cb81-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-419"><a href="#cb81-419" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">*</span> Tmt, <span class="at">data=</span>goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb81-420"><a href="#cb81-420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-421"><a href="#cb81-421" aria-hidden="true" tabindex="-1"></a>The first thing is to check for a significant interaction. There is not, so we can assume that there is no difference in the slope of the lines for Intensive and Standard treatments. Thus, there is no evidence that the effect of the initial weight varies among the two treatments, or that the treatment effect varies according to the initial weight. </span>
<span id="cb81-422"><a href="#cb81-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-423"><a href="#cb81-423" aria-hidden="true" tabindex="-1"></a>Applying the <span class="in">`drop1()`</span> function supports that the more parsimonious model is that without the interaction.</span>
<span id="cb81-424"><a href="#cb81-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-427"><a href="#cb81-427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-428"><a href="#cb81-428" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">*</span> Tmt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">drop1</span>()</span>
<span id="cb81-429"><a href="#cb81-429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-430"><a href="#cb81-430" aria-hidden="true" tabindex="-1"></a>Now we can confidently fit the model with just the two main effects. </span>
<span id="cb81-431"><a href="#cb81-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-434"><a href="#cb81-434" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-435"><a href="#cb81-435" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">+</span> Tmt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb81-436"><a href="#cb81-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-437"><a href="#cb81-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-438"><a href="#cb81-438" aria-hidden="true" tabindex="-1"></a>I have put the treatment in the model after the initial weight, so we effectively obtain the Type II sum of squares for treatment, i.e., the variation that is attributable to treatment only, after all the variation attributable to initial weight has been accounted for. This provides a more conservative test for our effect of interest. It matters little in this case, however. Review the table for when treatment alone is fit.</span>
<span id="cb81-439"><a href="#cb81-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-442"><a href="#cb81-442" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-443"><a href="#cb81-443" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(WtGain <span class="sc">~</span> Tmt, <span class="at">data =</span> goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb81-444"><a href="#cb81-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-445"><a href="#cb81-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-446"><a href="#cb81-446" aria-hidden="true" tabindex="-1"></a>The SS for treatment has decreased only slightly from the inclusion of initial weight, from 16.9 to 16.0. </span>
<span id="cb81-447"><a href="#cb81-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-448"><a href="#cb81-448" aria-hidden="true" tabindex="-1"></a>More importantly, though, the F-ratio has increased by 50% and the P-value has decreased from 0.05 to 0.02! Just from including another (potentially competing) predictor in the model! Take a moment to consider how this might have happened.</span>
<span id="cb81-449"><a href="#cb81-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-450"><a href="#cb81-450" aria-hidden="true" tabindex="-1"></a>The key here is the decrease in the residual SS from 156 to 97. The F-ratio is calculated from the treatment SS divided by the residual SS. Therefore, if you decrease the residual SS, you can increase the value of F. By attributing variation to a covariate, it is no longer considered to be part of the random, unexplained variation. Our ability to detect an effect of the treatment is therefore strengthened. </span>
<span id="cb81-451"><a href="#cb81-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-452"><a href="#cb81-452" aria-hidden="true" tabindex="-1"></a>This is also apparent in the linear model summary.</span>
<span id="cb81-453"><a href="#cb81-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-456"><a href="#cb81-456" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-457"><a href="#cb81-457" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">+</span> Tmt, <span class="at">data=</span>goat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb81-458"><a href="#cb81-458" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-459"><a href="#cb81-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-460"><a href="#cb81-460" aria-hidden="true" tabindex="-1"></a>While the estimated effect of the treatment has reduced from a difference of 1.30 to 1.26, the standard error has reduced from 0.64 to 0.51. We can recalculate the confidence interval for the difference (we remove a degree of freedom for the fact that we are also estimating a regression slope).</span>
<span id="cb81-461"><a href="#cb81-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-464"><a href="#cb81-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-465"><a href="#cb81-465" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">1.26</span> <span class="sc">+</span> <span class="fu">qt</span>(<span class="fu">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>),<span class="dv">37</span>) <span class="sc">*</span> <span class="fl">0.51169</span></span>
<span id="cb81-466"><a href="#cb81-466" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-467"><a href="#cb81-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-468"><a href="#cb81-468" aria-hidden="true" tabindex="-1"></a>The interval for the difference <span class="sc">\{</span>0.223 , 2.297<span class="sc">\}</span> is quite a bit smaller than the one obtained earlier when fitting treatment alone <span class="sc">\{</span>0.005 , 2.595<span class="sc">\}</span>, and no longer brushes so close to zero.</span>
<span id="cb81-469"><a href="#cb81-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-470"><a href="#cb81-470" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plotting the model</span></span>
<span id="cb81-471"><a href="#cb81-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-472"><a href="#cb81-472" aria-hidden="true" tabindex="-1"></a>We can get <span class="in">`ggplot`</span> to fit two linear models (one for each treatment) on our scatterplot. </span>
<span id="cb81-473"><a href="#cb81-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-476"><a href="#cb81-476" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-477"><a href="#cb81-477" aria-hidden="true" tabindex="-1"></a>ggoat <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span>
<span id="cb81-478"><a href="#cb81-478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-479"><a href="#cb81-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-480"><a href="#cb81-480" aria-hidden="true" tabindex="-1"></a>However, notice that the slopes are different. In our model, the slopes are the same, because it doesn't have an interaction between <span class="in">`InitialWt`</span> and <span class="in">`Tmt`</span>. This is where the <span class="in">`visreg`</span> package is very useful!</span>
<span id="cb81-481"><a href="#cb81-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-484"><a href="#cb81-484" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-485"><a href="#cb81-485" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visreg)</span>
<span id="cb81-486"><a href="#cb81-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-487"><a href="#cb81-487" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(WtGain <span class="sc">~</span> InitialWt <span class="sc">+</span> Tmt, <span class="at">data=</span>goat) <span class="sc">|&gt;</span> </span>
<span id="cb81-488"><a href="#cb81-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visreg</span>(<span class="at">xvar =</span> <span class="st">"InitialWt"</span>, <span class="at">by =</span> <span class="st">"Tmt"</span>, <span class="at">overlay =</span> <span class="cn">TRUE</span>, <span class="at">gg =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-489"><a href="#cb81-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-490"><a href="#cb81-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-491"><a href="#cb81-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-492"><a href="#cb81-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-493"><a href="#cb81-493" aria-hidden="true" tabindex="-1"></a><span class="fu"># Dataset **`alfalfa`**</span></span>
<span id="cb81-494"><a href="#cb81-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-495"><a href="#cb81-495" aria-hidden="true" tabindex="-1"></a>This dataset is from the R package <span class="in">`faraway`</span>. The alfalfa dataset frame has 25 rows and 4 columns. Data comes from an experiment to test the effects of seed inoculum, irrigation and shade on alfalfa yield. </span>
<span id="cb81-496"><a href="#cb81-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-497"><a href="#cb81-497" aria-hidden="true" tabindex="-1"></a>This data frame contains the following columns:</span>
<span id="cb81-498"><a href="#cb81-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-499"><a href="#cb81-499" aria-hidden="true" tabindex="-1"></a><span class="in">`shade`</span> - Distance of location from tree line divided into 5 shade areas</span>
<span id="cb81-500"><a href="#cb81-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-501"><a href="#cb81-501" aria-hidden="true" tabindex="-1"></a><span class="in">`irrigation`</span> - Irrigation effect divided into 5 levels</span>
<span id="cb81-502"><a href="#cb81-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-503"><a href="#cb81-503" aria-hidden="true" tabindex="-1"></a><span class="in">`inoculum`</span> - Four types of seed incolum, A-D with E as control</span>
<span id="cb81-504"><a href="#cb81-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-505"><a href="#cb81-505" aria-hidden="true" tabindex="-1"></a><span class="in">`yield`</span> - Dry matter yield of alfalfa</span>
<span id="cb81-506"><a href="#cb81-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-507"><a href="#cb81-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide'}</span></span>
<span id="cb81-508"><a href="#cb81-508" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb81-509"><a href="#cb81-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-510"><a href="#cb81-510" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(alfalfa, <span class="at">package =</span> <span class="st">"faraway"</span>)</span>
<span id="cb81-511"><a href="#cb81-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-512"><a href="#cb81-512" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(alfalfa, <span class="dv">25</span>)</span>
<span id="cb81-513"><a href="#cb81-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-514"><a href="#cb81-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-515"><a href="#cb81-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-516"><a href="#cb81-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-517"><a href="#cb81-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-518"><a href="#cb81-518" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 8.1 {-}</span></span>
<span id="cb81-519"><a href="#cb81-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-520"><a href="#cb81-520" aria-hidden="true" tabindex="-1"></a>Obtain the main effects and interaction plots.</span>
<span id="cb81-521"><a href="#cb81-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-522"><a href="#cb81-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-523"><a href="#cb81-523" aria-hidden="true" tabindex="-1"></a>Old style Main effects plots:</span>
<span id="cb81-524"><a href="#cb81-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-525"><a href="#cb81-525" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb81-526"><a href="#cb81-526" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(yield <span class="sc">~</span> shade <span class="sc">+</span> irrigation <span class="sc">+</span> inoculum, </span>
<span id="cb81-527"><a href="#cb81-527" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>alfalfa)</span>
<span id="cb81-528"><a href="#cb81-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-529"><a href="#cb81-529" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb81-530"><a href="#cb81-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-531"><a href="#cb81-531" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">allEffects</span>(mod1))</span>
<span id="cb81-532"><a href="#cb81-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-533"><a href="#cb81-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-534"><a href="#cb81-534" aria-hidden="true" tabindex="-1"></a>Old style Interaction effects plots:</span>
<span id="cb81-535"><a href="#cb81-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-536"><a href="#cb81-536" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb81-537"><a href="#cb81-537" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">aov</span>(</span>
<span id="cb81-538"><a href="#cb81-538" aria-hidden="true" tabindex="-1"></a>  yield <span class="sc">~</span> shade<span class="sc">*</span>irrigation<span class="sc">*</span>inoculum <span class="sc">-</span> shade<span class="sc">:</span>irrigation<span class="sc">:</span>inoculum, </span>
<span id="cb81-539"><a href="#cb81-539" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> alfalfa</span>
<span id="cb81-540"><a href="#cb81-540" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-541"><a href="#cb81-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-542"><a href="#cb81-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-543"><a href="#cb81-543" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb81-544"><a href="#cb81-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-545"><a href="#cb81-545" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> shade <span class="sc">*</span> irrigation, <span class="at">data =</span> alfalfa) </span>
<span id="cb81-546"><a href="#cb81-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-547"><a href="#cb81-547" aria-hidden="true" tabindex="-1"></a><span class="fu">effect</span>(<span class="st">'shade:irrigation'</span>, </span>
<span id="cb81-548"><a href="#cb81-548" aria-hidden="true" tabindex="-1"></a>       <span class="at">mod =</span> mod1) <span class="sc">|&gt;</span> </span>
<span id="cb81-549"><a href="#cb81-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">multiline =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-550"><a href="#cb81-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-551"><a href="#cb81-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-552"><a href="#cb81-552" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> shade <span class="sc">*</span> inoculum, <span class="at">data =</span> alfalfa) </span>
<span id="cb81-553"><a href="#cb81-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-554"><a href="#cb81-554" aria-hidden="true" tabindex="-1"></a><span class="fu">effect</span>(<span class="st">'shade:inoculum'</span>,</span>
<span id="cb81-555"><a href="#cb81-555" aria-hidden="true" tabindex="-1"></a>       <span class="at">mod=</span>mod2) <span class="sc">|&gt;</span> </span>
<span id="cb81-556"><a href="#cb81-556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">multiline=</span><span class="cn">TRUE</span>)</span>
<span id="cb81-557"><a href="#cb81-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-558"><a href="#cb81-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-559"><a href="#cb81-559" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> irrigation <span class="sc">*</span> inoculum, <span class="at">data =</span> alfalfa) </span>
<span id="cb81-560"><a href="#cb81-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-561"><a href="#cb81-561" aria-hidden="true" tabindex="-1"></a><span class="fu">effect</span>(<span class="st">'irrigation:inoculum'</span>,</span>
<span id="cb81-562"><a href="#cb81-562" aria-hidden="true" tabindex="-1"></a>       <span class="at">mod=</span>mod3) <span class="sc">|&gt;</span> </span>
<span id="cb81-563"><a href="#cb81-563" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">multiline=</span><span class="cn">TRUE</span>)</span>
<span id="cb81-564"><a href="#cb81-564" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-565"><a href="#cb81-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-566"><a href="#cb81-566" aria-hidden="true" tabindex="-1"></a><span class="in">`ggplot2`</span> can produce good main effects and interaction plots but the R codes for this task are not short. For main effects plot-</span>
<span id="cb81-567"><a href="#cb81-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-568"><a href="#cb81-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb81-569"><a href="#cb81-569" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb81-570"><a href="#cb81-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-571"><a href="#cb81-571" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span> </span>
<span id="cb81-572"><a href="#cb81-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> shade, <span class="at">y =</span> yield) <span class="sc">+</span></span>
<span id="cb81-573"><a href="#cb81-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb81-574"><a href="#cb81-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb81-575"><a href="#cb81-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb81-576"><a href="#cb81-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effect of shade"</span>)</span>
<span id="cb81-577"><a href="#cb81-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-578"><a href="#cb81-578" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb81-579"><a href="#cb81-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> irrigation, <span class="at">y =</span> yield) <span class="sc">+</span></span>
<span id="cb81-580"><a href="#cb81-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb81-581"><a href="#cb81-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb81-582"><a href="#cb81-582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb81-583"><a href="#cb81-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effect of irrigation"</span>)</span>
<span id="cb81-584"><a href="#cb81-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-585"><a href="#cb81-585" aria-hidden="true" tabindex="-1"></a>plot3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb81-586"><a href="#cb81-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> inoculum, <span class="at">y =</span> yield) <span class="sc">+</span></span>
<span id="cb81-587"><a href="#cb81-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb81-588"><a href="#cb81-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>, <span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb81-589"><a href="#cb81-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb81-590"><a href="#cb81-590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Main effect of inoculum"</span>)</span>
<span id="cb81-591"><a href="#cb81-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-592"><a href="#cb81-592" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb81-593"><a href="#cb81-593" aria-hidden="true" tabindex="-1"></a>plot1<span class="sc">+</span>plot2<span class="sc">+</span>plot3</span>
<span id="cb81-594"><a href="#cb81-594" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-595"><a href="#cb81-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-596"><a href="#cb81-596" aria-hidden="true" tabindex="-1"></a>For interaction plot-</span>
<span id="cb81-597"><a href="#cb81-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-598"><a href="#cb81-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb81-599"><a href="#cb81-599" aria-hidden="true" tabindex="-1"></a><span class="co">#Interactions Plot</span></span>
<span id="cb81-600"><a href="#cb81-600" aria-hidden="true" tabindex="-1"></a>plot4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb81-601"><a href="#cb81-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> shade, <span class="at">y =</span> yield, </span>
<span id="cb81-602"><a href="#cb81-602" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> irrigation, <span class="at">colour =</span> irrigation) <span class="sc">+</span></span>
<span id="cb81-603"><a href="#cb81-603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"point"</span>)<span class="sc">+</span></span>
<span id="cb81-604"><a href="#cb81-604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"line"</span>)<span class="sc">+</span></span>
<span id="cb81-605"><a href="#cb81-605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb81-606"><a href="#cb81-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"shade*irrigation interaction"</span>)</span>
<span id="cb81-607"><a href="#cb81-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-608"><a href="#cb81-608" aria-hidden="true" tabindex="-1"></a>plot5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb81-609"><a href="#cb81-609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> inoculum, <span class="at">y =</span> yield,</span>
<span id="cb81-610"><a href="#cb81-610" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> irrigation, <span class="at">colour =</span> irrigation) <span class="sc">+</span></span>
<span id="cb81-611"><a href="#cb81-611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"point"</span>)<span class="sc">+</span></span>
<span id="cb81-612"><a href="#cb81-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"line"</span>)<span class="sc">+</span></span>
<span id="cb81-613"><a href="#cb81-613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb81-614"><a href="#cb81-614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"inoculum*irrigation interaction"</span>)</span>
<span id="cb81-615"><a href="#cb81-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-616"><a href="#cb81-616" aria-hidden="true" tabindex="-1"></a>plot6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(alfalfa) <span class="sc">+</span></span>
<span id="cb81-617"><a href="#cb81-617" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> shade, <span class="at">y =</span> yield, </span>
<span id="cb81-618"><a href="#cb81-618" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> inoculum, <span class="at">colour =</span> inoculum) <span class="sc">+</span></span>
<span id="cb81-619"><a href="#cb81-619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"point"</span>)<span class="sc">+</span></span>
<span id="cb81-620"><a href="#cb81-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean, <span class="at">geom=</span><span class="st">"line"</span>)<span class="sc">+</span></span>
<span id="cb81-621"><a href="#cb81-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(yield)), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb81-622"><a href="#cb81-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"shade*inoculum interaction"</span>)</span>
<span id="cb81-623"><a href="#cb81-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-624"><a href="#cb81-624" aria-hidden="true" tabindex="-1"></a>plot4 <span class="sc">/</span> plot5 <span class="sc">/</span> plot6</span>
<span id="cb81-625"><a href="#cb81-625" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-626"><a href="#cb81-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-627"><a href="#cb81-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-628"><a href="#cb81-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-629"><a href="#cb81-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-630"><a href="#cb81-630" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 8.2 {-}</span></span>
<span id="cb81-631"><a href="#cb81-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-632"><a href="#cb81-632" aria-hidden="true" tabindex="-1"></a>Fit one-way ANOVA models to this dataset.</span>
<span id="cb81-633"><a href="#cb81-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-634"><a href="#cb81-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-635"><a href="#cb81-635" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb81-636"><a href="#cb81-636" aria-hidden="true" tabindex="-1"></a>anova1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(yield <span class="sc">~</span> shade, <span class="at">data =</span> alfalfa)</span>
<span id="cb81-637"><a href="#cb81-637" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova1)</span>
<span id="cb81-638"><a href="#cb81-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-639"><a href="#cb81-639" aria-hidden="true" tabindex="-1"></a>anova2 <span class="ot">&lt;-</span> <span class="fu">aov</span>(yield <span class="sc">~</span> irrigation, <span class="at">data =</span> alfalfa)</span>
<span id="cb81-640"><a href="#cb81-640" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova2)</span>
<span id="cb81-641"><a href="#cb81-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-642"><a href="#cb81-642" aria-hidden="true" tabindex="-1"></a>anova3 <span class="ot">&lt;-</span> <span class="fu">aov</span>(yield <span class="sc">~</span> inoculum, <span class="at">data =</span> alfalfa)</span>
<span id="cb81-643"><a href="#cb81-643" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova3)</span>
<span id="cb81-644"><a href="#cb81-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-645"><a href="#cb81-645" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">TukeyHSD</span>(anova1))</span>
<span id="cb81-646"><a href="#cb81-646" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">TukeyHSD</span>(anova2))</span>
<span id="cb81-647"><a href="#cb81-647" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">TukeyHSD</span>(anova3))</span>
<span id="cb81-648"><a href="#cb81-648" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-649"><a href="#cb81-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-650"><a href="#cb81-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-651"><a href="#cb81-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-652"><a href="#cb81-652" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 8.3 {-}</span></span>
<span id="cb81-653"><a href="#cb81-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-654"><a href="#cb81-654" aria-hidden="true" tabindex="-1"></a>Fit a three-factor (additive) ANOVA model without interactions.</span>
<span id="cb81-655"><a href="#cb81-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-656"><a href="#cb81-656" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb81-657"><a href="#cb81-657" aria-hidden="true" tabindex="-1"></a>anova1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(yield <span class="sc">~</span> shade <span class="sc">+</span> irrigation <span class="sc">+</span> inoculum,</span>
<span id="cb81-658"><a href="#cb81-658" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> alfalfa)</span>
<span id="cb81-659"><a href="#cb81-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-660"><a href="#cb81-660" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova1)</span>
<span id="cb81-661"><a href="#cb81-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-662"><a href="#cb81-662" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb81-663"><a href="#cb81-663" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(anova1, <span class="dv">1</span>)</span>
<span id="cb81-664"><a href="#cb81-664" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-665"><a href="#cb81-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-666"><a href="#cb81-666" aria-hidden="true" tabindex="-1"></a>For the base R style four diagnostic plots, use <span class="in">`plot(anova1)`</span> and set the <span class="in">`par`</span>.</span>
<span id="cb81-667"><a href="#cb81-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-670"><a href="#cb81-670" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-671"><a href="#cb81-671" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb81-672"><a href="#cb81-672" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(anova1)</span>
<span id="cb81-673"><a href="#cb81-673" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-674"><a href="#cb81-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-675"><a href="#cb81-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-676"><a href="#cb81-676" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 8.4 {-}</span></span>
<span id="cb81-677"><a href="#cb81-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-678"><a href="#cb81-678" aria-hidden="true" tabindex="-1"></a>Fit the indicator variable regression model of <span class="in">`yield ~ inoculum`</span></span>
<span id="cb81-679"><a href="#cb81-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-680"><a href="#cb81-680" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb81-681"><a href="#cb81-681" aria-hidden="true" tabindex="-1"></a>alfalfa <span class="ot">&lt;-</span> alfalfa <span class="sc">|&gt;</span> </span>
<span id="cb81-682"><a href="#cb81-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb81-683"><a href="#cb81-683" aria-hidden="true" tabindex="-1"></a>    <span class="at">I.A =</span> <span class="fu">as.numeric</span>(inoculum<span class="sc">==</span><span class="st">"A"</span>),</span>
<span id="cb81-684"><a href="#cb81-684" aria-hidden="true" tabindex="-1"></a>    <span class="at">I.B =</span> <span class="fu">as.numeric</span>(inoculum<span class="sc">==</span><span class="st">"B"</span>),</span>
<span id="cb81-685"><a href="#cb81-685" aria-hidden="true" tabindex="-1"></a>    <span class="at">I.C =</span> <span class="fu">as.numeric</span>(inoculum<span class="sc">==</span><span class="st">"C"</span>),</span>
<span id="cb81-686"><a href="#cb81-686" aria-hidden="true" tabindex="-1"></a>    <span class="at">I.D =</span> <span class="fu">as.numeric</span>(inoculum<span class="sc">==</span><span class="st">"D"</span>)</span>
<span id="cb81-687"><a href="#cb81-687" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-688"><a href="#cb81-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-689"><a href="#cb81-689" aria-hidden="true" tabindex="-1"></a>indicator.reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> I.A <span class="sc">+</span> I.B <span class="sc">+</span> I.C <span class="sc">+</span> I.D, </span>
<span id="cb81-690"><a href="#cb81-690" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> alfalfa)</span>
<span id="cb81-691"><a href="#cb81-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-692"><a href="#cb81-692" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(indicator.reg)</span>
<span id="cb81-693"><a href="#cb81-693" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-694"><a href="#cb81-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-695"><a href="#cb81-695" aria-hidden="true" tabindex="-1"></a>Note that this regression allows the treatments to be compared with the control.</span>
<span id="cb81-696"><a href="#cb81-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-697"><a href="#cb81-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-698"><a href="#cb81-698" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 8.5 {-}</span></span>
<span id="cb81-699"><a href="#cb81-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-700"><a href="#cb81-700" aria-hidden="true" tabindex="-1"></a><span class="in">`shade`</span> is a categorical variable of factor codes but let us (incorrectly) treat it as numerical (and if the actual distances are given, then the <span class="in">`distance`</span> variable becomes a covariate). Fit ANCOVA of yield on the <span class="in">`inoculum`</span> factor and <span class="in">`shade`</span> covariate.</span>
<span id="cb81-701"><a href="#cb81-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-702"><a href="#cb81-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-703"><a href="#cb81-703" aria-hidden="true" tabindex="-1"></a>**R:**</span>
<span id="cb81-704"><a href="#cb81-704" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb81-705"><a href="#cb81-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-706"><a href="#cb81-706" aria-hidden="true" tabindex="-1"></a>ancova.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> <span class="fu">as.numeric</span>(shade) <span class="sc">*</span> inoculum, </span>
<span id="cb81-707"><a href="#cb81-707" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> alfalfa)</span>
<span id="cb81-708"><a href="#cb81-708" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ancova.model)</span>
<span id="cb81-709"><a href="#cb81-709" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-710"><a href="#cb81-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-711"><a href="#cb81-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-712"><a href="#cb81-712" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 8.6 {-}</span></span>
<span id="cb81-713"><a href="#cb81-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-714"><a href="#cb81-714" aria-hidden="true" tabindex="-1"></a>In a two-factor experiment, one of the factors was assigned to main plot (main-plot factor), the second factor, called the subplot factor, was assigned into subplots.  The dataset <span class="in">`https://www.massey.ac.nz/~kgovinda/data/plots.RData`</span> gives the experimental set up. Perform the ANOVA for this basic split-plot experiment.</span>
<span id="cb81-715"><a href="#cb81-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-716"><a href="#cb81-716" aria-hidden="true" tabindex="-1"></a>**R:**</span>
<span id="cb81-717"><a href="#cb81-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-718"><a href="#cb81-718" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb81-719"><a href="#cb81-719" aria-hidden="true" tabindex="-1"></a>url1 <span class="ot">&lt;-</span> <span class="st">"https://www.massey.ac.nz/~anhsmith/data/plots.RData"</span></span>
<span id="cb81-720"><a href="#cb81-720" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> url1, <span class="at">destfile =</span> <span class="st">"plots.RData"</span>)</span>
<span id="cb81-721"><a href="#cb81-721" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"plots.RData"</span>)</span>
<span id="cb81-722"><a href="#cb81-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-723"><a href="#cb81-723" aria-hidden="true" tabindex="-1"></a>plots</span>
<span id="cb81-724"><a href="#cb81-724" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-725"><a href="#cb81-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-726"><a href="#cb81-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-727"><a href="#cb81-727" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb81-728"><a href="#cb81-728" aria-hidden="true" tabindex="-1"></a>sp.model <span class="ot">&lt;-</span> <span class="fu">aov</span>(yield <span class="sc">~</span> block <span class="sc">+</span> A<span class="sc">*</span>B <span class="sc">+</span> <span class="fu">Error</span>(block<span class="sc">/</span>A),</span>
<span id="cb81-729"><a href="#cb81-729" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>plots)</span>
<span id="cb81-730"><a href="#cb81-730" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sp.model)</span>
<span id="cb81-731"><a href="#cb81-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-732"><a href="#cb81-732" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-733"><a href="#cb81-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-734"><a href="#cb81-734" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb81-735"><a href="#cb81-735" aria-hidden="true" tabindex="-1"></a><span class="co">#Incorrect model</span></span>
<span id="cb81-736"><a href="#cb81-736" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">aov</span>(yield <span class="sc">~</span> block <span class="sc">+</span> A<span class="sc">*</span>B ,</span>
<span id="cb81-737"><a href="#cb81-737" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>plots))</span>
<span id="cb81-738"><a href="#cb81-738" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-739"><a href="#cb81-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-740"><a href="#cb81-740" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>More R code examples are <span class="co">[</span><span class="ot">here</span><span class="co">](../exercises/Chap8more.R)</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>