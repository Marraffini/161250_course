<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>161250 Data Analysis - Chapter 2: Exploratory Data Analysis (EDA)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../studyguide/3-probability.html" rel="next">
<link href="../studyguide/1-data-collection.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="../site_libs/plotly-binding-4.10.3/plotly.js"></script>
<script src="../site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="../site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="../site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="../site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="../site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">161250 Data Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../slides.html" rel="" target="">
 <span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../studyguide/index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Study Guide</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../workshops/ws01.html" rel="" target="">
 <span class="menu-text">Workshops</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-extra-code" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Extra Code</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-extra-code">    
        <li>
    <a class="dropdown-item" href="../exercises/Chap2more.R" rel="" target="">
 <span class="dropdown-text">Ex2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap3more.R" rel="" target="">
 <span class="dropdown-text">Ex3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap4more.R" rel="" target="">
 <span class="dropdown-text">Ex4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap5more.R" rel="" target="">
 <span class="dropdown-text">Ex5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap6more.R" rel="" target="">
 <span class="dropdown-text">Ex6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap7more.R" rel="" target="">
 <span class="dropdown-text">Ex7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises/Chap8more.R" rel="" target="">
 <span class="dropdown-text">Ex8</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../studyguide/index.html">Study Guide</a></li><li class="breadcrumb-item"><a href="../studyguide/2-eda.html">Chapter 2: Exploratory Data Analysis (EDA)</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../studyguide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Study Guide</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../studyguide/1-data-collection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 1: Data Collection and Quality Issues</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../studyguide/2-eda.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Chapter 2: Exploratory Data Analysis (EDA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../studyguide/3-probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 3: Probability Concepts and Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../studyguide/4-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 4: Statistical Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../studyguide/5-tabulated.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 5: Tabulated Counts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../studyguide/6-single.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 6: Models with a Single Continuous Predictor</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../studyguide/7-multiple.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 7: Models with Multiple Continuous Predictors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../studyguide/8-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 8: Analysis of Variance (ANOVA) and Covariance (ANCOVA)</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-two-modes-of-data-analysis" id="toc-the-two-modes-of-data-analysis" class="nav-link active" data-scroll-target="#the-two-modes-of-data-analysis">The two modes of data analysis</a></li>
  <li><a href="#the-basics-of-exploratory-data-analysis" id="toc-the-basics-of-exploratory-data-analysis" class="nav-link" data-scroll-target="#the-basics-of-exploratory-data-analysis">The basics of Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#error-checking" id="toc-error-checking" class="nav-link" data-scroll-target="#error-checking">Error checking</a></li>
  <li><a href="#understanding-data" id="toc-understanding-data" class="nav-link" data-scroll-target="#understanding-data">Understanding data</a></li>
  </ul></li>
  <li><a href="#categorical-data" id="toc-categorical-data" class="nav-link" data-scroll-target="#categorical-data">Categorical Data</a>
  <ul class="collapse">
  <li><a href="#bar-chart" id="toc-bar-chart" class="nav-link" data-scroll-target="#bar-chart">Bar chart</a></li>
  <li><a href="#pie-charts" id="toc-pie-charts" class="nav-link" data-scroll-target="#pie-charts">Pie charts</a></li>
  </ul></li>
  <li><a href="#numerical-data" id="toc-numerical-data" class="nav-link" data-scroll-target="#numerical-data">Numerical Data</a>
  <ul class="collapse">
  <li><a href="#dotplot" id="toc-dotplot" class="nav-link" data-scroll-target="#dotplot">Dotplot</a></li>
  <li><a href="#histograms" id="toc-histograms" class="nav-link" data-scroll-target="#histograms">Histograms</a></li>
  <li><a href="#theoretical-distributions" id="toc-theoretical-distributions" class="nav-link" data-scroll-target="#theoretical-distributions">Theoretical Distributions</a></li>
  </ul></li>
  <li><a href="#summary-statistics-and-their-display" id="toc-summary-statistics-and-their-display" class="nav-link" data-scroll-target="#summary-statistics-and-their-display">Summary Statistics and their display</a>
  <ul class="collapse">
  <li><a href="#symmetry-plots" id="toc-symmetry-plots" class="nav-link" data-scroll-target="#symmetry-plots">Symmetry plots</a></li>
  <li><a href="#box-plots" id="toc-box-plots" class="nav-link" data-scroll-target="#box-plots">Box plots</a></li>
  <li><a href="#letter-value-plots" id="toc-letter-value-plots" class="nav-link" data-scroll-target="#letter-value-plots">Letter-value plots</a></li>
  </ul></li>
  <li><a href="#cumulative-frequency-graph-and-quantiles" id="toc-cumulative-frequency-graph-and-quantiles" class="nav-link" data-scroll-target="#cumulative-frequency-graph-and-quantiles">Cumulative Frequency Graph and Quantiles</a>
  <ul class="collapse">
  <li><a href="#quantile-quantile-q-q-plot" id="toc-quantile-quantile-q-q-plot" class="nav-link" data-scroll-target="#quantile-quantile-q-q-plot">Quantile-Quantile (Q-Q) Plot</a></li>
  </ul></li>
  <li><a href="#comparing-several-groups-of-data" id="toc-comparing-several-groups-of-data" class="nav-link" data-scroll-target="#comparing-several-groups-of-data">Comparing Several Groups of Data</a>
  <ul class="collapse">
  <li><a href="#exploring-relationships" id="toc-exploring-relationships" class="nav-link" data-scroll-target="#exploring-relationships">Exploring relationships</a>
  <ul class="collapse">
  <li><a href="#scatterplots-and-correlation-coefficients" id="toc-scatterplots-and-correlation-coefficients" class="nav-link" data-scroll-target="#scatterplots-and-correlation-coefficients">Scatterplots and Correlation Coefficients</a></li>
  <li><a href="#scatterplot-and-correlation-matrices" id="toc-scatterplot-and-correlation-matrices" class="nav-link" data-scroll-target="#scatterplot-and-correlation-matrices">Scatterplot and correlation Matrices</a></li>
  <li><a href="#exploring-bivariate-distributions" id="toc-exploring-bivariate-distributions" class="nav-link" data-scroll-target="#exploring-bivariate-distributions">Exploring bivariate distributions</a></li>
  </ul></li>
  <li><a href="#higher-dimensional-data" id="toc-higher-dimensional-data" class="nav-link" data-scroll-target="#higher-dimensional-data">Higher dimensional data</a></li>
  </ul></li>
  <li><a href="#time-series-eda" id="toc-time-series-eda" class="nav-link" data-scroll-target="#time-series-eda">Time series EDA</a>
  <ul class="collapse">
  <li><a href="#autocorrelation" id="toc-autocorrelation" class="nav-link" data-scroll-target="#autocorrelation">Autocorrelation</a></li>
  <li><a href="#time-series-components-of-variation" id="toc-time-series-components-of-variation" class="nav-link" data-scroll-target="#time-series-components-of-variation">Time Series Components of Variation</a>
  <ul class="collapse">
  <li><a href="#trend" id="toc-trend" class="nav-link" data-scroll-target="#trend">Trend</a></li>
  <li><a href="#seasonal" id="toc-seasonal" class="nav-link" data-scroll-target="#seasonal">Seasonal</a></li>
  <li><a href="#error" id="toc-error" class="nav-link" data-scroll-target="#error">Error</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="2-eda.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Chapter 2: Exploratory Data Analysis (EDA)</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<blockquote class="blockquote">
<p><em>“Data has no meaning apart from its context.”</em><br> — Walter A Shewhart</p>
</blockquote>
<blockquote class="blockquote">
<p><em>Sherlock Holmes: “How do all these unusuals strike you, Watson?”</em><br> <em>Dr.&nbsp;Watson: “Their cumulative effect is certainly considerable,and yet each of them is quite possible in itself”</em><br> — Sir Arthur Conan Doyle, <em>The Adventure of the Abbey Grange</em></p>
</blockquote>
<section id="the-two-modes-of-data-analysis" class="level1">
<h1>The two modes of data analysis</h1>
<p>Exploratory Data Analysis (EDA) is exactly as it sounds: the process of exploring a data set, usually by visual examination, calculating summary statistics, and making tables and graphical displays. Exploratory analysis was likened to detective work by John <span class="citation" data-cites="tukey1977">Tukey (<a href="#ref-tukey1977" role="doc-biblioref">1977</a>)</span> in his seminal book. As in a detective story, the circumstances surrounding a crime can be accidental; it is important to keep in mind that not all patterns that you see in a sample data set will reflect true patterns in the population.</p>
<p>When analysing data, it is important to keep front of mind the purpose of the analysis. One can distinguish between the following two broad modes of analysis:</p>
<ul>
<li><p><strong>Exploratory</strong> or <strong>hypothesis-generating analyses</strong> are about <em>discovering new patterns</em>. Such analyses are typically rather unstructured exploration by summarising data and making tables and graphs, without any preconceived ideas about what might be found. The purpose is often to produce better understanding of a system, and is a good way of generating new hypotheses that can be tested with subsequent data/experiments.</p></li>
<li><p><strong>Confirmatory</strong> or <strong>inferential</strong> or <strong>hypothesis-testing analyses</strong> are about <em>testing a priori ideas</em>. The ideas about what patterns would be present in the data were known to the analyst <em>prior to seeing the data</em>, often in accordance with some scientific theory about the mechanistic processes in the system under study. These analyses often take the form of fitting statistical models and performing formal hypothesis tests, and evaluating evidence for particular effects.</p></li>
</ul>
<p>Here’s the important part: one must no report an exploratory analysis as though it was a confirmatory analysis. In other words, if an exploratory data analysis leads you to a new scientific hypothesis, do not report this as though it were an <em>a priori</em> hypothesis that you then tested with those data. This is scientifically dishonest and is a major contributor to the replication crisis in science <span class="citation" data-cites="ioannidis_why_2005">(<a href="#ref-ioannidis_why_2005" role="doc-biblioref">Ioannidis 2005</a>)</span>. Taking a hypothesis that occurred to you after seeing patterns in the data, and <em>using that same data to test that hypothesis</em>, is a form of circular reasoning. The strength of any evidence obtained in this way is much weaker than if one tests a bona fide <em>a priori</em> hypothesis.</p>
<p>To address the issue of testing hypotheses with the same data that generated them, scientists are increasingly encouraged to publically <em>preregister</em> their scientific hypotheses before the data are even collected <span class="citation" data-cites="nosek_preregistration_2018">(<a href="#ref-nosek_preregistration_2018" role="doc-biblioref">Nosek et al. 2018</a>)</span>. This guarantees that there was no “data snooping” for patterns prior to hypothesis testing.</p>
<p>So, if you have any <em>a priori</em> ideas and hypotheses about what patterns you might see in the data (e.g., the mean of <span class="math inline">\(y\)</span> will be higher for group <span class="math inline">\(A\)</span> than group <span class="math inline">\(B\)</span>), before you look at or even collect the data, it is wise to write them down or, better still, formally preregister them. This will help clarify the purpose of the analysis, and reduce the risk of misrepresenting your results.</p>
<p>From the <a href="https://www.cos.io/initiatives/prereg">Center for Open Science website</a>:</p>
<blockquote class="blockquote">
<p>Preregistration separates <em>hypothesis-generating</em> (exploratory) from <em>hypothesis-testing</em> (confirmatory) research. Both are important. But the same data cannot be used to generate and test a hypothesis, which can happen unintentionally and reduce the credibility of your results. Addressing this problem through planning improves the quality and transparency of your research. This helps you clearly report your study and helps others who may wish to build on it. For instructions on how to submit a preregistration on OSF, please visit our help guides.</p>
</blockquote>
<p><img src="../img/confexpl.png" class="img-fluid"></p>
<p>Of course, <em>hypothesis-generating</em> (exploratory) and <em>hypothesis-testing</em> (confirmatory) modes of analysis are by no means mutually exclusive. Calculating summary statistics and making tables and plots are an important part of inferential analyses, and one can use inferential statistics (e.g., confidence intervals) to summarise patterns seen in exploratory analyses.</p>
<p>See <a href="https://statmodeling.stat.columbia.edu/2022/09/06/exploratory-and-confirmatory-data-analysis/">this blog post</a> by Andrew Gelman for more on how the two modes fit together.</p>
</section>
<section id="the-basics-of-exploratory-data-analysis" class="level1">
<h1>The basics of Exploratory Data Analysis</h1>
<p>Following <span class="citation" data-cites="Chatfield">Chatfield (<a href="#ref-Chatfield" role="doc-biblioref">1995</a>)</span>, here are some guidelines for tackling statistical analyses.</p>
<ol type="1">
<li><p>Make sure you understand the structure of the data, including what was measured, how, and why.</p></li>
<li><p>Write down the purpose of the analysis in the form of aims, research questions, and/or hypotheses, and make a plan for how to test any formal hypotheses, including evaluating the validity of assumptions.</p></li>
<li><p>Critically examine the data to check for errors, inconsistencies, and mismatches with the structure of the data as you understand it.</p></li>
<li><p>Explore the data with summary statistics, tables, and plots.</p></li>
<li><p>Conduct any inferential statistical analyses. Use statistics, tables, and plots to</p>
<ol type="a">
<li>check the assumptions of the analysis and</li>
<li>summarise the results.</li>
</ol></li>
<li><p>Be honest and use common sense.</p></li>
</ol>
<p>As discussed in Chapter 1, one must be congnisant to how the data were collected and any sampling biases that may be present. What is the population of interest, and is the sample representative of that population? Were the methods of recording the data accurate? Finally, what exactly does each variable represent? Are the variables contained in the data direct measurements of the variable of interest, or merely convenient surrogates?</p>
<section id="error-checking" class="level2">
<h2 class="anchored" data-anchor-id="error-checking">Error checking</h2>
<p>The data are assumed to be in some sort of electronic form; e.g.&nbsp;text file, spreadsheet, database, etc. Before analysing the data, it is prudent to check for mistakes in the data. If one has access to the raw data (e.g.&nbsp;returned questionnaires), one can check observations by hand. If the raw data are not available, then the best one can do is to look for observations whose values are out of allowable ranges, or are very suspicious. A common problem occurs with the coding of missing information. Missing values are commonly recorded as a blank, <code>*</code>, <code>-1</code>, <code>-999</code>, or <code>NA</code>. Only one type of coding should be used. The use of <code>NA</code> is preferred since this is easier to spot. The use of blanks is particularly dangerous when one is exporting data from a spreadsheet to a text file. When the data from the text file is read into a computer package, a missing value may be skipped and the value from the next observation read in its place. When the data set is large, looking at a data set one observation at a time may not be feasible. In this case, plotting the data may show any observations with illegal values.</p>
</section>
<section id="understanding-data" class="level2">
<h2 class="anchored" data-anchor-id="understanding-data">Understanding data</h2>
<p>After any data errors have been found and corrected, the data understanding stage commences. This stage involves tabulating, summarising, and plotting the data in many ways to gain insight into the data set. We typically want to:</p>
<ul>
<li>examine the distributions, or shapes, of individual variables;</li>
<li>compare different groups of data, with special emphasis on location and scale;</li>
<li>and discover any trends and relationships exhibited between pairs of variables.</li>
</ul>
<p>Again, don’t fall into the trap of <strong>data snooping</strong>, where you develop and test hypotheses with the same data. For instance, suppose that boxplots of the income of individuals in different age groups show that youngest and oldest age groups are the most different. If one elects to perform the hypothesis test for the difference between these two groups based on observations made during EDA, the resulting <span class="math inline">\(p\)</span>-value is not valid.</p>
<p>In the sections below, we briefly review many common tools used to visualise data during EDA.</p>
</section>
</section>
<section id="categorical-data" class="level1">
<h1>Categorical Data</h1>
<p>There are many methods for examining categorical variables. We will explore several methods, including tables, bar charts, dot plots, and pie charts. These tools are covered in foundation courses and hence we will briefly review them.</p>
<section id="bar-chart" class="level2">
<h2 class="anchored" data-anchor-id="bar-chart">Bar chart</h2>
<p>The rules for constructing a bar chart are very simple and perhaps they can be reduced to a single rule and that is to make the <em>height of each bar proportional to the quantity displayed</em>. Consider the dataset <strong>Snodgrass</strong> available in the <code>R</code> package <code>archdata</code>. This dataset contains information on the size, location and contents of 91 house pits at the Snodgrass site which was occupied between about CE 1325-1420. The variable names and their description are given below:</p>
<ul>
<li><code>East</code>: East grid location of house in feet (excavation grid system)</li>
<li><code>South</code>: East grid location of house in feet (excavation grid system)</li>
<li><code>Length</code>: House length in feet</li>
<li><code>Width</code>: House width in feet<br>
</li>
<li><code>Segment</code>: Three areas within the site 1, 2, 3<br>
</li>
<li><code>Inside</code>: Location within or outside the “white wall” Inside, Outside<br>
</li>
<li><code>Area</code>: Area in square feet<br>
</li>
<li><code>Points</code>: Number of projectile points<br>
</li>
<li><code>Abraders</code>: Number of abraders<br>
</li>
<li><code>Discs</code>: Number of discs<br>
</li>
<li><code>Earplugs</code>: Number of earplugs<br>
</li>
<li><code>Effigies</code>: Number of effigies<br>
</li>
<li><code>Ceramics</code>: Number of ceramics<br>
</li>
<li><code>Total</code>: Total Number of artifacts listed above<br>
</li>
<li><code>Types</code>: Number of kinds of artifacts listed above</li>
</ul>
<p>The data from 91 house pits at the Snodgrass site were reported by Price and Giffin in 1979. The layout of the houses follows a grid pattern with the long axis oriented north-east surrounded by a fortification trench. There is also evidence of an interior wall that may have separated the houses inside that wall from those outside the wall. Price and Griffin use differences in house size and artifacts composition to suggest that those distinctions may have reflected rank differences between the occupants of the two areas.</p>
<p>The distribution of number of Ceramics found can be displayed in the form of a bar chart; see <a href="#fig-barchart">Figure&nbsp;1</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Snodgrass, <span class="at">package =</span> <span class="st">"archdata"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>Snodgrass <span class="sc">|&gt;</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Ceramics) <span class="sc">+</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-barchart" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-barchart-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Bar Chart of Ceramics counts</figcaption>
</figure>
</div>
</div>
</div>
<p>The bar graph illustrates clearly that no ceramics were found in many houses but a lot were found in a few houses. This may be due to status and wealth of the occupants.</p>
<p>Note that we are treating number of Ceramics as ordinal in the above graph. For nominal data software tend to order the categories alphabetically.</p>
<p>However, a graph is not always the best way to display a small set of numbers. Graphs do have some disadvantages: they take up a lot of space, and they do not usually allow the recovery of the exact observations. For these reasons, particularly for a small data sets, a table is sometimes more effective. There were only three segment categories; and their counts can be simply displayed as a table.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Snodgrass<span class="sc">$</span>Segment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 1  2  3 
38 28 25 </code></pre>
</div>
</div>
<p>It would be interesting to see whether the discovery of ceramics is Segment dependent. In other words, we would like to explore two factors in display. This can be done in many ways (<a href="#fig-barcharts">Figure&nbsp;2</a>).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Snodgrass, <span class="at">package =</span> <span class="st">"archdata"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Ceramics, <span class="at">fill =</span> Segment) <span class="sc">+</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Bar plot with colour grouping"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span> </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Ceramics) <span class="sc">+</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span> </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="fu">vars</span>(Segment)) <span class="sc">+</span> </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Segment-wise Bar plots"</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Ceramics, <span class="at">fill =</span> Segment) <span class="sc">+</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Clustered Barplot"</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>Ceramics, <span class="at">fill =</span> Segment) <span class="sc">+</span> </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Clustered Bar plot - flipped"</span>) <span class="sc">+</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>()</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, p3, p4, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-barcharts" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-barcharts-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Bar Chart of Ceramics counts by Segment</figcaption>
</figure>
</div>
</div>
</div>
<p>It is easy to spot that the Ceramics findings were largely from the first segment. This EDA conclusion can be drawn from all of the above plots. However, these bar plots do not rate the same as a “presentation style graphic”.</p>
<p>Tufte (2001) argues in favour of certain principles of graphical integrity for presentation style graphics. These are:</p>
<ol type="1">
<li><p>The representation of numbers in a graph should be directly proportional to the numbers themselves;</p></li>
<li><p>Clear and detailed labels should be used to prevent ambiguity;</p></li>
<li><p>Provide explanations and important events pertaining to data on the graphic itself;</p></li>
<li><p>The graph should display data variation, not design variation—visual changes in the graph should be due to the data, not changes in way the data are drawn;</p></li>
<li><p>The number of dimensions used in the graph should not exceed the number of dimensions in the data;</p></li>
<li><p>Graphs must not quote data out of context; for example, a monthly drop in the murder rate of a city should be plotted within the context of the murder rate over the last few years, or murder rates in comparable cities over the same period.</p></li>
</ol>
<p>A final point concerns the use of colour. In many sorts of graphs, data types are differentiated by the use of colour. This practice is perfectly legitimate, but one should be aware that a surprising proportion of people have impaired colour perception, such as being unable to distinguish between red and green (see <a href="https://cran.r-project.org/web/packages/colorBlindness/vignettes/colorBlindness.html">here</a> for colourblind-friendly pallettes). A remedy to these problems is to use different plotting symbols, line types, or shading, in conjunction with different colours. One should always make sure that the colours selected are clearly visible in the medium in which they are presented. Colours on a computer monitor can appear quite different when projected onto a screen in a lecture theatre, or when printed onto paper.</p>
<p>According to <span class="citation" data-cites="Tufte2001">Tufte (<a href="#ref-Tufte2001" role="doc-biblioref">2001</a>)</span>, a good graphical display should:</p>
<ol type="1">
<li><p>Display the data;</p></li>
<li><p>Encourage the viewer to concentrate on the substance of the data, in the context of the problem, not on the artistic merits of the graph;</p></li>
<li><p>Avoid distorting, intentionally or unintentionally, what the data have to say;</p></li>
<li><p>Have a high data to ink ratio; that is, convey the greatest amount of information in the shortest time with the least ink in the smallest space;</p></li>
<li><p>Enable one to easily compare different pieces of data;</p></li>
<li><p>Reveal overall trends and patterns in the data that are not obvious from viewing the raw numbers;</p></li>
<li><p>Reveal detailed information secondary to the main trend; for example, the location of outliers, variability of the response.</p></li>
</ol>
<p>This Chapter is largely concerned with EDA for discovery of patterns and peculiarities in a dataset. So we will not be too worried if the graphs produced are not aesthetically pleasing or does not meet a particular standard for a presentation style graph.</p>
<p>The end goal of most analyses is of course some form of written report or presentation. In either case, the findings of the study, should be supported by tables and graphs created during the EDA; these should clarify and support the final conclusions, not deceive or confuse the audience. One should refrain from showing all tables and plots that were created, but rather a careful selection that reinforces the main findings. The remaining figures can, if necessary, be placed in an appendix of the written report. The figures and tables that are shown should be well labelled and annotated. Abbreviations and cryptic variable names should be replaced by sensible labels and descriptions. The emphasis should be on conveying information rather than producing an eye catching plot. Special care should be taken to ensure that the table or graph cannot be easily misinterpreted.</p>
<p>In addition, a poorly made graph can be deceptive. This is a problem both in the understanding the data phase, and the presenting the data phase. One common mistake (but by no means the only one) in creating a graph is to use more dimensions to represent the data than there are data dimensions. For example, it is not uncommon to see a bar chart where the bars are drawn as three dimensional rectangular prisms. The false perspective actually obscures the differences in the heights of the bars.</p>
<p>Another pitfall is to use a clever graphic rather than one that clearly presents the data. The classic example of this is a pictogram, where pictures of varying size represent some quantities. Pictograms are often drawn dishonestly: to show a two-fold difference, each side of the picture is increased by a factor of two, so the area is in fact increased by a factor of four. Dishonesty in data presentation is clearly unacceptable. But even an honest pictogram is usually not the best way to present data. It is difficult to accurately judge differences between areas; which is what a pictogram asks the viewer to do.</p>
</section>
<section id="pie-charts" class="level2">
<h2 class="anchored" data-anchor-id="pie-charts">Pie charts</h2>
<p>Pie charts are a popular, though usually rather poor, way of presenting data. Like bar charts, they frequently use a large figure to represent just a few numbers. Pie charts also have a poor accuracy of decoding. That means people’s impression of the difference in size between two pie slices is often quite different from the actual difference in size. Pie charts use angles to represent percentages; people tend to underestimate the size of acute angles and overestimate the size of obtuse angles (Stevens, 1957). The exploded pie chart makes it more difficult to accurately compare pie slices: the exploded piece always appears bigger. The three dimensional pie chart is even worse. Bar charts, dot charts, or tables should be preferred to pie charts.</p>
<p>Count summaries of two categorical variables can be displayed in the form of a mosaic plot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Snodgrass<span class="sc">$</span>Inside, Snodgrass<span class="sc">$</span>Earplugs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         
           0  1  2  3  4
  Inside  21 10  5  1  1
  Outside 50  2  0  1  0</code></pre>
</div>
</div>
<p><a href="#fig-mosaic">Figure&nbsp;3</a> shows the above tabulated counts graphically. Evidently, greater number of earplugs were found outside than inside.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">table</span>(Snodgrass<span class="sc">$</span>Inside, Snodgrass<span class="sc">$</span>Earplugs)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(tab, <span class="at">main=</span><span class="st">"Inside*Earplugs counts"</span>, <span class="at">ylab=</span><span class="st">"Earplugs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-mosaic" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-mosaic-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3: A mosaic plot</figcaption>
</figure>
</div>
</div>
</div>
<p>The <code>R</code> package <code>vcd</code> can produce many other types of plots for categorical variables but these plots require an understanding of models fitted to categorical data. <a href="#fig-vcd1">Figure&nbsp;4</a> displays the counts in a different way (and ignore the P value displayed in the plot). The test of association topic is covered later on.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: grid</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assoc</span>(tab, <span class="at">shade=</span><span class="cn">TRUE</span>, <span class="at">legend=</span><span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-vcd1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-vcd1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4: Association plot</figcaption>
</figure>
</div>
</div>
</div>
<p>Spine plots are a special cases of mosaic plots that mimics stacked bar plots; Try-.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spine</span>(tab) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-vcd2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-vcd2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5: Spine plot</figcaption>
</figure>
</div>
</div>
</div>
<p>A doubledecker plot is used to handle many factors. These plots become harder to interpret when the number of categorical factor levels becomes large; Try-</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">doubledecker</span>(Effigies<span class="sc">~</span>Inside<span class="sc">+</span>Segment,  <span class="at">data=</span>Snodgrass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-ddker" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-ddker-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;6: Doubledecker plot</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="numerical-data" class="level1">
<h1>Numerical Data</h1>
<section id="dotplot" class="level2">
<h2 class="anchored" data-anchor-id="dotplot">Dotplot</h2>
<p>One of the simplest kinds of graph for a numerical variable is the single line (or one dimensional) graph. Each observation is represented by a point (or a star <code>*</code> or a dot <code>.</code>) on the line. These graphs can be useful to see the rough distribution and gaps, if any, in the data. <a href="#fig-dot1">Figure&nbsp;7</a> shows a dotplot of Length of the house pits for the Inside and Outside groupings. Evidently privileged tribes lived inside in general, and the length of their dwellings is longer.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>Inside, <span class="at">y=</span>Length) <span class="sc">+</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dotplot</span>(<span class="at">binaxis=</span><span class="st">'y'</span>, <span class="at">dotsize=</span>.<span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-dot1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-dot1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;7: A typical dot plot for two groups</figcaption>
</figure>
</div>
</div>
</div>
<p>On reflection, the one dimensional dotplot gives rise to a second dimension wherever observations are identical or nearly the same. In a dotplot such points are usually stacked. As our eyes tend to pick up trends very easily, they tend to be distracted by the vertical changes. The main problem here is that some of the values which coincide by chance may be taken to represent real increases in density. To overcome this we try ‘jiggling’ or jittering the data, which is equivalent to plotting a random number on the vertical axis against the data values on the horizontal axis. It is suggested that the vertical jiggle be restricted to a small range so that the overall effect is that of a one-dimensional spread with greater, or lesser, density of points along the graph. <a href="#fig-dot2">Figure&nbsp;8</a> shows a jiggled dotplot. You can decide for yourself which strategy is better.</p>
<p>Clearly, the use of jiggling is much more relevant for larger sets of data. Notice that with jiggling we are interested in the relative density of the graph in different places rather than in trends.</p>
<p>As the vertical reading is determined at random our eyes may be distracted by a seeming trend which is mainly due to this randomness. For this reason, it is helpful to try more than one plot with different jiggles. This is in the spirit of EDA, in which data is viewed from as many angles as is feasible. The other side of this coin is that conclusions from one display of data should be treated with some scepticism. The availability of computers allows data to be plotted, tabulated and transformed quickly, so we should look at it several ways to better appreciate the peculiarities inherent in our data.</p>
<p>In practice, one tends to avoid jiggling except in (two-variable) scatter plots where there are many repeated <span class="math inline">\((x, y)\)</span> points. Graphs with a jiggle are mainly needed when the data are discrete or grouped in some way, or there are a large number of points to be plotted.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dot2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-dot2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;8: A jittered dot plot</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="histograms" class="level2">
<h2 class="anchored" data-anchor-id="histograms">Histograms</h2>
<p>The histogram is a standard method of showing the distribution of a quantitative variable. A histogram is made by dividing the range of a variable into “bins” and counting the number of data points that fall within each bin. It is like a bar chart after forcing a quantitative variable into bins. It can be used for discrete ungrouped data, but a bar chart is generally more suitable for discrete data because histograms can mislead the reader into thinking that values exist other than at the centre of the intervals.</p>
<p><a href="#fig-hist1">Figure&nbsp;9</a> shows the histogram of <code>Length</code>. Clearly the distribution is far from symmetric and left skewed. The bimodal pattern also suggests subgrouping.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Length) <span class="sc">+</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">12</span>, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color=</span><span class="st">"black"</span>, </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill=</span><span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-hist1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-hist1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;9: A typical histogram</figcaption>
</figure>
</div>
</div>
</div>
<p>Notice that a different shape of histogram may result depending on the class intervals (bins) used (that is by choosing different class widths or different midpoints of the classes). This suggests that it may be wise to draw more than one histogram for a given data set particularly if statements are to be made about modes or gaps in the data. The guideline for the maximum number of intervals, <span class="math inline">\(L\)</span>, can follow the same formula as for stem-and-leaf displays. Some software use the <span class="citation" data-cites="Sturges">Sturges (<a href="#ref-Sturges" role="doc-biblioref">1926</a>)</span> formula namely <span class="math display">\[\texttt{bin width} = \frac {\texttt{range}(x)} {\log_2(n)+1}.\]</span> For fixing the width of the bins, the range of the data is divided by the sum of one and the base two logarithm of the sample size.</p>
<p>There are a few ways to scale the y-axis of a histogram, as shown in <a href="#fig-threehist">Figure&nbsp;10</a>:</p>
<ol type="a">
<li><p><strong>Frequency histograms</strong> show the counts in each bin; the heights of the bars sum to <span class="math inline">\(n\)</span>.</p></li>
<li><p><strong>Relative frequency histograms</strong> show the proportions or percent of data in each bin—the counts in each bin divided by the total; the heights sum to 1 or 100%.</p></li>
<li><p><strong>Density histograms</strong> show the densities; the areas (heights <span class="math inline">\(\times\)</span> widths) of the bars sum to 1.</p></li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span>  Snodgrass <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Length) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"(a) Frequency histogram"</span>, </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Heights of the bars sum to n"</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span>  Snodgrass <span class="sc">|&gt;</span> </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Length) <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">bins =</span> <span class="dv">20</span>, </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(count <span class="sc">/</span> <span class="fu">sum</span>(count)))</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"(b) Relative frequency histogram"</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Heights sum to 100%"</span>) <span class="sc">+</span> </span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span>  Snodgrass <span class="sc">|&gt;</span> </span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Length) <span class="sc">+</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">bins =</span> <span class="dv">20</span>, </span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(density))) <span class="sc">+</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span> </span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"(c) Density histogram"</span>,</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Heights x widths sum to 1"</span>)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-threehist" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-threehist-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption class="figure-caption">Figure&nbsp;10: Three types of histograms</figcaption>
</figure>
</div>
</div>
</div>
<p>If, instead of drawing blocks over the class intervals as in a histogram, we join the mid points of the tops of the bars, we obtain a display known as a <strong>frequency polygon</strong> . If we use relative frequencies, it is a <strong>relative frequency polygon</strong>; see <a href="#fig-hist3">Figure&nbsp;11</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Length, <span class="at">y =</span> <span class="fu">after_stat</span>(density)) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>( <span class="at">bins =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-hist3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-hist3-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;11: A typical frequency polygon</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-hist3a">Figure&nbsp;12</a> shows a kernel density plot, which is a method that produces a smoother density line.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>Snodgrass <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(Length) <span class="sc">+</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rug</span>(<span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">colour =</span> <span class="st">"darkorange2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-hist3a" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-hist3a-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;12: A typical smoothed density curve</figcaption>
</figure>
</div>
</div>
</div>
<p>Kernel Density Estimation (KDE) is generated by dropping a little mini-distribution, usually a normal curve, on each individual point and summing them up (<a href="#fig-kdegif">Figure&nbsp;13</a>).</p>
<div id="fig-kdegif" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../img/kde.gif" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13: A demonstration of kernel density estimation</figcaption>
</figure>
</div>
<p>These smooth plots are also useful to see the type of skewness involved, multimodality (several peaks) and unusual observations (or outliers). The disadvantage is that we may over-smooth and mask some of the subgrouping patterns; see <a href="#fig-hist4">Figure&nbsp;14</a>. Even though the two distributions appear to be similar, the length distribution for the Inside group has a larger mean/median etc (called the location parameters).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>Snodgrass <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Length, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> Inside) <span class="sc">+</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-hist4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-hist4-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;14: Identification of Subgrouping</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="theoretical-distributions" class="level2">
<h2 class="anchored" data-anchor-id="theoretical-distributions">Theoretical Distributions</h2>
<p>A histogram gives a general picture of the frequencies or relative frequencies of the data. If an observation is taken at random from the population from which the sample was drawn, the chance of it falling in any one of the class intervals should be approximately proportional to the area of the block over that interval (not exactly proportional because the histogram was only based on a sample from the population, not the population itself).</p>
<p>If we could draw a histogram for the whole population, then the probabilities would be exact. The relative frequencies form a probability distribution and if the class intervals are small enough the tops of the bars of the histogram would often approximate a smooth curve such as the density plot. In many cases this smooth curve is almost symmetrical with a rounded peak at the centre. One particular shape, fitting a certain mathematical formula, is a very good approximation to many sets of data. For instance, heights of people, weights of animals or yields of wheat all follow this distribution fairly well (although theoretically the distribution has an infinite range of possible values). One of the widely used <em>theoretical</em> distribution is called the <em>Normal</em> or <em>Gaussian</em> distribution but we will not bore you with its formula. However, most software can compute the tail areas (probabilities) under theoretical distributions. We shall study this distribution in greater detail in a Chapter 3. For the moment let us note that our EDA techniques should provide us with information about the parameters of the distribution, and we also want graphical techniques that display the continuous nature of the data.</p>
<p>Discrete data also have probability distributions and the bar graph gives a general picture of its shape. One commonly occurring discrete theoretical distribution is known as the <strong>Poisson distribution</strong> and approximates reasonably well the numbers of road accidents over a fixed time period. The main feature of a Poisson distribution is that there is a peak at the nearest integer below or equal to the average, and then a steady falling off. The mean is a parameter of the model, so we want our exploratory techniques to tell us about the mean, and to help us decide whether or not the Poisson model is appropriate for a given set of data. Theoretically, possible values are any whole positive numbers, but large numbers of accidents are very unlikely. Again, any graphical method we use must properly display the discrete nature of Poisson data. The other commonly adopted discrete distribution is the binomial distribution. This distribution is valid when the individual outcomes are classified into two categories such as Success and Failure.</p>
</section>
</section>
<section id="summary-statistics-and-their-display" class="level1">
<h1>Summary Statistics and their display</h1>
<p>For a small to moderate size batch of numbers, the stem-and-leaf display may reveal at a glance all of the peculiarities in the data. However it is useful, particularly for large batches, to calculate some statistics which capture the main features of the data. These are called <strong>summary statistics</strong> and they help us to gain an overall picture without being distracted by some individual peculiarities. You must be familiar with the common summary statistics such as mean, median, standard deviation etc.</p>
<p>The <code>R</code> default function <code>summary()</code> gives the mean, median, lower and upper quartiles, minimum, and maximum for a variable) as well as for a dataframe) For the length variable in our <em>Snodgrass</em> dataset, we obtain this default summary as</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Snodgrass<span class="sc">$</span>Length)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   4.00   13.00   14.50   15.07   17.75   21.00 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Try summary(Snodgrass)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We need used <code>R</code> functions such as <code>sd()</code> to obtain the standard deviation etc. Packages such as <code>psych</code> contain functions to get enhanced summaries. Try</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(Snodgrass<span class="sc">$</span>Length)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">describeBy</span>(Snodgrass<span class="sc">$</span>Length, <span class="at">group=</span>Snodgrass<span class="sc">$</span>Inside)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For EDA purposes, <span class="citation" data-cites="tukey1977">Tukey (<a href="#ref-tukey1977" role="doc-biblioref">1977</a>)</span> suggested to generate further positional summaries using the concept of median. The sorted (smallest to largest) Length data from the <em>Snodgrass</em> dataset was presented earlier for discussing the stem plot. In total <span class="math inline">\(n = 91\)</span> house pits were present, so that the <strong>median</strong> Length is the <span class="math inline">\(46^{\text th}\)</span> value and equals 14.5. Notice that the median is in the middle of the distribution having 45 points on either side.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(Snodgrass<span class="sc">$</span>Length)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14.5</code></pre>
</div>
</div>
<section id="symmetry-plots" class="level2">
<h2 class="anchored" data-anchor-id="symmetry-plots">Symmetry plots</h2>
<p>A symmetry plot is based on the distance of left and right side points. If the underlying distribution is symmetric, the points on the left and right side would be roughly equidistant from the median. For the length data, we obtain the symmetry plot after writing a little <code>R</code> function as follows:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>symmetryplot <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(ggplot2)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(x)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">length</span>(x) <span class="sc">%/%</span> <span class="dv">2</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  sx <span class="ot">&lt;-</span> <span class="fu">sort</span>(x)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  dfm <span class="ot">&lt;-</span> <span class="fu">tibble</span>( </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> <span class="fu">median</span>(x) <span class="sc">-</span> sx[<span class="dv">1</span><span class="sc">:</span>m], </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Y =</span> <span class="fu">rev</span>(sx)[<span class="dv">1</span><span class="sc">:</span>m] <span class="sc">-</span> <span class="fu">median</span>(x)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  dfm <span class="sc">|&gt;</span> </span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>X, <span class="at">y=</span>Y)) <span class="sc">+</span> </span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>X, <span class="at">y=</span>X)) <span class="sc">+</span> </span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Distance below median"</span>) <span class="sc">+</span> </span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Distance above median"</span>)</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">symmetryplot</span>(Snodgrass<span class="sc">$</span>Length)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="2-eda_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The points do not follow the <span class="math inline">\(45^\circ\)</span> line where <span class="math inline">\(Y=X\)</span>; divergence from this line indicates a lack of symmetry.</p>
<p>If each half of the distribution is further divided in halves, we obtain the <strong>fourths</strong> or( <strong>hinges</strong>), as the medians for the lower and upper halves. The end points, the minimum and the maximum are called the lower and upper <strong>extreme</strong> values, respectively.</p>
<p>The <code>R</code> function obtains the set (minimum, lower hinge, median, upper hinge, maximum) in its function <code>fivenum</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Five number summary</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fivenum</span>(Snodgrass<span class="sc">$</span>Length)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  4.00 13.00 14.50 17.75 21.00</code></pre>
</div>
</div>
</section>
<section id="box-plots" class="level2">
<h2 class="anchored" data-anchor-id="box-plots">Box plots</h2>
<p>A <strong>boxplot</strong> (or sometimes a <em>box-and-whisker plot</em>) is a visual display of the five-number summary, which can be used to assess the skew in the data. The components of a boxplot are explained in <a href="#fig-boxplt">Figure&nbsp;15</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-boxplt" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-boxplt-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;15: Annotated boxplot</figcaption>
</figure>
</div>
</div>
</div>
<p>The box shows the positions of the first and third quartiles, or “hinges”, and the thick middle line shows the median. As 50% of the observations fall between the first and third quartiles, the position of the box is important and is the first thing that catches our eyes. If the median is in the centre of the box, this suggests that the distribution may be symmetric; if the median is near one end, the distribution is skewed. In particular, if the median is in the <em>right</em> side of the box, it implies that the middle 50% of the data are skewed to the <em>left</em>. For right skewed data, the median will be placed at the left end of the box (as against in the centre of the box).</p>
<p>After having considered the ‘centre’ of a distribution, which we have measured by the median, and looked at where the bulk of the data lies, measured by the quartiles; then we are particularly interested in the strange, unusual values. They could be obvious mistakes (incorrectly coded, or decimal places in the wrong place, transposition of digits such as 91 instead of 19) or incorrect measurements or recording. These last two possibilities often occur before the data gets to the statistician so that it may be difficult to check whether these mistakes have occurred. Apart from obvious errors, we can only point to ‘far out’ values as being strange and we term them <strong>‘outliers’</strong>. To help decide this matter, we define a few more terms, of which the most common one is the <strong>interquartile range</strong> or <strong>IQR</strong>, which is the distance between the first and third quartiles ( <span class="math inline">\(Q3-Q1\)</span> ). Any observation which is more than <span class="math inline">\(1.5 \times IQR\)</span> (sometimes called the “step”) less than the first or more than the third quartile can be considered a <em>possible</em> outlier (<a href="#fig-boxplt">Figure&nbsp;15</a>.</p>
<p>Boxplots are ideal for comparing a few groups of data because they give a visual summary of certain main features of the distributions but they are not as cluttered as other displays. Common sense must prevail, for there is a limit to the amount of information that the eye can take in. Up to 10 or 12 boxplots can be plotted, preferably on the same scale; more than 12 could be confusing.</p>
<p>Shown in <a href="#fig-boxplt1">Figure&nbsp;16</a> are the boxplots of <code>Length</code> for the Inside-Outside groupings. Note that the boxplots have been constructed on the same scale; that is, they have common (<code>Length</code>) axis.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> Length, </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> Inside, </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> Inside) <span class="sc">+</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-boxplt1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-boxplt1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;16: Boxplots</figcaption>
</figure>
</div>
</div>
</div>
<p>The boxplots in <a href="#fig-boxplt1">Figure&nbsp;16</a> show that the general shapes of the distributions of <code>Length</code> are broadly similar. In each case, the median is near the centre of the box. The box of the <code>Outside</code> group is entirely to the right of the box of the <code>Inside</code> group, indicating that the distribution of <code>Length</code> is higher for the <code>Outside</code> group. We can also see that the <code>Inside</code> group may have greater spread than the <code>Outside</code> group.</p>
</section>
<section id="letter-value-plots" class="level2">
<h2 class="anchored" data-anchor-id="letter-value-plots">Letter-value plots</h2>
<p>For large datasets, a summary based on five numbers may be overly simple, showing too many ‘outliers’ and obscuring some structure in the more extreme range of the data. <span class="citation" data-cites="hofmann_letter-value_2017">Hofmann, Wickham, and Kafadar (<a href="#ref-hofmann_letter-value_2017" role="doc-biblioref">2017</a>)</span> describe an extension to the boxplot called the “letter-value plot”.</p>
<p>Like boxplots, letter-value plots include the median and the two middle fourths of the data. However, the whiskers are replaced by smaller boxes, representing ever-decreasing proportions of the data, such as eighths, sixteenths, etc., represented by letter values. The extent of this extra boxing depends on the quantity and shape of the data.</p>
<p>Letter values are defined by their <strong>depths</strong>, or distances from the nearer edge of the ordered data.</p>
<p><code>median</code>: found at depth <span class="math inline">\(d(M) = (n + 1)/2\)</span> where <span class="math inline">\(n\)</span> is the number of observations</p>
<p><code>fourths</code>: found at depth <span class="math inline">\(d(F) = \{\verb"int"[d(M)] + 1\}/2\)</span> where <span class="math inline">\(\verb"int[]"\)</span> refers to the integer part function.</p>
<p><code>eighths</code>: found at depth <span class="math inline">\(d(E) = \{\verb"int"[d(F)] + 1\}/2\)</span></p>
<p>Similarly if we had enough data, we could extend further</p>
<p><code>sixteenths</code>: found at depth <span class="math inline">\(d(D) = \{\verb"int"[d(E)] + 1\}/2\)</span></p>
<p><code>thirty-seconds</code>: found at depth <span class="math inline">\(d(C) = \{\verb"int"[d(D)] + 1\}/2\)</span></p>
<p>and thus define points <span class="math inline">\(B, A, Z, Y, X,\)</span> and so on.</p>
<p>Note the M, F and E could be termed measures of <strong>location</strong>. It is also helpful to have some measures of <strong>spread</strong> which indicate the variability in the distribution. One such measure, the <strong>F-spread</strong>, is the distance between the two F (fourths) values; that is, the inter-quartile range (IQR). Finally, the <strong>range</strong> is the distance between the two extreme points.</p>
<p>Another useful measure of location is obtained by averaging the two hinges which is termed the <strong>mid-fourth</strong> (or <strong>mid-F</strong>). If the distribution were perfectly symmetrical, the mid-F would be the same as the median. If mid-F is smaller (larger) than the median, the distribution is skewed to the left (right). Note that the mid values can be found at any depths.</p>
<p>See <a href="https://mgimond.github.io/ES218/letter_values.html">here</a> for more details.</p>
<p>Letter values are displayed as a graph called letter value plot; see <a href="#fig-LVplt1">Figure&nbsp;17</a>. This type of plot is a better display than a boxplot for <code>big data</code> which tend to show many unusual points. Boxplots are suitable to moderate size datasets only. For large datasets, the skew may not be consistent within the data. The LV plot will show such anomalies in the skew patterns.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lvplot)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">LVboxplot</span>(Snodgrass<span class="sc">$</span>Length, <span class="at">xlab =</span> <span class="st">"Length"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-LVplt1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-LVplt1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;17: Letter-value plot for <code>length</code> data</figcaption>
</figure>
</div>
</div>
</div>
<p>A letter value plot showing the eighths is shown in <a href="#fig-boxplt2">Figure&nbsp;18</a>. Note that this LV plot does not have a whisker, but the points falling outside the eighths are tagged.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">LVboxplot</span>(Snodgrass<span class="sc">$</span>Length <span class="sc">~</span> Snodgrass<span class="sc">$</span>Inside, <span class="at">xlab =</span> <span class="st">"Length"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-boxplt2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-boxplt2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;18: Letter-value plots of <code>Length</code> by <code>Inside</code></figcaption>
</figure>
</div>
</div>
</div>
<p>If we compare <a href="#fig-boxplt1">Figure&nbsp;16</a> with <a href="#fig-boxplt2">Figure&nbsp;18</a>, we can see that the whiskers have been replaced with more ‘outliers’ and two extra boxes. The middle boxes are the same; they show the first and third quartiles. The smaller, darker boxes in <a href="#fig-boxplt2">Figure&nbsp;18</a> show the first and seventh eighths.</p>
<p><a href="#fig-lvggplot">Figure&nbsp;19</a> shows a <code>ggplot</code> version of an LV plot for a big random data set.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lvplot)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>( <span class="fu">rlnorm</span>(<span class="at">n=</span><span class="fl">1e4</span>, <span class="at">mean =</span> <span class="dv">10</span>) , </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>         <span class="fu">rnorm</span>(<span class="at">n=</span><span class="fl">1e4</span>, <span class="at">mean =</span> <span class="fl">5e5</span>, <span class="at">sd =</span> <span class="fl">1e5</span>) </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>         ),</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Log-normal(10,1)"</span>,<span class="st">"Normal(500k,100k)"</span>), <span class="at">each=</span><span class="fl">1e4</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>()</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">fill=</span><span class="fu">after_stat</span>(LV)) <span class="sc">+</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_lv</span>() <span class="sc">+</span> </span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_lv</span>() <span class="sc">+</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-lvggplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-lvggplot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;19: A ggplot letter-value plot</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="cumulative-frequency-graph-and-quantiles" class="level1">
<h1>Cumulative Frequency Graph and Quantiles</h1>
<p>When the data consists of individual points rather than grouped data, we first order the data from smallest to largest and we can plot the row numbers against these.</p>
<p>For the Length data from the <em>Snodgrass</em> dataset, we have shown the ordered values earlier. If we assume that these are evenly spread throughout the distribution, these 91 values divide the distribution into 91 even parts each containing a relative frequency of 1/91 = 0.010989. In the absence of information about Length of other house pits, the above assumption seems reasonable. It would have even stronger justification if this sample of 91 were chosen at random from the population of the of all house pits, but this stretches the imagination somewhat as these 91 observations are just a chance archaeological find of what was preserved. Nevertheless, we have no real reason to consider that they are not representative of the whole population <em>Snodgrass</em> house pits.</p>
<p>To find the cumulative relative frequency, we divide the column of row numbers by 91. There is a slight problem in that we do not know the smallest, and the largest Length. Hence we make an arbitrary decision that the smallest is likely to be 4 feet with cumulative relative frequency of zero and the largest 21 feet with a cumulative frequency of 1.</p>
<p>With the Length data, there is a slight hitch in that there is duplication of the values. This is not really a problem, so long as we ignore the cumulative frequency in the table which corresponds to each first repeated value. The frequency jumps by one at the value of each observation except when there is a repetition in which case it jumps by the number of repetitions. Having obtained the cumulative relative frequencies, we can plot these against the ordered Length values.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(Length) <span class="sc">+</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ecdf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-cumfrq" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-cumfrq-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;20: Cumulative Relative Frequency Curve</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-cumfrq">Figure&nbsp;20</a> shows the Cumulative Relative Frequency Curve. The procedure we described is a very basic one, and <code>R</code> software will get a better one where we make more assumptions on how to relate the observed data to the cumulative relative frequencies.</p>
<p>An important use of cumulative relative frequency graph is to find the <strong>quantiles</strong> of the distribution which is a general term for percentiles, deciles etc. For example, the <span class="math inline">\(50^{\text th}\)</span> percentile or the 5<span class="math inline">\(^{\text th}\)</span> decile (tenth) is the median which has 50% of the distribution up to, and including it. Any desired percentile can be found from the graph by drawing a horizontal line at the desired cumulative relative frequency and noting the value at which it cuts the curve. <a href="#fig-cumfrq1">Figure&nbsp;21</a> illustrates how the 30<span class="math inline">\(^{\text th}\)</span> percentile can be interpolated for the Length variable. It is desirable to use software to draw the cumulative relative frequency curves or estimate the quantiles.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>q30 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(Snodgrass<span class="sc">$</span>Length, <span class="fl">0.3</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(Length) <span class="sc">+</span> </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ecdf</span>() <span class="sc">+</span> </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> q30, </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">xend =</span> q30, </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">yend =</span> .<span class="dv">3</span>),  </span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour=</span><span class="dv">2</span>, </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length=</span><span class="fu">unit</span>(<span class="fl">0.30</span>,<span class="st">"cm"</span>), </span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ends=</span><span class="st">"first"</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, </span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> .<span class="dv">3</span>, </span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">xend =</span> q30, </span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">yend =</span> .<span class="dv">3</span>), </span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour=</span><span class="dv">2</span>, </span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length=</span><span class="fu">unit</span>(<span class="fl">0.30</span>,<span class="st">"cm"</span>))</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"ECDF(Length)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-cumfrq1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-cumfrq1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;21: ECDF Curve for Length data</figcaption>
</figure>
</div>
</div>
</div>
<p>The 25<span class="math inline">\(^{\text th}\)</span> percentile is known as the <strong>lower quartile</strong> and the 75<span class="math inline">\(^{\text th}\)</span> percentile is known as the <strong>upper quartile</strong>. The inter-quartile range (IQR) is defined as the difference between the upper and lower quartiles. The lower and upper quartiles will slightly differ from the lower and upper hinges for small data sets due to the differences in estimating the cumulative relative frequency function known as the empirical cumulative distribution function (<strong>ECDF</strong>).</p>
<p>The <code>R</code> function <code>quantile()</code> will get the quantiles easily. The following output shows the percentiles for Length data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(Snodgrass<span class="sc">$</span>Length, <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  0%  10%  20%  30%  40%  50%  60%  70%  80%  90% 100% 
 4.0 11.5 12.0 13.5 14.0 14.5 16.0 16.5 18.0 20.0 21.0 </code></pre>
</div>
</div>
<section id="quantile-quantile-q-q-plot" class="level2">
<h2 class="anchored" data-anchor-id="quantile-quantile-q-q-plot">Quantile-Quantile (Q-Q) Plot</h2>
<p>At times, two groups may have different numbers of observations but they may be similar in some ways and it may be appropriate to compare them. This comparison can be done in several ways but Q-Q plot is once such graph useful for such a comparison. The quantiles of the first batch is plotted against the quantiles of the second batch. A 45 degree <span class="math inline">\((Y=X)\)</span> line is also drawn. If the points on a quantile-quantile plot fall along, or close to, the 45 degree line, then the two variables follow the same distribution; if they fall on a line parallel to the 45 degree line, the two variables follow similar distributions but one has a larger location parameter (say mean, or median) than the other; if the slope differs from the 45 degree line the variables have a similar distribution but have different scale parameters (say, standard deviations or F-spreads); if the plot is linear then the distributions of <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span> are different.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12344</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>nq <span class="ot">&lt;-</span> <span class="dv">201</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span> , nq, <span class="at">length.out =</span> <span class="dv">50</span>) <span class="sc">/</span> nq <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">/</span> nq</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">quantile</span>(X, p), <span class="at">y =</span> <span class="fu">quantile</span>(Y, p)) <span class="sc">+</span> </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"X &amp; Y roughly follow</span><span class="sc">\n</span><span class="st">the same distributions"</span>) <span class="sc">+</span> </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"X quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Y quantiles"</span>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>Y2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">quantile</span>(X2, p), </span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">quantile</span>(Y2, p)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span> </span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"The distribution of Y has</span><span class="sc">\n</span><span class="st">a larger location (mean/median)"</span>) <span class="sc">+</span> </span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"X quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Y quantiles"</span>)</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>X3 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>Y3 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">quantile</span>(X3, p), </span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">quantile</span>(Y3, p)</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span> </span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"The distribution of Y has</span><span class="sc">\n</span><span class="st">a larger scale (SD, F-spread etc)"</span>) <span class="sc">+</span> </span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"X quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Y quantiles"</span>)</span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>X4 <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">100</span>, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>Y4 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">quantile</span>(X4, p), <span class="at">y =</span> <span class="fu">quantile</span>(Y4, p)) <span class="sc">+</span> </span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"The distributions of  X and Y </span><span class="sc">\n</span><span class="st">are different"</span>) <span class="sc">+</span> </span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"X quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Y quantiles"</span>)</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, p3, p4, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-qq1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-qq1-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;22: Quantile-Quantile plot patterns</figcaption>
</figure>
</div>
</div>
</div>
<p>In <a href="#fig-qq1">Figure&nbsp;22</a>, different kinds of quantile-quantile plots are shown; note the following three cases in particular.</p>
<ol type="1">
<li><p><span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span> follow similar distributions but the quantiles of <span class="math inline">\(Y\)</span> are a constant amount greater than the quantiles of <span class="math inline">\(X\)</span>.</p></li>
<li><p><span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span> follow similar distributions but the standard deviation of <span class="math inline">\(Y\)</span> is greater than that of <span class="math inline">\(X\)</span>.</p></li>
<li><p><span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span> follow different distributions.</p></li>
</ol>
<p><a href="#fig-lenqq">Figure&nbsp;23</a> gives Q-Q plot comparing the Length of house pits for Inside and Outside groups. This Q-Q plot suggests that the two distributions are similar but the average Length is greater for the Inside dwellings.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>nq <span class="ot">&lt;-</span> <span class="fu">length</span>(Snodgrass<span class="sc">$</span>Length)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span> , nq, <span class="at">length.out =</span> <span class="dv">20</span>) <span class="sc">/</span> nq <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">/</span> nq</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> Snodgrass <span class="sc">|&gt;</span> </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Inside <span class="sc">==</span> <span class="st">"Inside"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Length)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Snodgrass <span class="sc">|&gt;</span> </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Inside <span class="sc">==</span> <span class="st">"Outside"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Length)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">quantile</span>(X, p), </span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">quantile</span>(Y, p)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span> </span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Length quantiles for Inside Group"</span>) <span class="sc">+</span> </span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Length quantiles for Outside Group"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-lenqq" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-lenqq-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;23: Quantile-Quantile plot of Length for Inside-Outside groups</figcaption>
</figure>
</div>
</div>
</div>
<p>Note that the distribution of two variables <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> can be compared in a number of ways using boxplots, overlaid ECDF plots etc.</p>
</section>
</section>
<section id="comparing-several-groups-of-data" class="level1">
<h1>Comparing Several Groups of Data</h1>
<p>In earlier sections we have seen briefly how to compare two batches of data using boxplots, Q-Q plot etc. Several boxplots can be presented in a single display so that the distributions of the variables can be compared. An example is shown in <a href="#fig-boxpl3">Figure&nbsp;24</a>. Note that we can instead make dotplots instead of boxplots shown in <a href="#fig-facetgrid">Figure&nbsp;25</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">"http://www.massey.ac.nz/~anhsmith/data/rangitikei.RData"</span>,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">destfile =</span> <span class="st">"rangitikei.RData"</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"rangitikei.RData"</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rangitikei) <span class="sc">+</span> </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y=</span>people, <span class="at">x=</span>temp) <span class="sc">+</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-boxpl3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-boxpl3-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;24: Comparing many batches</figcaption>
</figure>
</div>
</div>
</div>
<p>By the term faceting, we mean in a trellis or matrix like layout for graphing. A facet grid of plots is a matrix of panels of graphs defined by row and/or column faceting variables. A simple row grid of jittered dotplots is shown in <a href="#fig-facetgrid">Figure&nbsp;25</a>. This display shows that more people visited Rangitikei river when the temperature is moderate than when it is too low or high.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rangitikei) <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y=</span>people, <span class="at">x=</span><span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(temp <span class="sc">~</span> .)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Try  + geom_jitter() + facet_grid(temp ~ wind)</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Try  + geom_jitter() + facet_grid( ~ temp+wind)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-facetgrid" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-facetgrid-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;25: Comparing many batches</figcaption>
</figure>
</div>
</div>
</div>
<p>Plots can also be wrapped for better comparison and discovery of patterns and peculiarities. More <code>R</code> instructions appear in the software handout and in course <code>Shiny</code> apps.</p>
<section id="exploring-relationships" class="level2">
<h2 class="anchored" data-anchor-id="exploring-relationships">Exploring relationships</h2>
<p>Consider data which can be written as pairs (<span class="math inline">\(X\)</span>, <span class="math inline">\(Y\)</span>). The two groups of data (<span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>) need not be in the same units but they are assumed to be related in some way. Scatterplots are useful in exploring the type of relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">"http://www.massey.ac.nz/~anhsmith/data/testmarks.RData"</span>, </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">destfile =</span> <span class="st">"testmarks.RData"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"testmarks.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(testmarks) <span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y=</span>English, <span class="at">x=</span>Maths) <span class="sc">+</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-sca1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-sca1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;26: Scatter plot of English vs Maths scores</figcaption>
</figure>
</div>
</div>
</div>
<p>The data in <strong>testmarks.txt</strong> consists of the records of 40 students, at a school, on standard tests of comprehension of English and Mathematics. The test marks data can be graphed plotting English test scores against Mathematics test scores. The resulting graph, known as the scatterplot, is shown as <a href="#fig-sca1">Figure&nbsp;26</a>. This plot enables us to see if there is a relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</p>
<p>Here, the scatterplot shows a clear upward trend – as the Mathematics mark increases so does the English mark, in general.</p>
<p>There are a number of useful features that can be added to a scatterplot. The individual distributions of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> can be shown by adding appropriate graphical displays (e.g.&nbsp;boxplots) along the axes. If a number of the students have the same marks then it may be advisable to add a jitter as we discussed earlier.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggExtra)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(testmarks) <span class="sc">+</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y=</span>English, <span class="at">x=</span>Maths) <span class="sc">+</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggMarginal</span>(p1, <span class="at">type=</span><span class="st">"boxplot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-marginbp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-marginbp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;27: English vs Maths scores</figcaption>
</figure>
</div>
</div>
</div>
<p>In <a href="#fig-marginbp">Figure&nbsp;27</a>, it can be seen (with some effort) that each set of scores seems to be <em>uniformly</em> distributed along its axis, although the Maths marks exhibit gaps which may indicate different groups within the class.</p>
<p>Finally, does the variability in English marks change as the Maths mark changes, or is it fairly constant, i.e.&nbsp;does the vertical height of the scatter change from left to right? In this case the variability appears to be fairly constant (we will see why this is important later).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rangitikei) <span class="sc">+</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> people, <span class="at">x =</span> vehicle, <span class="at">col =</span> loc, <span class="at">shape =</span> loc) <span class="sc">+</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-sca2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-sca2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;28: Scatterplot with a grouping variable</figcaption>
</figure>
</div>
</div>
</div>
<p>If the data is known to be grouped, then this can be shown on the scatterplot by using different symbols for each group. The data file <strong>Rangitikei.txt</strong> gives the number of people making recreational use of the Rangitikei River and the number of vehicles seen at a particular location and time. The data were collected at two locations (location being a categorical variable). The effect of location, if any, on the number of people and vehicles can be seen on a scatterplot if we identify each plotted point with a different symbol (or colour) depending on the location (see <a href="#fig-sca2">Figure&nbsp;28</a>). There appears to be little effect of location on the number of people and vehicles seen.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggExtra)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> rangitikei <span class="sc">|&gt;</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y=</span>people, <span class="at">x=</span>vehicle) <span class="sc">+</span> </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"(A): All of the data"</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> rangitikei <span class="sc">|&gt;</span> </span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove the rows with highest value of 'people'</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(people <span class="sc">&lt;</span> <span class="fu">max</span>(people)) <span class="sc">|&gt;</span> </span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y=</span>people, <span class="at">x=</span>vehicle) <span class="sc">+</span> </span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"(B): Without observation #26"</span>)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggMarginal</span>(p1, <span class="at">type=</span><span class="st">"boxplot"</span>), </span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggMarginal</span>(p2, <span class="at">type=</span><span class="st">"boxplot"</span>), </span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-marginbp1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-marginbp1-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;29: People vs vehicle plots</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-marginbp2">Figure&nbsp;30</a> shows the number of people against the number of vehicles seen as well as the distribution of each variable along the axes using boxplots (these are often referred to as <em>marginal distributions</em>). The first plot in <a href="#fig-marginbp2">Figure&nbsp;30</a> (A) shows the scatter of all points, whereas the second one (B) shows the scatter with the very large value (Observation #26) removed. In the first plot the outlier shows up quite clearly in both boxplots. In the second plot the boxplot associated with the variable ‘people’ still shows one point as an outlier, though this doesn’t appear to be as extreme as the one in the first plot, and in the scatterplot the points fall close to a line which has a positive slope as is the case of <a href="#fig-marginbp2">Figure&nbsp;30</a> (A). However, the distribution of each variable is skewed to the right.</p>
<p>Note that the case which produced the outlier in both the marginal distributions did not produce a scatterplot value that was in any way unusual. While this might not surprise us (the relationship between people and vehicles might be expected to stay the same even for a location with large numbers of each), it follows that an outlier with respect to the underlying relationship between two variables will be different from an outlier in the marginal distribution sense. And such a value may not be an outlier in either marginal distribution. Look again at <a href="#fig-marginbp">Figure&nbsp;27</a> - there is one student with a high Maths mark but a low English mark. While neither mark is unusual in itself, the point stands out from the rest of the scatterplot because it is unusually high or low (i.e.&nbsp;up or down) on the plot. In general an outlier with respect to the relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> is one whose <span class="math inline">\(Y\)</span> value is unusually large or small compared to other cases with similar <span class="math inline">\(X\)</span> values.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">"http://www.massey.ac.nz/~anhsmith/data/horsehearts.RData"</span>,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">destfile =</span> <span class="st">"horsehearts.RData"</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"horsehearts.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggExtra)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(horsehearts) <span class="sc">+</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y=</span>WEIGHT, <span class="at">x=</span>EXTDIA) <span class="sc">+</span> </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p1 <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggMarginal</span>(p1, <span class="at">type=</span><span class="st">"density"</span>), </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggMarginal</span>(p2, <span class="at">type=</span><span class="st">"density"</span>), </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'
`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-marginbp2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-marginbp2-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;30: Weight vs Exterior Widths</figcaption>
</figure>
</div>
</div>
</div>
<p>Another example of a scatterplot is shown in <a href="#fig-marginbp2">Figure&nbsp;30</a> which displays the weight of horses’ hearts against their exterior widths in the systole phase (that is the contracted phase)(data set <strong>horsehearts.txt</strong>). The scatterplot indicates that a straight line would not fit the data well. On the other hand, there is some evidence the weights fall into one of two subgroups (with a value around 2.5kg being the cut off point). Scatterplots are particularly useful in pinpointing possible groupings of points so that the structure of the data is revealed which might otherwise go undetected in descriptive statistics calculated for the full data set.</p>
<p>One way of quickly assessing whether a straight line fit is reasonable is to smooth the points in the plot using a LOWESS (LOcally WEighted Scatterplot Smoother) smoothed line. The lowess (also called loess) procedure is based on local sets of points (instead of the whole data set) at a given <span class="math inline">\(x\)</span> range, and fits a smoothed line to the data. The second scatterplot in <a href="#fig-marginbp2">Figure&nbsp;30</a> shows the lowess smoother which confirms that there is curvature in the underlying relationship- possibly a cubic curve would fit this.</p>
<section id="scatterplots-and-correlation-coefficients" class="level3">
<h3 class="anchored" data-anchor-id="scatterplots-and-correlation-coefficients">Scatterplots and Correlation Coefficients</h3>
<p>We will use the data set <strong>horsehearts.txt</strong> of the weights of horses’ hearts in relation to other heart measurements to illustrate the measurement of correlation. As we have seen before, scatterplots provide a good starting point for exploring the type of relationship between two variables. In <a href="#fig-scaqud">Figure&nbsp;31</a>, the weight, <span class="math inline">\(Y\)</span>, is plotted against the exterior width <span class="math inline">\(X\)</span> (diastole phase in column 7 of <strong>horsehearts.txt</strong>). It is helpful to divide the scatterplot into four quarters, called quadrants, by drawing a line horizontally at the average <span class="math inline">\(Y\)</span> value or weight (2.235kg) and vertically at the average <span class="math inline">\(X\)</span> value (or diastole exterior width 14.13mm). The first quadrant is the top right hand side quarter. We move anti-clockwise for numbering the quadrants, and the bottom left hand side quadrant is called the third quadrant.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-scaqud" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-scaqud-1.png" class="img-fluid figure-img" width="576"></p>
<figcaption class="figure-caption">Figure&nbsp;31: Four quadrants of a scatter plot</figcaption>
</figure>
</div>
</div>
</div>
<p>In <a href="#fig-scaqud">Figure&nbsp;31</a>, most of the points fall in the third and first quadrants which indicates that there is an increasing relationship between the two variables (as the length increases, the weight tends to increase which is not too surprising!).</p>
<p>Although this scatterplot indicates a nonlinear relationship would fit better than a linear relationship, we will continue to use it for illustration. It is useful to have an objective measure of how strong a linear relationship is (as we have seen, stretching or compressing one or both axes can give different impressions). This measure is called the Pearsonian <strong><em>correlation coefficient</em></strong> between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> and is denoted by <span class="math inline">\(r_{xy}\)</span> or <span class="math inline">\(r\)</span> for short:</p>
<p><span class="math display">\[
\begin{aligned}
r_{xy} &amp;= \frac{{\text {sum}(x - \bar x)(y - \bar y)}}{{\text{squareroot}[\text {sum}(x - \bar x)^2  {\text{sum}}(y - \bar y)^2 ]}} \\
\\
&amp;= \frac{\sum (x-\bar{x})(y-\bar{y}) }{\sqrt{\sum (x-\bar{x})^{2}  \sum (y-\bar{y})^{2}  } } \\
\\
&amp;=\frac{S_{xy} }{\sqrt{S_{xx} S_{yy} } }
\end{aligned}
\]</span></p>
<p>Here <span class="math inline">\(S_{xx}=S_x^2\)</span> is the variance of <span class="math inline">\(X\)</span>, <span class="math inline">\(S_{yy}=S_y^2\)</span> is the variance of <span class="math inline">\(Y\)</span>, and <span class="math inline">\(S_{xy}\)</span> is the covariance between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</p>
<p>The (Pearsonian) correlation (coefficient) between WEIGHT and EXTDIA equals 0.759. Perfect correlation (+l) would occur if all points fell on a straight line in the first and third quadrants. Assuming a bivariate normal distribution, the null hypothesis that the true correlation coefficient <span class="math inline">\(\rho _{xy} =0\)</span> can be tested using the test statistic <span class="math display">\[t = \frac{{r_{xy} }}{{\sqrt {\frac{{1 - r_{xy}^2 }}{{n - 2}}} }}\]</span> Statistical software programs directly give the <span class="math inline">\(p\)</span>-value for this test. The estimated correlation coefficient of 0.759 for <span class="math inline">\((n-2)=44\)</span> df is significant (<span class="math inline">\(p\)</span>-value is close to zero). Testing of hypothesis related topics are covered in the next Chapter.</p>
<p>The scatterplot indicates that there may be two groups of horses; whose hearts weigh about 2.3 kg or more and whose heart weights are less than 2.3 kg. If possible, one should try to establish whether there are two groups for some reason (perhaps age, sex or breed). If the points tended to concentrate in quadrants 2 and 4, this would indicate that the correlation between <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span> is negative (as <span class="math inline">\(X\)</span> increases, <span class="math inline">\(Y\)</span> tends to decrease). If the points were evenly scattered among the four quadrants, the correlation coefficient would be close to zero.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-corp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-corp-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;32: Limitations of the correlation coefficient</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-corp">Figure&nbsp;32</a> shows a number of possible plots of <span class="math inline">\(Y\)</span> against <span class="math inline">\(X\)</span> and their associated correlation coefficients. Notice that the correlation coefficient may be close to zero even though there is a strong pattern present. This is because the correlation coefficient only measures the strength of the <em>linear</em> relationship between two variables. In the presence of subgroups the correlation coefficient can become spurious or even be close to zero when there is indeed the correlation is high within the subgroup. Simpson (1951) demonstrated that relationships noted within a population may not hold and could be the opposite within all subgroups. This amalgamation paradox can happen to most summary statistical measures including the correlation coefficient.</p>
<p>The other situation that is not shown in <a href="#fig-corp">Figure&nbsp;32</a> is that the correlation coefficient can be positive and a line would be a reasonable fit although the scatter diagram indicates that both <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span> have skewed distributions suggesting that transformations should be applied.</p>
<div id="fig-corpat" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/corpat.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;33: Sign of the correlation coefficient</figcaption>
</figure>
</div>
<p>To see why the sign of <span class="math inline">\(r\)</span> indicates the direction of the relationship, consider <a href="#fig-corpat">Figure&nbsp;33</a>.</p>
<ol type="1">
<li><p>Regardless of which quadrant the point is in, the contribution to <span class="math inline">\(S_{xx}\)</span> and <span class="math inline">\(S_{yy}\)</span> is positive, as these are sums of squares.</p></li>
<li><p>In the first quadrant the contribution of each point to the cross product <span class="math inline">\(S_{xy}\)</span> is <span class="math inline">\((+) \times (+)\)</span>, that is a positive amount. In the third quadrant, each contribution is <span class="math inline">\((-)\times (-)\)</span>, that is a positive amount. This is the reason that the correlation coefficient is positive if most points are in the first and third quadrants.</p></li>
<li><p>Points in the second and fourth quadrant contribute negative amounts, <span class="math inline">\((-)\times (+)\)</span> or <span class="math inline">\((+)\times (-)\)</span>, to the cross product <span class="math inline">\(S_{xy}\)</span>. If there are a considerable number of points in quadrants 2 and 4, the correlation coefficient will tend to be negative.</p></li>
</ol>
</section>
<section id="scatterplot-and-correlation-matrices" class="level3">
<h3 class="anchored" data-anchor-id="scatterplot-and-correlation-matrices">Scatterplot and correlation Matrices</h3>
<p>When there are more than two variables of interest, it is possible to draw scatterplots of each pair of variables but this becomes a bewildering exercise as the number of variables increases. One way to keep track of these plots is to set them out in a scatterplot matrix as in <a href="#fig-matplt2">Figure&nbsp;34</a> which is based on the data set <strong>pinetree.txt</strong> containing the circumference measurements of pine trees at four positions (Top, Third, Second and First) and in three areas of a forest. This plot also shows the simple correlation coefficients on the upper diagonal and smoothed density plots on the main diagonal of the matrix. This plot clearly shows that the variables are strongly related to each other. In particular, the Top circumference can be predicted reasonably well based on the bottom circumference. Even though the correlations are high, a quadratic model may fit better. <a href="#fig-matplt2">Figure&nbsp;34</a> seems to show a non-random pattern in the way points appear on the plot. This may be due to the Area effect because the circumference data were collected from three different areas. <a href="#fig-matplt2">Figure&nbsp;34</a> confirms that this is indeed the case.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">"http://www.massey.ac.nz/~anhsmith/data/pinetree.RData"</span>, </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">destfile =</span> <span class="st">"pinetree.RData"</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"pinetree.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(pinetree, <span class="at">columns =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-matplt2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-matplt2-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;34: Four quadrants of a scatter plot</figcaption>
</figure>
</div>
</div>
</div>
<p>It is also possible to use the colour option as well as the subgroup-wise correlation coefficients. Try</p>
<pre><code>ggpairs(
  pinetree, 
  columns = 2:5,
  mapping = aes(colour = Area)
  )</code></pre>
</section>
<section id="exploring-bivariate-distributions" class="level3">
<h3 class="anchored" data-anchor-id="exploring-bivariate-distributions">Exploring bivariate distributions</h3>
<p>The two-dimensional or the <strong>bivariate probability distribution</strong> of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> can be displayed as a 2-d smoothed density plot or as a probability contour plot. <a href="#fig-matplt3">Figure&nbsp;35</a> shows such plots. This figure rather suggests that there may be two separate joint probability distributions of Maths and English scores. This clue is not obtained in the scatter plot of English score against Maths score but only from the other three plots.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> testmarks<span class="sc">$</span>English</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> testmarks<span class="sc">$</span>Maths</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>def.par <span class="ot">=</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>),</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Maths Marks"</span>,</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"English Marks"</span>,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Scatter plot of English Scores vs Maths Scores"</span>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">=</span> <span class="fu">kde2d</span>(x, y, <span class="at">n =</span> <span class="dv">50</span>, <span class="at">lims =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">100</span>))</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(f1,</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">"Maths Marks"</span>,</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">ylab =</span> <span class="st">"English Marks"</span>,</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">col=</span><span class="fu">gray</span>((<span class="dv">0</span><span class="sc">:</span><span class="dv">32</span>)<span class="sc">/</span><span class="dv">32</span>), <span class="at">main =</span> <span class="st">"Image Plot"</span>)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(f1, </span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Maths Marks"</span>,</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"English Marks"</span>,</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Density contourPlot"</span>)</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>op <span class="ot">=</span> <span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>)<span class="sc">+</span>.<span class="dv">1</span>)</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a><span class="fu">persp</span>(f1, <span class="at">phi =</span> <span class="dv">45</span>, <span class="at">theta =</span> <span class="dv">30</span>,</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">"Maths Marks"</span>, <span class="at">ylab =</span> <span class="st">"English Marks"</span>, <span class="at">zlab =</span> <span class="st">"density"</span>,</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"gray"</span>, <span class="at">shade =</span> .<span class="dv">5</span>, <span class="at">border =</span> <span class="cn">NA</span>,</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">"Perspective plot (density estimation)"</span>)</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(op)</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(def.par)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-matplt3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-matplt3-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;35: Exploring bivariate distributions</figcaption>
</figure>
</div>
</div>
</div>
<!-- ```{r} -->
<!-- p0 <- testmarks |>  -->
<!--   ggplot() +  -->
<!--   aes(x = Maths, y = English) -->
<!-- p1 <- p0 + geom_point() -->
<!-- p2 <- p0 + geom_bin2d() -->
<!-- ``` -->
<p>In summary, scatterplots may reveal many properties and peculiarities about the relationship of <span class="math inline">\(Y\)</span> to <span class="math inline">\(X\)</span>, namely</p>
<ol type="1">
<li><p><strong>Trends</strong>: the overall trend may be positive or negative. It may be appropriate to fit a straight line or a curve.</p></li>
<li><p><strong>Outliers</strong>: points which appear to be unusual, or outliers, may be evident. In a scatterplot, the outlier need not be in the extreme scale of both <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, and anything appearing peculiar or as a rogue point must be investigated.</p></li>
<li><p><strong>Gaps</strong> may be seen in the data which may indicate that different groups are present. On the other hand, if it is known that points belong to different groups, the points can be tagged with different symbols. The basic idea is to see whether different groups follow the same pattern or different patterns.</p></li>
<li><p><strong>Variability</strong> of <span class="math inline">\(Y\)</span> change with <span class="math inline">\(X\)</span>, or may be fairly constant. <strong>Clustering</strong> of points with smaller variability when compared to rest of the points may also be revealed in some scatterplots.</p></li>
</ol>
<p>Both joint and marginal distributions of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are important. We also consider the distribution of each variable separately, and explore whether they have symmetric distributions or not.</p>
</section>
</section>
<section id="higher-dimensional-data" class="level2">
<h2 class="anchored" data-anchor-id="higher-dimensional-data">Higher dimensional data</h2>
<p>A short-cut to explore three numerical variables is to obtain a contour plot. In <a href="#fig-matplt3">Figure&nbsp;35</a>, the contours were the joint density of Maths and English marks. Instead, we can just use three numerical variables and show the third variable (Z) as a contour on a scatter plot of Y vs.&nbsp;X. What this means is that several combinations of X and Y can lead to the same Z. So we have to use some smoothing method or a model to obtain the contours and form a grid. The <code>R</code> package <em>plotly</em> is rather simple and powerful to obtain dynamic or interactive plots. The plots produced with this package are colour optimised for viewing and hence they may not be the best for printing but good for EDA purposes. We can also hover over the graph and view the graphed data. After loading the pine tree data, try-</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">type =</span> <span class="st">'contour'</span>, </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">x=</span>pinetree<span class="sc">$</span>First, </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span>pinetree<span class="sc">$</span>Second, </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">z=</span>pinetree<span class="sc">$</span>Top)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-cc2b35d4981c935c0ccc" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-cc2b35d4981c935c0ccc">{"x":{"visdat":{"b14125e75a9":["function () ","plotlyVisDat"]},"cur_data":"b14125e75a9","attrs":{"b14125e75a9":{"x":[23.899999999999999,25.699999999999999,27.199999999999999,30,31.699999999999999,31.699999999999999,32.600000000000001,32.799999999999997,33.100000000000001,33.399999999999999,34.5,34.600000000000001,35.799999999999997,36.299999999999997,37.600000000000001,38,41.200000000000003,43.5,44.899999999999999,47.600000000000001,17.600000000000001,23.300000000000001,24.699999999999999,25.199999999999999,26.5,26.800000000000001,27.100000000000001,28,28.899999999999999,29.399999999999999,30.800000000000001,31.600000000000001,33.200000000000003,34.700000000000003,36.100000000000001,37.5,38.799999999999997,41.5,43.200000000000003,46.700000000000003,17.899999999999999,18.800000000000001,20.899999999999999,21.600000000000001,22.699999999999999,23.5,24.100000000000001,25.300000000000001,26.199999999999999,26.899999999999999,27.399999999999999,27.800000000000001,28.5,29.100000000000001,29.899999999999999,30.800000000000001,31.600000000000001,33.700000000000003,35.600000000000001,36.200000000000003],"y":[16.300000000000001,22.800000000000001,24.5,25.199999999999999,26.399999999999999,27.300000000000001,27.300000000000001,27.899999999999999,28.100000000000001,28.699999999999999,29,29.5,30.5,31.399999999999999,32.799999999999997,33.200000000000003,34.700000000000003,35.600000000000001,37.200000000000003,38,16.800000000000001,17.899999999999999,18.699999999999999,20.399999999999999,22.699999999999999,24.100000000000001,25.5,26.699999999999999,27.800000000000001,28.899999999999999,30.100000000000001,31.199999999999999,31.699999999999999,32.5,32.799999999999997,33.899999999999999,34.700000000000003,35.899999999999999,37.5,40.899999999999999,15.1,17.300000000000001,18.399999999999999,19.800000000000001,20.5,21.199999999999999,21.899999999999999,22.399999999999999,22.800000000000001,23.300000000000001,23.699999999999999,24.100000000000001,24.600000000000001,24.600000000000001,25.199999999999999,26.699999999999999,27.800000000000001,29.199999999999999,30.5,31.100000000000001],"z":[11.1,12.5,13.699999999999999,14.199999999999999,15,16.100000000000001,16.800000000000001,17.5,17.5,18.899999999999999,20.300000000000001,21.699999999999999,22.199999999999999,23.600000000000001,24.100000000000001,24.800000000000001,25.699999999999999,26.899999999999999,27.600000000000001,30.300000000000001,10.1,10.9,11.300000000000001,12.699999999999999,13.300000000000001,14.1,15,15.300000000000001,16.100000000000001,16.699999999999999,17.5,17.5,18.199999999999999,20.5,22.100000000000001,22.899999999999999,23.699999999999999,25.600000000000001,27.899999999999999,30,10.5,10.9,11.1,11.199999999999999,11.4,11.4,11.800000000000001,12.1,12.199999999999999,12.699999999999999,13.199999999999999,13.6,14.5,14.9,15.800000000000001,16.899999999999999,17.5,18.100000000000001,19.699999999999999,22.5],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"contour"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":[]},"yaxis":{"domain":[0,1],"automargin":true,"title":[]},"scene":{"zaxis":{"title":[]}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"colorbar":{"title":"","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"x":[23.899999999999999,25.699999999999999,27.199999999999999,30,31.699999999999999,31.699999999999999,32.600000000000001,32.799999999999997,33.100000000000001,33.399999999999999,34.5,34.600000000000001,35.799999999999997,36.299999999999997,37.600000000000001,38,41.200000000000003,43.5,44.899999999999999,47.600000000000001,17.600000000000001,23.300000000000001,24.699999999999999,25.199999999999999,26.5,26.800000000000001,27.100000000000001,28,28.899999999999999,29.399999999999999,30.800000000000001,31.600000000000001,33.200000000000003,34.700000000000003,36.100000000000001,37.5,38.799999999999997,41.5,43.200000000000003,46.700000000000003,17.899999999999999,18.800000000000001,20.899999999999999,21.600000000000001,22.699999999999999,23.5,24.100000000000001,25.300000000000001,26.199999999999999,26.899999999999999,27.399999999999999,27.800000000000001,28.5,29.100000000000001,29.899999999999999,30.800000000000001,31.600000000000001,33.700000000000003,35.600000000000001,36.200000000000003],"y":[16.300000000000001,22.800000000000001,24.5,25.199999999999999,26.399999999999999,27.300000000000001,27.300000000000001,27.899999999999999,28.100000000000001,28.699999999999999,29,29.5,30.5,31.399999999999999,32.799999999999997,33.200000000000003,34.700000000000003,35.600000000000001,37.200000000000003,38,16.800000000000001,17.899999999999999,18.699999999999999,20.399999999999999,22.699999999999999,24.100000000000001,25.5,26.699999999999999,27.800000000000001,28.899999999999999,30.100000000000001,31.199999999999999,31.699999999999999,32.5,32.799999999999997,33.899999999999999,34.700000000000003,35.899999999999999,37.5,40.899999999999999,15.1,17.300000000000001,18.399999999999999,19.800000000000001,20.5,21.199999999999999,21.899999999999999,22.399999999999999,22.800000000000001,23.300000000000001,23.699999999999999,24.100000000000001,24.600000000000001,24.600000000000001,25.199999999999999,26.699999999999999,27.800000000000001,29.199999999999999,30.5,31.100000000000001],"z":[11.1,12.5,13.699999999999999,14.199999999999999,15,16.100000000000001,16.800000000000001,17.5,17.5,18.899999999999999,20.300000000000001,21.699999999999999,22.199999999999999,23.600000000000001,24.100000000000001,24.800000000000001,25.699999999999999,26.899999999999999,27.600000000000001,30.300000000000001,10.1,10.9,11.300000000000001,12.699999999999999,13.300000000000001,14.1,15,15.300000000000001,16.100000000000001,16.699999999999999,17.5,17.5,18.199999999999999,20.5,22.100000000000001,22.899999999999999,23.699999999999999,25.600000000000001,27.899999999999999,30,10.5,10.9,11.1,11.199999999999999,11.4,11.4,11.800000000000001,12.1,12.199999999999999,12.699999999999999,13.199999999999999,13.6,14.5,14.9,15.800000000000001,16.899999999999999,17.5,18.100000000000001,19.699999999999999,22.5],"type":"contour","line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>For the Snodgrass data, the contour plot of East (X) vs, South (Y) vs.&nbsp;Area (Z) is shown in <a href="#fig-cntrplt">Figure&nbsp;36</a>. This plot shows that bigger house pits are inside the X and Y axis show the geolocations.</p>
<div id="fig-cntrplt" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/ContourPlot.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;36: A contour plot for the Snodgrass data</figcaption>
</figure>
</div>
<p>A bubble plot is another option where a scatter plot shows the third variable as the size of the bubble on a scatter plot. This type of plot can be restrictive for some datasets depending on the variability involved in the third variable. <a href="#fig-bubble">Figure&nbsp;37</a> shows the location of the house pits and total Area. This plot not only gives the spatial view of the tribal area but indirectly reveals the clustering of house sizes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>East, <span class="at">y=</span>South, <span class="at">colour=</span>Area, <span class="at">size=</span>Area) <span class="sc">+</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-bubble" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-bubble-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;37: A bubble plot for the Snodgrass data</figcaption>
</figure>
</div>
</div>
</div>
<p>Using the appropriate software, it is possible to explore three variables using a 3-D scatter plot. We explore the pinetree data in <a href="#fig-3d">Figure&nbsp;38</a> which clearly shows the strong relationships and the Area effect. The other forms of exploring 3 variables include 3-D surface plots.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cloud</span>(Top <span class="sc">~</span> First<span class="sc">+</span>Second, <span class="at">group=</span>Area, <span class="at">data=</span>pinetree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-3d" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-3d-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;38: A 3-D plot</figcaption>
</figure>
</div>
</div>
</div>
<p>R packages such as <code>rgl</code> and <code>plotly</code> allow rotations of axes for graphical exploration of the relationships among variables, detection of peculiar points etc. It is easy to miss the form of relationships if proper rotational exploration is not done. Try:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgl)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot3d</span>(Snodgrass<span class="sc">$</span>East, Snodgrass<span class="sc">$</span>South, Snodgrass<span class="sc">$</span>Area)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><code>plotly</code> is great for interactive 3d plots (though they only work with HTML, not PDF).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(Snodgrass, <span class="at">x =</span> <span class="sc">~</span>East, <span class="at">y =</span> <span class="sc">~</span>South, <span class="at">z =</span> <span class="sc">~</span>Area) <span class="sc">|&gt;</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_markers</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a2b67304374cd65bab47" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-a2b67304374cd65bab47">{"x":{"visdat":{"b14466b1511":["function () ","plotlyVisDat"]},"cur_data":"b14466b1511","attrs":{"b14466b1511":{"x":{},"y":{},"z":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d","mode":"markers","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"East"},"yaxis":{"title":"South"},"zaxis":{"title":"Area"}},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[901.38999999999999,973.00999999999999,889.71000000000004,924.15999999999997,911.89999999999998,939.73000000000002,948.28999999999996,962.5,979.24000000000001,991.69000000000005,982.35000000000002,989.15999999999997,998.30999999999995,994.02999999999997,765.34000000000003,786.94000000000005,796.28999999999996,809.33000000000004,835.79999999999995,844.54999999999995,867.90999999999997,877.25,825.87,813.02999999999997,800.57000000000005,935.45000000000005,953.35000000000002,959.38999999999999,967.55999999999995,1017.58,1026.1400000000001,1047.9400000000001,1057.0899999999999,1018.16,932.91999999999996,922.40999999999997,908.20000000000005,898.26999999999998,854.48000000000002,864.79999999999995,894.57000000000005,898.26999999999998,905.08000000000004,913.64999999999998,866.74000000000001,865.57000000000005,859.35000000000002,816.13999999999999,837.15999999999997,825.28999999999996,824.70000000000005,809.33000000000004,789.48000000000002,749.38,754.83000000000004,773.32000000000005,774.67999999999995,778.38,788.30999999999995,825.28999999999996,835.79999999999995,854.48000000000002,878.41999999999996,889.71000000000004,943.42999999999995,939.13999999999999,924.94000000000005,965.41999999999996,999.66999999999996,939.13999999999999,852.52999999999997,886.21000000000004,963.08000000000004,979.24000000000001,1013.88,1024.97,1028.6700000000001,1005.9,990.91999999999996,1001.42,1062.73,893.40999999999997,880.37,924.94000000000005,1011.9299999999999,1028.0899999999999,849.23000000000002,840.86000000000001,948.88,905.08000000000004,780.90999999999997],"y":[75.069999999999993,81.329999999999998,163.21000000000001,193.09999999999999,216.55000000000001,250.75,229.06,211.66999999999999,194.28,153.24000000000001,175.13,250.16999999999999,211.08000000000001,228.47,297.25999999999999,255.63999999999999,228.47,204.24000000000001,184.31,165.75,203.66,180.59999999999999,142.69,158.31999999999999,177.47,451.82999999999998,407.67000000000002,385.38999999999999,365.66000000000003,274.98000000000002,256.42000000000002,216.55000000000001,196.81999999999999,200.53,359.99000000000001,384.22000000000003,405.32999999999998,425.06,397.89999999999998,376.20999999999998,356.27999999999997,330.29000000000002,310.35000000000002,289.25,288.07999999999998,314.06999999999999,336.33999999999997,381.08999999999997,341.42000000000002,359.99000000000001,291.00999999999999,309.76999999999998,339.47000000000003,345.72000000000003,325.20999999999998,276.74000000000001,360.57999999999998,414.50999999999999,399.45999999999998,413.92000000000002,125.48999999999999,144.06,116.7,92.469999999999999,74.489999999999995,86.989999999999995,97.549999999999997,105.75,130.96000000000001,425.06,427.60000000000002,449.29000000000002,301.56,271.86000000000001,181.97,170.05000000000001,147.77000000000001,106.73,332.04000000000002,314.06999999999999,176.88999999999999,245.09,266.97000000000003,266.19,300.97000000000003,230.22999999999999,99.890000000000001,105.56,173.75999999999999,122.36,317.77999999999997],"z":[144,256,306,451.5,410,264,342,399,60,217,297.5,136.5,162,169,280.5,430.5,361,380,342,240,420,369,144,203,217.5,120,143.75,196,247.5,239.25,138,110,90,256,196,225,210,256,360.75,324,210.25,224,333,432,338.25,256,315,232,232.5,247.5,315,324,255.75,217.5,370.5,360,240,217.5,210.25,239.25,137.5,288,195,156,150,132,144,240.25,175.5,169,310,181.25,110,156,143,143.75,182.25,210.25,162.5,181.25,132,272,288.85000000000002,472.5,195.75,248,162,195.75,20,156,155.25],"type":"scatter3d","mode":"markers","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>If we wish to examine the relationships between (three or more) variables we could do so with a conditioning plot, otherwise known as a <strong>coplot</strong>. A coplot is a scatterplot matrix where each panel in the matrix is a scatterplot of the same two variables, whose observations are restricted by the values of a third (and possibly a fourth) variable.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coplot</span>(Top<span class="sc">~</span> First <span class="sc">|</span> Second<span class="sc">*</span>Area, <span class="at">data =</span> pinetree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-coplt" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-coplt-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;39: A co-plot</figcaption>
</figure>
</div>
</div>
</div>
<p>The coplot in <a href="#fig-coplt">Figure&nbsp;39</a> shows that pine trees are not maturing well in Area 3, given that fewer points are on the right hand side of the graph when compared to Areas 1 and 2.</p>
<p>Obviously we cannot to visualise several dimensions easily but there are few shortcuts for multivariate data visualisation such as the Chernoff or cartoon faces plot. This type of plot is based on our ability to recognise features in human faces. This type of plot is suitable for small datasets and identify unusual observations, for example observation #46 in <em>horsehearts</em> data shown in <a href="#fig-faceplot">Figure&nbsp;40</a>.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>effect of variables:
 modified item       Var       
 "height of face   " "INNERSYS"
 "width of face    " "INNERDIA"
 "structure of face" "OUTERSYS"
 "height of mouth  " "OUTERDIA"
 "width of mouth   " "EXTSYS"  
 "smiling          " "EXTDIA"  
 "height of eyes   " "WEIGHT"  
 "width of eyes    " "INNERSYS"
 "height of hair   " "INNERDIA"
 "width of hair   "  "OUTERSYS"
 "style of hair   "  "OUTERDIA"
 "height of nose  "  "EXTSYS"  
 "width of nose   "  "EXTDIA"  
 "width of ear    "  "WEIGHT"  
 "height of ear   "  "INNERSYS"</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-faceplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-faceplot-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;40: A Cartoon Faces plot</figcaption>
</figure>
</div>
</div>
</div>
<p>Exploration of higher dimensional data requires further theory. Reduction of dimensions and display of crucial information using newly generated variables based on the theory of multivariate statistics are the natural way to explore higher dimensional data. Many such approaches are taught mainly in 300 level papers. A couple of such methods are explained below:</p>
<p>One of the tricks to handle multidimensional data is to reduce the number of dimensions using <em>principal components</em>. These are simply linear combinations of the original variables and may not have physical meaning. In some cases, we may be able to identify a latent variable that represents such a linear combination of variables. For example, <code>physical endurance</code> is latent but can be measured indirectly using many variables such as time taken to run 100m, maximum weight lifted etc. The first principal component (PC) is found in such a way that it accounts for the most variation in the data. The second principal component is found independent of the first in such a way that it accounts for the most variation that is not explained by the first principal component. The following output shows that the first two components are sufficient to explain most (&gt;98%) of the variation in the four numerical variables in the pinetree dataset.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(pinetree[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of components:
                          PC1     PC2     PC3    PC4
Standard deviation     1.9579 0.32825 0.19678 0.1415
Proportion of Variance 0.9584 0.02694 0.00968 0.0050
Cumulative Proportion  0.9584 0.98532 0.99500 1.0000</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Try autoplot(fit)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A biplot aims to show both the observations and variables in the same plot formed by the first two principal components. <a href="#fig-biplot">Figure&nbsp;41</a> shows the biplot for the pinetree variables and data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit, <span class="at">loadings =</span> <span class="cn">TRUE</span>, <span class="at">loadings.label =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-biplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-biplot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;41: A biplot</figcaption>
</figure>
</div>
</div>
</div>
<p>For interpreting the biplot, consider the following patterns:</p>
<ol type="1">
<li><p>If points that are close to each other, it means observations with similar values. So you can spot the odd ones.</p></li>
<li><p>The correlation between variables is indicated by the cosine of the angle between vectors displayed for the variables. Highly correlated variables will point in the same direction. If variables are uncorrelated, they will be at right angles to each other. For the pine tree data, we notice high correlation. This has implications in model building. We may not need all of the three predictor variables of Top. More will follow in later Chapters.</p></li>
<li><p>The cosine of the angle between a vector and an axis indicates the contribution of the corresponding variable to the axis dimension. Look particularly the X-axis that represents the first principal component. The variables contribute somewhat the same.</p></li>
</ol>
<p>Note that the biplot is not useful if the first two principal components account for only a small part of the overall variation. We can also examine relationship between the categorical factors and the principal components but this topic is skipped in this course.</p>
</section>
</section>
<section id="time-series-eda" class="level1">
<h1>Time series EDA</h1>
<p>A <strong>Time Series</strong> is an ordered sequence of observations of a variable(s) (often) made at equally spaced time points. Time series data may have internal structures such as trends, seasonality, cycles etc. Such internal structural variation is largely absent in randomly collected data which are observed one-at-a-time (called cross-section data). Time series data analysis is useful in business and economic forecasting, stock market analysis, quality control etc. The objective of time series analysis is to understand the structure that generated the time-oriented data, fit a model, monitor and forecast if necessary.</p>
<p>Consider the value of $20 notes (in NZ$ millions) that were in the hands of the New Zealand public (as at last the Wednesday in March each year) for the time period 1968 onward available at the Reserve Bank of New Zealand website <a href="https://www.rbnz.govt.nz/statistics/f3" class="uri">https://www.rbnz.govt.nz/statistics/f3</a>. <a href="#fig-nzd20ts">Figure&nbsp;42</a> shows the time series plot of the $20 notes series.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>notes20 <span class="ot">&lt;-</span> <span class="fu">read_table</span>(</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"http://www.massey.ac.nz/~anhsmith/data/20dollar.txt"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
── Column specification ────────────────────────────────────────────────────────
cols(
  year = col_double(),
  value = col_double()
)</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>NZnotes20 <span class="ot">&lt;-</span> notes20 <span class="sc">/</span> <span class="dv">1000</span>  <span class="co"># converting to millions</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>NZnotes20 <span class="ot">&lt;-</span> <span class="fu">ts</span>(NZnotes20, <span class="at">start=</span><span class="dv">1968</span>, <span class="at">frequency=</span><span class="dv">1</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(NZnotes20, </span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">"Year"</span>, </span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab=</span><span class="st">"Value of $20 notes (millions)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-nzd20ts" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-nzd20ts-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;42: Time series plot of the value of NZD 20 notes in public circulation in NZ</figcaption>
</figure>
</div>
</div>
</div>
<p>It is easy to see the ‘growth effect’ of time on the value of $20 notes held by the public. The amount of $20 bills held by the public is affected by various known and unknown factors which are correlated with time. This allows us to conveniently treat ‘time’ as the single explanatory variable representing several other factors (variables). We also note other types of structural variations such as mild cycles (in addition to the exponential trend in the beginning and then settling in the recent years) that are time oriented in <a href="#fig-nzd20ts">Figure&nbsp;42</a>.</p>
<p>In order to study seasonal variation, yearly series such as $20 bills series are inadequate. We will be needing a series observed in shorter term such as daily, weekly or monthly. The monthly credit card balances in New Zealand is available at <a href="https://www.rbnz.govt.nz/statistics/c12" class="uri">https://www.rbnz.govt.nz/statistics/c12</a>. This series begins from Dec 2004. We import this data first in <code>R</code> /<code>RStudio</code> and consider the (daily average) outstanding credit card balances (in million $).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"http://www.massey.ac.nz/~anhsmith/data/hc12_daily_average_balances.xlsx"</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>destfile <span class="ot">&lt;-</span> <span class="st">"hc12.xlsx"</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>curl<span class="sc">::</span><span class="fu">curl_download</span>(url, destfile)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>hc12b <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(destfile, <span class="at">na =</span> <span class="st">"-"</span>, <span class="at">skip =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The time series plot of the outstanding credit card balances series is shown in <a href="#fig-float">Figure&nbsp;43</a>. This series shows strong trends as well as seasonality. In the next section, we will discuss how to assess the features of a time series further.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>credit.balance <span class="ot">&lt;-</span> hc12b <span class="sc">|&gt;</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(CRCD.MOA20) <span class="sc">|&gt;</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> </span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">start=</span><span class="fu">c</span>(<span class="dv">2000</span>,<span class="dv">7</span>), <span class="at">frequency=</span><span class="dv">12</span>)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">autoplot</span>(credit.balance, <span class="at">xlab=</span><span class="st">"Year"</span>, <span class="at">ylab=</span><span class="st">"Rate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-float" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-float-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;43: Time series plot of outstanding credit card balances</figcaption>
</figure>
</div>
</div>
</div>
<section id="autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="autocorrelation">Autocorrelation</h2>
<p>Time series data are not often independent and there often exists a relationship between the current observation <span class="math inline">\(X_t\)</span> at time <span class="math inline">\(t\)</span> with the past observations <span class="math inline">\(X_j\)</span> <span class="math inline">\((j=t-1, t-2, \ldots, 1)\)</span>. The term <em>first order lag</em> refers to <span class="math inline">\(X_{j-1}\)</span> for <span class="math inline">\(X_j\)</span>. In general the <span class="math inline">\(k^\text {th}\)</span> lag refers to a past observation of <span class="math inline">\(k\)</span> periods back. We may explore the time related linear dependency in time series data using lagplots. <a href="#fig-lplt">Figure&nbsp;44</a> is a lag plot for the NZ $20 series.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gglagplot</span>(NZnotes20)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-lplt" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-lplt-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;44: Lag plot of NZD 20 notes series</figcaption>
</figure>
</div>
</div>
</div>
<p>This plot suggests that the time related dependency is rather strong for lower order <span class="math inline">\(k\)</span> but the lag effect diminishes when <span class="math inline">\(k\)</span> becomes large . This is a good thing because we can use recent lagged data as predictors in our models.</p>
<p>By the term <em>autocorrelation</em> we mean the simple correlation between the observations but lagged back one or more time periods. For a given lag <span class="math inline">\(k\)</span>, the <strong>sample autocorrelation function</strong> (SACF or simply <strong>ACF</strong>) is defined as</p>
<p><span class="math display">\[r_{k} = \frac{ \sum \limits_{t=k+1}^N (y_{t}-\bar{y})(y_{t-k}-\bar{y})} {\sum \limits_{t=1}^T (y_{t}-\bar{y})^2}\]</span></p>
<p>where <span class="math inline">\(N\)</span> is the length of the time series. SACFs can be used to make a tentative assessment of the terms or order of the model. <a href="#fig-acfplt">Figure&nbsp;45</a> is the plot of SACF values (called ACF plot or correlogram) for the NZ $20 series.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(NZnotes20)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-acfplt" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-acfplt-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;45: ACF plot of NZD 20 notes series</figcaption>
</figure>
</div>
</div>
</div>
<p>This graph shows that the autocorrelations decay to zero (implying that the value of $20 notes in public hands positively depend on the values of $20 notes held in the immediate past rather than the distant past). The significance of autocorrelations may be judged from the <strong>95% confidence interval band</strong>. More on this later.</p>
<p>We also plot the partial autocorrelations instead of autocorrelations. Partial Autocorrelation Function (PACF) at a given time is without the linear effect of other lags. <a href="#fig-pacfplt">Figure&nbsp;46</a> shows the PACF plot for the ‘$20 Notes’ series. Only the first PACF is significant and not the rest. This means that the first lag is sufficient and the rest may not be needed for modelling.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggPacf</span>(NZnotes20)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-pacfplt" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-pacfplt-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;46: PACF plot of NZD 20 notes series</figcaption>
</figure>
</div>
</div>
</div>
<p>Both ACF and PACF plots are useful to assess the time series components which is discussed next.</p>
</section>
<section id="time-series-components-of-variation" class="level2">
<h2 class="anchored" data-anchor-id="time-series-components-of-variation">Time Series Components of Variation</h2>
<p>The nature of structural variations in a time series are broadly classified under three major headings:</p>
<section id="trend" class="level3">
<h3 class="anchored" data-anchor-id="trend">Trend</h3>
<p>The trend component is to represent long term positive (upward) or negative (downward) movement. See <a href="#fig-trendtype">Figure&nbsp;47</a> below which lists some of the parametric models for fitting the trend component:</p>
<div id="fig-trendtype" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/8-2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;47: Trend types</figcaption>
</figure>
</div>
<p>We will cover more on fitting models to capture the trend later on.</p>
</section>
<section id="seasonal" class="level3">
<h3 class="anchored" data-anchor-id="seasonal">Seasonal</h3>
<p>The seasonal component is to account for the periodic behaviour happening <em>within</em> a block (say Christmas time) of a given time period (say in a calendar year) but this periodic behaviour will repeat fairly regularly over time (say year after year). Seasonality is often present in business related time series data. EDA tools are useful for judging the presence of seasonality. A simple scatterplot of the response variable against time may reveal seasonality directly. <a href="#fig-uvplot">Figure&nbsp;48</a> is a time series plot of monthly means of Erythemal UV, the sunburn causing UV, measured at Lauder (45.0S, 169.7E), New Zealand (<strong>uv.txt</strong>).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>uv <span class="ot">&lt;-</span> <span class="fu">read_table</span>(<span class="st">"http://www.massey.ac.nz/~anhsmith/data/uv.txt"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(erythemal.uv) <span class="sc">|&gt;</span> </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1990</span>, <span class="dv">01</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">autoplot</span>(uv, <span class="at">xlab=</span><span class="st">"Year"</span>, <span class="at">ylab=</span><span class="st">"Erythemal UV"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-uvplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-uvplot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;48: Time series plot revealing seasonality</figcaption>
</figure>
</div>
</div>
</div>
<p>Seasonality is more easily seen graphically when two or more grouping variables such as month is used to subset the data as has been done in <a href="#fig-uvmon">Figure&nbsp;49</a>. All tools of EDA covered in this Chapter such as boxplots etc will also be useful to explore seasonal effects. The autocorrelation plot is also useful for detecting seasonality.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># monthplot(uv) or</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsubseriesplot</span>(uv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-uvmon" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-uvmon-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;49: Month plot revealing seasonality</figcaption>
</figure>
</div>
</div>
</div>
<p>A different version of the plot, known as season plot, can also be used; see <a href="#fig-sesplt">Figure&nbsp;50</a> drawn for the credit balances data. This plot shows the month related seasonal effects over the years. We can also assess whether the seasonal effect is the same for various years or not using this plot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggseasonplot</span>(credit.balance, <span class="at">year.labels=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-sesplt" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-sesplt-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;50: Seasonal plot for credit balances series</figcaption>
</figure>
</div>
</div>
</div>
<p>The ACF plot is also useful to assess seasonality. <a href="#fig-uvacfplt">Figure&nbsp;51</a> shows a scallop pattern which is attributed to seasonality.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(uv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-uvacfplt" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-uvacfplt-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;51: ACF plot of uv series</figcaption>
</figure>
</div>
</div>
</div>
<p><code>Spectral plot</code> is another graphical technique for examining cyclic structure of variation in time series data. This plot is based on a sinusoidal model. The cycle frequency is expressed per unit of time where a unit of time is the distance between 2 time series points. A frequency of 0.5 means a cycle of 2 time series data points. Methods are available to determine the amplitude and the dominant frequency etc under the sinusoidal model.</p>
</section>
<section id="error" class="level3">
<h3 class="anchored" data-anchor-id="error">Error</h3>
<p>This component of the time series is to account for the random or irregular movement in the series. Ideally the plot of errors should not show any time effect; for example plotting a set of random normal data will not show any of the systematic time related components, see <a href="#fig-whtnoise">Figure&nbsp;52</a>. Such a series is called a <code>white noise</code> series.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>whtnoise <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">rnorm</span>(<span class="dv">120</span>), <span class="at">start=</span><span class="dv">1</span>, <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">autoplot</span>(whtnoise, </span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xlab=</span><span class="st">"time"</span>, </span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ylab=</span><span class="st">"N(0,1) random data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-whtnoise" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-whtnoise-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;52: Time series plot of random normal data</figcaption>
</figure>
</div>
</div>
</div>
<p>The ACF plot of our white noise series is shown in <a href="#fig-acwhtnoise">Figure&nbsp;53</a>. As you would expected, the ACFs are small in size and not significant. The ACFs also do not die out in any systematic pattern too.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(whtnoise)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-acwhtnoise" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-acwhtnoise-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;53: ACF plot of random normal data</figcaption>
</figure>
</div>
</div>
</div>
<p>It is the practice to assume a typical structural interrelationship between the trend, seasonal or cyclical components of a time series. This may be done using an <strong>additive model</strong> for the observation at time <span class="math inline">\(t\)</span> say <span class="math inline">\(X_t\)</span> as</p>
<p><span class="math inline">\(X_t\)</span> = <strong>Trend + Seasonal + Error</strong></p>
<p>or, using the multiplicative model,</p>
<p><span class="math inline">\(X_t\)</span> = Trend <span class="math inline">\(\times\)</span> Seasonal + Error.</p>
<p>The <strong>multiplicative model</strong> takes the interaction between the components into account whereas the additive model assumes independence of the components. We have not explicitly considered the cyclical component of variation in the models and assume that the either the trend or the seasonal part of the model will include it.</p>
<p>Consider the UV series, which is a short time series. Hence this series may not reveal secular (long term) trend or cycles. <a href="#fig-clasdecomp">Figure&nbsp;54</a> shows the decomposition done for the UV series. While this plot is useful in revealing the seasonality, trend component is probably over-fitted.</p>
<p>The associated standard error bars also appear on the RHS side of the plot and the trend estimation is done poorly after all.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>uv <span class="sc">|&gt;</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">decompose</span>(<span class="at">type=</span><span class="st">"additive"</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">autoplot</span>() <span class="sc">+</span> </span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-clasdecomp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-clasdecomp-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;54: Classical decomposition for UV data</figcaption>
</figure>
</div>
</div>
</div>
<p>The classical decomposition done for the credit card balances data is shown in <a href="#fig-clasdecomp1">Figure&nbsp;55</a>. For this series, the trend component is strong and estimated well. The seasonal component is weaker and not estimated well at all.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>credit.balance <span class="sc">|&gt;</span> </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">decompose</span>(<span class="at">type=</span><span class="st">"additive"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">autoplot</span>() <span class="sc">+</span> </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-clasdecomp1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2-eda_files/figure-html/fig-clasdecomp1-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;55: Classical decomposition for credit data</figcaption>
</figure>
</div>
</div>
</div>
<p>There are many approaches to decomposing the components of a time series. Some are designed to improve forecasting. These methods are covered in higher level statistics courses.</p>
<p>By the term <em>detrending</em>, we mean the process of removing the trend from a time series. This can be model based. For example, we may fit a S-type logistic model and the residuals of this model is called the detrended series, which mainly contains the seasonal and error components of variation. The other approach to detrending is to apply differencing which is discussed later on. There are also nonparametric approaches to fitting trends. For example, the moving average smoothing (discussed in a later Chapter) can be treated as fit (filter) and the residuals after smoothing can be regarded as detrended data.</p>
<p>By the term <em>deseasoning</em> we mean the process of removing the seasonal component of the variation in a time series. For example, we may use a regression approach to deseason the series after fitting the model with seasonal indicator variables. We may also use seasonal differencing or use trigonometric functions for deseasoning.</p>
<p>It is not always easy to completely separate trends from seasonal effect but time series decomposition helps us to understand the underlying complexities.</p>
<p><code>R</code> packages are available for exploring spatial data, particularly for integrating with maps. Some software programs also employ audio to augment exploration of higher dimensional data. Plots for EDA are introduced at an introductory level in this Chapter but there are many dedicated <code>R</code> packages available for conducting EDA in a specialised area such as finance or ecology.</p>
</section>
</section>
</section>
<section id="summary" class="level1">
<h1>Summary</h1>
<p>The first step in EDA is to familiarise oneself with the data. The dataset should be checked for errors. This is particularly important if this is to be the first time the data will be analysed. It is essential to know story behind the data such as the objectives for the collection of the data, and in what way was it collected etc. The answers to these questions should provide the focus for our own analysis of the data; i.e.&nbsp;what questions do we want to be able answer by our analysis of the data. Note that data may not always contain an answer to the questions we may have.</p>
<p>Our exploratory analysis now proceeds by attempting to understand the structure and peculiarities of the dataset. In particular, we may be interested in: numerical summaries or tabular display that present an overall summary of the data; graphical displays that describe the distribution of variables; graphical comparisons of different groups in the data; scatterplots or scatterplot matrices that reveal trends or relationships and other patterns between variables; and any interesting or outlying points in the data. The main thing in choosing graphics is that they should be simple and informative -not saying too much or too little, and not misleading. You should be able to say something meaningful on the basis of each graph.</p>
<p>Based on the EDA evidence, one or more candidate statistical models are fitted. These models are further improved or validated. After the analysis is complete, we need to be able to communicate our findings, clearly, accurately, effectively, and honestly, to any interested audience.</p>


<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Chatfield" class="csl-entry" role="listitem">
Chatfield, C. 1995. <em>Problem Solving, a Statistician’s Guide</em>. Chapman &amp; Hall/CRC Press, London.
</div>
<div id="ref-hofmann_letter-value_2017" class="csl-entry" role="listitem">
Hofmann, Heike, Hadley Wickham, and Karen Kafadar. 2017. <span>“Letter-<span>Value</span> <span>Plots</span>: <span>Boxplots</span> for <span>Large</span> <span>Data</span>.”</span> <em>Journal of Computational and Graphical Statistics</em> 26 (3): 469–77. <a href="https://doi.org/10.1080/10618600.2017.1305277">https://doi.org/10.1080/10618600.2017.1305277</a>.
</div>
<div id="ref-ioannidis_why_2005" class="csl-entry" role="listitem">
Ioannidis, John P. A. 2005. <span>“Why <span>Most</span> <span>Published</span> <span>Research</span> <span>Findings</span> <span>Are</span> <span>False</span>.”</span> <em>PLOS Medicine</em> 2 (8): e124. <a href="https://doi.org/10.1371/journal.pmed.0020124">https://doi.org/10.1371/journal.pmed.0020124</a>.
</div>
<div id="ref-nosek_preregistration_2018" class="csl-entry" role="listitem">
Nosek, Brian A., Charles R. Ebersole, Alexander C. DeHaven, and David T. Mellor. 2018. <span>“The Preregistration Revolution.”</span> <em>Proceedings of the National Academy of Sciences</em> 115 (11): 2600–2606. <a href="https://doi.org/10.1073/pnas.1708274114">https://doi.org/10.1073/pnas.1708274114</a>.
</div>
<div id="ref-Sturges" class="csl-entry" role="listitem">
Sturges, H. A. 1926. <span>“The Choice of a Class Interval.”</span> <em>Journal of the American Statistical Association</em> 21 (153): 65–66.
</div>
<div id="ref-Tufte2001" class="csl-entry" role="listitem">
Tufte, E. R. 2001. <em>The Visual Display of Quantitative Information</em>. Cheshire, Connecticut : Graphics Press.
</div>
<div id="ref-tukey1977" class="csl-entry" role="listitem">
Tukey, John W. 1977. <em>Exploratory Data Analysis</em>. Vol. 2. Reading, Mass.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../studyguide/1-data-collection.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Chapter 1: Data Collection and Quality Issues</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../studyguide/3-probability.html" class="pagination-link">
        <span class="nav-page-text">Chapter 3: Probability Concepts and Distributions</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb81" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Chapter 2: Exploratory Data Analysis (EDA)"</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; *"Data has no meaning apart from its context."*</span><span class="kw">&lt;br&gt;</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; — Walter A Shewhart</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; *Sherlock Holmes: "How do all these unusuals strike you, Watson?"*</span><span class="kw">&lt;br&gt;</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; *Dr. Watson: "Their cumulative effect is certainly considerable,and yet each of them is quite possible in itself"*</span><span class="kw">&lt;br&gt;</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; — Sir Arthur Conan Doyle, _The Adventure of the Abbey Grange_</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="fu"># The two modes of data analysis</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>Exploratory Data Analysis (EDA) is exactly as it sounds: the process of exploring a data set, usually by visual examination, calculating summary statistics, and making tables and graphical displays. Exploratory analysis was likened to detective work by John @tukey1977 in his seminal book. As in a detective story, the circumstances surrounding a crime can be accidental; it is important to keep in mind that not all patterns that you see in a sample data set will reflect true patterns in the population. </span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>When analysing data, it is important to keep front of mind the purpose of the analysis. One can distinguish between the following two broad modes of analysis:</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Exploratory** or **hypothesis-generating analyses** are about *discovering new patterns*. Such analyses are typically rather unstructured exploration by summarising data and making tables and graphs, without any preconceived ideas about what might be found. The purpose is often to produce better understanding of a system, and is a good way of generating new hypotheses that can be tested with subsequent data/experiments. </span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Confirmatory** or **inferential** or **hypothesis-testing analyses** are about *testing a priori ideas*. The ideas about what patterns would be present in the data were known to the analyst *prior to seeing the data*, often in accordance with some scientific theory about the mechanistic processes in the system under study. These analyses often take the form of fitting statistical models and performing formal hypothesis tests, and evaluating evidence for particular effects.</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>Here's the important part: one must no report an exploratory analysis as though it was a confirmatory analysis. In other words, if an exploratory data analysis leads you to a new scientific hypothesis, do not report this as though it were an *a priori* hypothesis that you then tested with those data. This is scientifically dishonest and is a major contributor to the replication crisis in science [@ioannidis_why_2005]. Taking a hypothesis that occurred to you after seeing patterns in the data, and *using that same data to test that hypothesis*, is a form of circular reasoning. The strength of any evidence obtained in this way is much weaker than if one tests a bona fide *a priori* hypothesis.</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>To address the issue of testing hypotheses with the same data that generated them, scientists are increasingly encouraged to publically *preregister* their scientific hypotheses before the data are even collected <span class="co">[</span><span class="ot">@nosek_preregistration_2018</span><span class="co">]</span>. This guarantees that there was no "data snooping" for patterns prior to hypothesis testing.</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>So, if you have any *a priori* ideas and hypotheses about what patterns you might see in the data (e.g., the mean of $y$ will be higher for group $A$ than group $B$), before you look at or even collect the data, it is wise to write them down or, better still, formally preregister them. This will help clarify the purpose of the analysis, and reduce the risk of misrepresenting your results.</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>From the <span class="co">[</span><span class="ot">Center for Open Science website</span><span class="co">](https://www.cos.io/initiatives/prereg)</span>:</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Preregistration separates *hypothesis-generating* (exploratory) from *hypothesis-testing* (confirmatory) research. Both are important. But the same data cannot be used to generate and test a hypothesis, which can happen unintentionally and reduce the credibility of your results. Addressing this problem through planning improves the quality and transparency of your research. This helps you clearly report your study and helps others who may wish to build on it. For instructions on how to submit a preregistration on OSF, please visit our help guides.</span></span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a><span class="al">![](../img/confexpl.png)</span></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a>Of course, *hypothesis-generating* (exploratory) and *hypothesis-testing* (confirmatory) modes of analysis are by no means mutually exclusive. Calculating summary statistics and making tables and plots are an important part of inferential analyses, and one can use inferential statistics (e.g., confidence intervals) to summarise patterns seen in exploratory analyses.</span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>See <span class="co">[</span><span class="ot">this blog post</span><span class="co">](https://statmodeling.stat.columbia.edu/2022/09/06/exploratory-and-confirmatory-data-analysis/)</span> by Andrew Gelman for more on how the two modes fit together.</span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a><span class="fu"># The basics of Exploratory Data Analysis</span></span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a>Following @Chatfield, here are some guidelines for tackling statistical analyses.</span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Make sure you understand the structure of the data, including what was measured, how, and why. </span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Write down the purpose of the analysis in the form of aims, research questions, and/or hypotheses, and make a plan for how to test any formal hypotheses, including evaluating the validity of assumptions.</span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Critically examine the data to check for errors, inconsistencies, and mismatches with the structure of the data as you understand it.</span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Explore the data with summary statistics, tables, and plots.</span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Conduct any inferential statistical analyses. Use statistics, tables, and plots to </span>
<span id="cb81-51"><a href="#cb81-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-52"><a href="#cb81-52" aria-hidden="true" tabindex="-1"></a>    a) check the assumptions of the analysis and </span>
<span id="cb81-53"><a href="#cb81-53" aria-hidden="true" tabindex="-1"></a>    b) summarise the results.</span>
<span id="cb81-54"><a href="#cb81-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-55"><a href="#cb81-55" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Be honest and use common sense.</span>
<span id="cb81-56"><a href="#cb81-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-57"><a href="#cb81-57" aria-hidden="true" tabindex="-1"></a>As discussed in Chapter 1, one must be congnisant to how the data were collected and any sampling biases that may be present. What is the population of interest, and is the sample representative of that population? Were the methods of recording the data accurate? Finally, what exactly does each variable represent? Are the variables contained in the data direct measurements of the variable of interest, or merely convenient surrogates?</span>
<span id="cb81-58"><a href="#cb81-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-59"><a href="#cb81-59" aria-hidden="true" tabindex="-1"></a><span class="fu">## Error checking</span></span>
<span id="cb81-60"><a href="#cb81-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-61"><a href="#cb81-61" aria-hidden="true" tabindex="-1"></a>  The data are assumed to be in some sort of electronic form; e.g. text file, spreadsheet, database, etc. Before analysing the data, it is prudent to check for mistakes in the data. If one has access to the raw data (e.g. returned questionnaires), one can check observations by hand. If the raw data are not available, then the best one can do is to look for observations whose values are out of allowable ranges, or are very suspicious. A common problem occurs with the coding of missing information. Missing values are commonly recorded as a blank, <span class="in">`*`</span>, <span class="in">`-1`</span>, <span class="in">`-999`</span>, or <span class="in">`NA`</span>. Only one type of coding should be used. The use of <span class="in">`NA`</span> is preferred since this is easier to spot. The use of blanks is particularly dangerous when one is exporting data from a spreadsheet to a text file. When the data from the text file is read into a computer package, a missing value may be skipped and the value from the next observation read in its place. When the data set is large, looking at a data set one observation at a time may not be feasible. In this case, plotting the data may show any observations with illegal values.</span>
<span id="cb81-62"><a href="#cb81-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-63"><a href="#cb81-63" aria-hidden="true" tabindex="-1"></a><span class="fu">## Understanding data</span></span>
<span id="cb81-64"><a href="#cb81-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-65"><a href="#cb81-65" aria-hidden="true" tabindex="-1"></a>After any data errors have been found and corrected, the data understanding stage commences. This stage involves tabulating, summarising, and plotting the data in many ways to gain insight into the data set. We typically want to: </span>
<span id="cb81-66"><a href="#cb81-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-67"><a href="#cb81-67" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>examine the distributions, or shapes, of individual variables; </span>
<span id="cb81-68"><a href="#cb81-68" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>compare different groups of data, with special emphasis on location and scale; </span>
<span id="cb81-69"><a href="#cb81-69" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>and discover any trends and relationships exhibited between pairs of variables. </span>
<span id="cb81-70"><a href="#cb81-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-71"><a href="#cb81-71" aria-hidden="true" tabindex="-1"></a>Again, don't fall into the trap of **data snooping**, where you develop and test hypotheses with the same data. For instance, suppose that boxplots of the income of individuals in different age groups show that youngest and oldest age groups are the most different. If one elects to perform the hypothesis test for the difference between these two groups based on observations made during EDA, the resulting $p$-value is not valid.</span>
<span id="cb81-72"><a href="#cb81-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-73"><a href="#cb81-73" aria-hidden="true" tabindex="-1"></a>In the sections below, we briefly review many common tools used to visualise data during EDA.</span>
<span id="cb81-74"><a href="#cb81-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-75"><a href="#cb81-75" aria-hidden="true" tabindex="-1"></a><span class="fu"># Categorical Data</span></span>
<span id="cb81-76"><a href="#cb81-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-77"><a href="#cb81-77" aria-hidden="true" tabindex="-1"></a>There are many methods for examining categorical variables. We will explore several methods, including tables, bar charts, dot plots, and pie charts. These tools are covered in foundation courses and hence we will briefly review them.</span>
<span id="cb81-78"><a href="#cb81-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-79"><a href="#cb81-79" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bar chart</span></span>
<span id="cb81-80"><a href="#cb81-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-81"><a href="#cb81-81" aria-hidden="true" tabindex="-1"></a>The rules for constructing a bar chart are very simple and perhaps they can be reduced to a single rule and that is to make the *height of each bar proportional to the quantity displayed*. Consider the dataset **Snodgrass** available in the <span class="in">`R`</span> package <span class="in">`archdata`</span>. This dataset contains information on the size, location and contents of 91 house pits at the Snodgrass site which was occupied between about CE 1325-1420. The variable names and their description are given below:</span>
<span id="cb81-82"><a href="#cb81-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-83"><a href="#cb81-83" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`East`</span>: East grid location of house in feet (excavation grid system)</span>
<span id="cb81-84"><a href="#cb81-84" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`South`</span>: East grid location of house in feet (excavation grid system)</span>
<span id="cb81-85"><a href="#cb81-85" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Length`</span>: House length in feet </span>
<span id="cb81-86"><a href="#cb81-86" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Width`</span>: House width in feet  </span>
<span id="cb81-87"><a href="#cb81-87" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Segment`</span>: Three areas within the site 1, 2, 3  </span>
<span id="cb81-88"><a href="#cb81-88" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Inside`</span>: Location within or outside the "white wall" Inside, Outside  </span>
<span id="cb81-89"><a href="#cb81-89" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Area`</span>: Area in square feet  </span>
<span id="cb81-90"><a href="#cb81-90" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Points`</span>: Number of projectile points  </span>
<span id="cb81-91"><a href="#cb81-91" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Abraders`</span>: Number of abraders  </span>
<span id="cb81-92"><a href="#cb81-92" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Discs`</span>: Number of discs  </span>
<span id="cb81-93"><a href="#cb81-93" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Earplugs`</span>: Number of earplugs  </span>
<span id="cb81-94"><a href="#cb81-94" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Effigies`</span>: Number of effigies  </span>
<span id="cb81-95"><a href="#cb81-95" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Ceramics`</span>: Number of ceramics  </span>
<span id="cb81-96"><a href="#cb81-96" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Total`</span>: Total Number of artifacts listed above  </span>
<span id="cb81-97"><a href="#cb81-97" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Types`</span>: Number of kinds of artifacts listed above</span>
<span id="cb81-98"><a href="#cb81-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-99"><a href="#cb81-99" aria-hidden="true" tabindex="-1"></a>The data from 91 house pits at the Snodgrass site were reported by Price and Giffin in 1979. The layout of the houses follows a grid pattern with the long axis oriented north-east surrounded by a fortification trench. There is also evidence of an interior wall that may have separated the houses inside that wall from those outside the wall. Price and Griffin use differences in house size and artifacts composition to suggest that those distinctions may have reflected rank differences between the occupants of the two areas.</span>
<span id="cb81-100"><a href="#cb81-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-101"><a href="#cb81-101" aria-hidden="true" tabindex="-1"></a>The distribution of number of Ceramics found can be displayed in the form of a bar chart; see @fig-barchart.</span>
<span id="cb81-102"><a href="#cb81-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-105"><a href="#cb81-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-106"><a href="#cb81-106" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb81-107"><a href="#cb81-107" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb81-108"><a href="#cb81-108" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb81-109"><a href="#cb81-109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-110"><a href="#cb81-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-113"><a href="#cb81-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-114"><a href="#cb81-114" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-115"><a href="#cb81-115" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb81-116"><a href="#cb81-116" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-barchart</span></span>
<span id="cb81-117"><a href="#cb81-117" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Bar Chart of Ceramics counts'</span></span>
<span id="cb81-118"><a href="#cb81-118" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Snodgrass, <span class="at">package =</span> <span class="st">"archdata"</span>)</span>
<span id="cb81-119"><a href="#cb81-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-120"><a href="#cb81-120" aria-hidden="true" tabindex="-1"></a>Snodgrass <span class="sc">|&gt;</span> </span>
<span id="cb81-121"><a href="#cb81-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-122"><a href="#cb81-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Ceramics) <span class="sc">+</span> </span>
<span id="cb81-123"><a href="#cb81-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span>
<span id="cb81-124"><a href="#cb81-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-125"><a href="#cb81-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-126"><a href="#cb81-126" aria-hidden="true" tabindex="-1"></a>The bar graph illustrates clearly that no ceramics were found in many houses but a lot were found in a few houses. This may be due to status and wealth of the occupants.</span>
<span id="cb81-127"><a href="#cb81-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-128"><a href="#cb81-128" aria-hidden="true" tabindex="-1"></a>Note that we are treating number of Ceramics as ordinal in the above graph. For nominal data software tend to order the categories alphabetically.</span>
<span id="cb81-129"><a href="#cb81-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-130"><a href="#cb81-130" aria-hidden="true" tabindex="-1"></a>However, a graph is not always the best way to display a small set of numbers. Graphs do have some disadvantages: they take up a lot of space, and they do not usually allow the recovery of the exact observations. For these reasons, particularly for a small data sets, a table is sometimes more effective. There were only three segment categories; and their counts can be simply displayed as a table.</span>
<span id="cb81-131"><a href="#cb81-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-134"><a href="#cb81-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-135"><a href="#cb81-135" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Snodgrass<span class="sc">$</span>Segment)</span>
<span id="cb81-136"><a href="#cb81-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-137"><a href="#cb81-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-138"><a href="#cb81-138" aria-hidden="true" tabindex="-1"></a>It would be interesting to see whether the discovery of ceramics is Segment dependent. In other words, we would like to explore two factors in display. This can be done in many ways (@fig-barcharts).</span>
<span id="cb81-139"><a href="#cb81-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-142"><a href="#cb81-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-143"><a href="#cb81-143" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-144"><a href="#cb81-144" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-barcharts</span></span>
<span id="cb81-145"><a href="#cb81-145" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Bar Chart of Ceramics counts by Segment'</span></span>
<span id="cb81-146"><a href="#cb81-146" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb81-147"><a href="#cb81-147" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb81-148"><a href="#cb81-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-149"><a href="#cb81-149" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Snodgrass, <span class="at">package =</span> <span class="st">"archdata"</span>)</span>
<span id="cb81-150"><a href="#cb81-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-151"><a href="#cb81-151" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span></span>
<span id="cb81-152"><a href="#cb81-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Ceramics, <span class="at">fill =</span> Segment) <span class="sc">+</span> </span>
<span id="cb81-153"><a href="#cb81-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span> </span>
<span id="cb81-154"><a href="#cb81-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Bar plot with colour grouping"</span>)</span>
<span id="cb81-155"><a href="#cb81-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-156"><a href="#cb81-156" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span> </span>
<span id="cb81-157"><a href="#cb81-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Ceramics) <span class="sc">+</span> </span>
<span id="cb81-158"><a href="#cb81-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span> </span>
<span id="cb81-159"><a href="#cb81-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="fu">vars</span>(Segment)) <span class="sc">+</span> </span>
<span id="cb81-160"><a href="#cb81-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Segment-wise Bar plots"</span>)</span>
<span id="cb81-161"><a href="#cb81-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-162"><a href="#cb81-162" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span></span>
<span id="cb81-163"><a href="#cb81-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Ceramics, <span class="at">fill =</span> Segment) <span class="sc">+</span></span>
<span id="cb81-164"><a href="#cb81-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb81-165"><a href="#cb81-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Clustered Barplot"</span>)</span>
<span id="cb81-166"><a href="#cb81-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-167"><a href="#cb81-167" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span></span>
<span id="cb81-168"><a href="#cb81-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>Ceramics, <span class="at">fill =</span> Segment) <span class="sc">+</span> </span>
<span id="cb81-169"><a href="#cb81-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb81-170"><a href="#cb81-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Clustered Bar plot - flipped"</span>) <span class="sc">+</span></span>
<span id="cb81-171"><a href="#cb81-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>()</span>
<span id="cb81-172"><a href="#cb81-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-173"><a href="#cb81-173" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, p3, p4, <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb81-174"><a href="#cb81-174" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-175"><a href="#cb81-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-176"><a href="#cb81-176" aria-hidden="true" tabindex="-1"></a>It is easy to spot that the Ceramics findings were largely from the first segment. This EDA conclusion can be drawn from all of the above plots. However, these bar plots do not rate the same as a "presentation style graphic". </span>
<span id="cb81-177"><a href="#cb81-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-178"><a href="#cb81-178" aria-hidden="true" tabindex="-1"></a>Tufte (2001) argues in favour of certain principles of graphical integrity for presentation style graphics. These are:</span>
<span id="cb81-179"><a href="#cb81-179" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-180"><a href="#cb81-180" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>The representation of numbers in a graph should be directly proportional to the numbers themselves;</span>
<span id="cb81-181"><a href="#cb81-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-182"><a href="#cb81-182" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Clear and detailed labels should be used to prevent ambiguity;</span>
<span id="cb81-183"><a href="#cb81-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-184"><a href="#cb81-184" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Provide explanations and important events pertaining to data on the graphic itself;</span>
<span id="cb81-185"><a href="#cb81-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-186"><a href="#cb81-186" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>The graph should display data variation, not design variation—visual changes in the graph should be due to the data, not changes in way the data are drawn;</span>
<span id="cb81-187"><a href="#cb81-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-188"><a href="#cb81-188" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>The number of dimensions used in the graph should not exceed the number of dimensions in the data;</span>
<span id="cb81-189"><a href="#cb81-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-190"><a href="#cb81-190" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>Graphs must not quote data out of context; for example, a monthly drop in the murder rate of a city should be plotted within the context of the murder rate over the last few years, or murder rates in comparable cities over the same period.</span>
<span id="cb81-191"><a href="#cb81-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-192"><a href="#cb81-192" aria-hidden="true" tabindex="-1"></a>A final point concerns the use of colour. In many sorts of graphs, data types are differentiated by the use of colour. This practice is perfectly legitimate, but one should be aware that a surprising proportion of people have impaired colour perception, such as being unable to distinguish between red and green (see <span class="co">[</span><span class="ot">here</span><span class="co">](https://cran.r-project.org/web/packages/colorBlindness/vignettes/colorBlindness.html)</span> for colourblind-friendly pallettes). A remedy to these problems is to use different plotting symbols, line types, or shading, in conjunction with different colours. One should always make sure that the colours selected are clearly visible in the medium in which they are presented. Colours on a computer monitor can appear quite different when projected onto a screen in a lecture theatre, or when printed onto paper. </span>
<span id="cb81-193"><a href="#cb81-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-194"><a href="#cb81-194" aria-hidden="true" tabindex="-1"></a>According to @Tufte2001, a good graphical display should:</span>
<span id="cb81-195"><a href="#cb81-195" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-196"><a href="#cb81-196" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Display the data;</span>
<span id="cb81-197"><a href="#cb81-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-198"><a href="#cb81-198" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Encourage the viewer to concentrate on the substance of the data, in the context of the problem, not on the artistic merits of the graph;</span>
<span id="cb81-199"><a href="#cb81-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-200"><a href="#cb81-200" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Avoid distorting, intentionally or unintentionally, what the data have to say;</span>
<span id="cb81-201"><a href="#cb81-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-202"><a href="#cb81-202" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Have a high data to ink ratio; that is, convey the greatest amount of information in the shortest time with the least ink in the smallest space;</span>
<span id="cb81-203"><a href="#cb81-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-204"><a href="#cb81-204" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Enable one to easily compare different pieces of data;</span>
<span id="cb81-205"><a href="#cb81-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-206"><a href="#cb81-206" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>Reveal overall trends and patterns in the data that are not obvious from viewing the raw numbers;</span>
<span id="cb81-207"><a href="#cb81-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-208"><a href="#cb81-208" aria-hidden="true" tabindex="-1"></a><span class="ss">7.  </span>Reveal detailed information secondary to the main trend; for example, the location of outliers, variability of the response.</span>
<span id="cb81-209"><a href="#cb81-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-210"><a href="#cb81-210" aria-hidden="true" tabindex="-1"></a>This Chapter is largely concerned with EDA for discovery of patterns and peculiarities in a dataset. So we will not be too worried if the graphs produced are not aesthetically pleasing or does not meet a particular standard for a presentation style graph.</span>
<span id="cb81-211"><a href="#cb81-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-212"><a href="#cb81-212" aria-hidden="true" tabindex="-1"></a>The end goal of most analyses is of course some form of written report or presentation. In either case, the findings of the study, should be supported by tables and graphs created during the EDA; these should clarify and support the final conclusions, not deceive or confuse the audience. One should refrain from showing all tables and plots that were created, but rather a careful selection that reinforces the main findings. The remaining figures can, if necessary, be placed in an appendix of the written report. The figures and tables that are shown should be well labelled and annotated. Abbreviations and cryptic variable names should be replaced by sensible labels and descriptions. The emphasis should be on conveying information rather than producing an eye catching plot. Special care should be taken to ensure that the table or graph cannot be easily misinterpreted.</span>
<span id="cb81-213"><a href="#cb81-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-214"><a href="#cb81-214" aria-hidden="true" tabindex="-1"></a>In addition, a poorly made graph can be deceptive. This is a problem both in the understanding the data phase, and the presenting the data phase. One common mistake (but by no means the only one) in creating a graph is to use more dimensions to represent the data than there are data dimensions. For example, it is not uncommon to see a bar chart where the bars are drawn as three dimensional rectangular prisms. The false perspective actually obscures the differences in the heights of the bars.</span>
<span id="cb81-215"><a href="#cb81-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-216"><a href="#cb81-216" aria-hidden="true" tabindex="-1"></a>Another pitfall is to use a clever graphic rather than one that clearly presents the data. The classic example of this is a pictogram, where pictures of varying size represent some quantities. Pictograms are often drawn dishonestly: to show a two-fold difference, each side of the picture is increased by a factor of two, so the area is in fact increased by a factor of four. Dishonesty in data presentation is clearly unacceptable. But even an honest pictogram is usually not the best way to present data. It is difficult to accurately judge differences between areas; which is what a pictogram asks the viewer to do.</span>
<span id="cb81-217"><a href="#cb81-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-218"><a href="#cb81-218" aria-hidden="true" tabindex="-1"></a><span class="fu">## Pie charts</span></span>
<span id="cb81-219"><a href="#cb81-219" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-220"><a href="#cb81-220" aria-hidden="true" tabindex="-1"></a>Pie charts are a popular, though usually rather poor, way of presenting data. Like bar charts, they frequently use a large figure to represent just a few numbers. Pie charts also have a poor accuracy of decoding. That means people's impression of the difference in size between two pie slices is often quite different from the actual difference in size. Pie charts use angles to represent percentages; people tend to underestimate the size of acute angles and overestimate the size of obtuse angles (Stevens, 1957). The exploded pie chart makes it more difficult to accurately compare pie slices: the exploded piece always appears bigger. The three dimensional pie chart is even worse. Bar charts, dot charts, or tables should be preferred to pie charts.</span>
<span id="cb81-221"><a href="#cb81-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-222"><a href="#cb81-222" aria-hidden="true" tabindex="-1"></a>Count summaries of two categorical variables can be displayed in the form of a mosaic plot.</span>
<span id="cb81-223"><a href="#cb81-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-226"><a href="#cb81-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-227"><a href="#cb81-227" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Snodgrass<span class="sc">$</span>Inside, Snodgrass<span class="sc">$</span>Earplugs)</span>
<span id="cb81-228"><a href="#cb81-228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-229"><a href="#cb81-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-230"><a href="#cb81-230" aria-hidden="true" tabindex="-1"></a>@fig-mosaic shows the above tabulated counts graphically. Evidently, greater number of earplugs were found outside than inside.</span>
<span id="cb81-231"><a href="#cb81-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-234"><a href="#cb81-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-235"><a href="#cb81-235" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-236"><a href="#cb81-236" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-mosaic</span></span>
<span id="cb81-237"><a href="#cb81-237" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'A mosaic plot'</span></span>
<span id="cb81-238"><a href="#cb81-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-239"><a href="#cb81-239" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">table</span>(Snodgrass<span class="sc">$</span>Inside, Snodgrass<span class="sc">$</span>Earplugs)</span>
<span id="cb81-240"><a href="#cb81-240" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(tab, <span class="at">main=</span><span class="st">"Inside*Earplugs counts"</span>, <span class="at">ylab=</span><span class="st">"Earplugs"</span>)</span>
<span id="cb81-241"><a href="#cb81-241" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-242"><a href="#cb81-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-243"><a href="#cb81-243" aria-hidden="true" tabindex="-1"></a>The <span class="in">`R`</span> package <span class="in">`vcd`</span> can produce many other types of plots for categorical variables but these plots require an understanding of models fitted to categorical data. @fig-vcd1 displays the counts in a different way (and ignore the P value displayed in the plot). The test of association topic is covered later on.</span>
<span id="cb81-244"><a href="#cb81-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-247"><a href="#cb81-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-248"><a href="#cb81-248" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-249"><a href="#cb81-249" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-vcd1</span></span>
<span id="cb81-250"><a href="#cb81-250" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Association  plot'</span></span>
<span id="cb81-251"><a href="#cb81-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-252"><a href="#cb81-252" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb81-253"><a href="#cb81-253" aria-hidden="true" tabindex="-1"></a><span class="fu">assoc</span>(tab, <span class="at">shade=</span><span class="cn">TRUE</span>, <span class="at">legend=</span><span class="cn">TRUE</span>) </span>
<span id="cb81-254"><a href="#cb81-254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-255"><a href="#cb81-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-256"><a href="#cb81-256" aria-hidden="true" tabindex="-1"></a>Spine plots are a special cases of mosaic plots that mimics stacked bar plots; Try-.</span>
<span id="cb81-257"><a href="#cb81-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-260"><a href="#cb81-260" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-261"><a href="#cb81-261" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-262"><a href="#cb81-262" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-vcd2</span></span>
<span id="cb81-263"><a href="#cb81-263" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Spine plot'</span></span>
<span id="cb81-264"><a href="#cb81-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-265"><a href="#cb81-265" aria-hidden="true" tabindex="-1"></a><span class="fu">spine</span>(tab) </span>
<span id="cb81-266"><a href="#cb81-266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-267"><a href="#cb81-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-268"><a href="#cb81-268" aria-hidden="true" tabindex="-1"></a>A doubledecker plot is used to handle many factors. These plots become harder to interpret when the number of categorical factor levels becomes large; Try-</span>
<span id="cb81-269"><a href="#cb81-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-272"><a href="#cb81-272" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-273"><a href="#cb81-273" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-274"><a href="#cb81-274" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-ddker</span></span>
<span id="cb81-275"><a href="#cb81-275" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Doubledecker plot'</span></span>
<span id="cb81-276"><a href="#cb81-276" aria-hidden="true" tabindex="-1"></a><span class="fu">doubledecker</span>(Effigies<span class="sc">~</span>Inside<span class="sc">+</span>Segment,  <span class="at">data=</span>Snodgrass)</span>
<span id="cb81-277"><a href="#cb81-277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-278"><a href="#cb81-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-279"><a href="#cb81-279" aria-hidden="true" tabindex="-1"></a><span class="fu"># Numerical Data</span></span>
<span id="cb81-280"><a href="#cb81-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-281"><a href="#cb81-281" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dotplot</span></span>
<span id="cb81-282"><a href="#cb81-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-283"><a href="#cb81-283" aria-hidden="true" tabindex="-1"></a>One of the simplest kinds of graph for a numerical variable is the single line (or one dimensional) graph. Each observation is represented by a point (or a star <span class="in">`*`</span> or a dot <span class="in">`.`</span>) on the line. These graphs can be useful to see the rough distribution and gaps, if any, in the data. @fig-dot1 shows a dotplot of Length of the house pits for the Inside and Outside groupings. Evidently privileged tribes lived inside in general, and the length of their dwellings is longer.</span>
<span id="cb81-284"><a href="#cb81-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-287"><a href="#cb81-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-288"><a href="#cb81-288" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-289"><a href="#cb81-289" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb81-290"><a href="#cb81-290" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-dot1</span></span>
<span id="cb81-291"><a href="#cb81-291" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'A typical dot plot for two groups'</span></span>
<span id="cb81-292"><a href="#cb81-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-293"><a href="#cb81-293" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span></span>
<span id="cb81-294"><a href="#cb81-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>Inside, <span class="at">y=</span>Length) <span class="sc">+</span> </span>
<span id="cb81-295"><a href="#cb81-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dotplot</span>(<span class="at">binaxis=</span><span class="st">'y'</span>, <span class="at">dotsize=</span>.<span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb81-296"><a href="#cb81-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb81-297"><a href="#cb81-297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-298"><a href="#cb81-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-299"><a href="#cb81-299" aria-hidden="true" tabindex="-1"></a>On reflection, the one dimensional dotplot gives rise to a second dimension wherever observations are identical or nearly the same. In a dotplot such points are usually stacked. As our eyes tend to pick up trends very easily, they tend to be distracted by the vertical changes. The main problem here is that some of the values which coincide by chance may be taken to represent real increases in density. To overcome this we try 'jiggling' or jittering the data, which is equivalent to plotting a random number on the vertical axis against the data values on the horizontal axis. It is suggested that the vertical jiggle be restricted to a small range so that the overall effect is that of a one-dimensional spread with greater, or lesser, density of points along the graph. @fig-dot2 shows a jiggled dotplot. You can decide for yourself which strategy is better.</span>
<span id="cb81-300"><a href="#cb81-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-301"><a href="#cb81-301" aria-hidden="true" tabindex="-1"></a>Clearly, the use of jiggling is much more relevant for larger sets of data. Notice that with jiggling we are interested in the relative density of the graph in different places rather than in trends.</span>
<span id="cb81-302"><a href="#cb81-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-303"><a href="#cb81-303" aria-hidden="true" tabindex="-1"></a>As the vertical reading is determined at random our eyes may be distracted by a seeming trend which is mainly due to this randomness. For this reason, it is helpful to try more than one plot with different jiggles. This is in the spirit of EDA, in which data is viewed from as many angles as is feasible. The other side of this coin is that conclusions from one display of data should be treated with some scepticism. The availability of computers allows data to be plotted, tabulated and transformed quickly, so we should look at it several ways to better appreciate the peculiarities inherent in our data.</span>
<span id="cb81-304"><a href="#cb81-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-305"><a href="#cb81-305" aria-hidden="true" tabindex="-1"></a>In practice, one tends to avoid jiggling except in (two-variable) scatter plots where there are many repeated $(x, y)$ points. Graphs with a jiggle are mainly needed when the data are discrete or grouped in some way, or there are a large number of points to be plotted.</span>
<span id="cb81-306"><a href="#cb81-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-309"><a href="#cb81-309" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-310"><a href="#cb81-310" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb81-311"><a href="#cb81-311" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-dot2</span></span>
<span id="cb81-312"><a href="#cb81-312" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'A jittered dot plot'</span></span>
<span id="cb81-313"><a href="#cb81-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-314"><a href="#cb81-314" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span> </span>
<span id="cb81-315"><a href="#cb81-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>Inside, <span class="at">y=</span>Length) <span class="sc">+</span></span>
<span id="cb81-316"><a href="#cb81-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb81-317"><a href="#cb81-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb81-318"><a href="#cb81-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-319"><a href="#cb81-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-320"><a href="#cb81-320" aria-hidden="true" tabindex="-1"></a><span class="fu">## Histograms</span></span>
<span id="cb81-321"><a href="#cb81-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-322"><a href="#cb81-322" aria-hidden="true" tabindex="-1"></a>The histogram is a standard method of showing the distribution of a quantitative variable. A histogram is made by dividing the range of a variable into "bins" and counting the number of data points that fall within each bin. It is like a bar chart after forcing a quantitative variable into bins. It can be used for discrete ungrouped data, but a bar chart is generally more suitable for discrete data because histograms can mislead the reader into thinking that values exist other than at the centre of the intervals. </span>
<span id="cb81-323"><a href="#cb81-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-324"><a href="#cb81-324" aria-hidden="true" tabindex="-1"></a>@fig-hist1 shows the histogram of <span class="in">`Length`</span>. Clearly the distribution is far from symmetric and left skewed. The bimodal pattern also suggests subgrouping.</span>
<span id="cb81-325"><a href="#cb81-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-328"><a href="#cb81-328" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-329"><a href="#cb81-329" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-330"><a href="#cb81-330" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-hist1</span></span>
<span id="cb81-331"><a href="#cb81-331" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'A typical histogram'</span></span>
<span id="cb81-332"><a href="#cb81-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-333"><a href="#cb81-333" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span> </span>
<span id="cb81-334"><a href="#cb81-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Length) <span class="sc">+</span> </span>
<span id="cb81-335"><a href="#cb81-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">12</span>, </span>
<span id="cb81-336"><a href="#cb81-336" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color=</span><span class="st">"black"</span>, </span>
<span id="cb81-337"><a href="#cb81-337" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill=</span><span class="st">"white"</span>)</span>
<span id="cb81-338"><a href="#cb81-338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-339"><a href="#cb81-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-340"><a href="#cb81-340" aria-hidden="true" tabindex="-1"></a>Notice that a different shape of histogram may result depending on the class intervals (bins) used (that is by choosing different class widths or different midpoints of the classes). This suggests that it may be wise to draw more than one histogram for a given data set particularly if statements are to be made about modes or gaps in the data. The guideline for the maximum number of intervals, $L$, can follow the same formula as for stem-and-leaf displays. Some software use the @Sturges formula namely $$\texttt{bin width} = \frac {\texttt{range}(x)} {\log_2(n)+1}.$$ For fixing the width of the bins, the range of the data is divided by the sum of one and the base two logarithm of the sample size.</span>
<span id="cb81-341"><a href="#cb81-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-342"><a href="#cb81-342" aria-hidden="true" tabindex="-1"></a>There are a few ways to scale the y-axis of a histogram, as shown in @fig-threehist:</span>
<span id="cb81-343"><a href="#cb81-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-344"><a href="#cb81-344" aria-hidden="true" tabindex="-1"></a>(a) **Frequency histograms** show the counts in each bin; the heights of the bars sum to $n$. </span>
<span id="cb81-345"><a href="#cb81-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-346"><a href="#cb81-346" aria-hidden="true" tabindex="-1"></a>(b) **Relative frequency histograms** show the proportions or percent of data in each bin—the counts in each bin divided by the total; the heights sum to 1 or 100%.</span>
<span id="cb81-347"><a href="#cb81-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-348"><a href="#cb81-348" aria-hidden="true" tabindex="-1"></a>(c) **Density histograms** show the densities; the areas (heights $\times$ widths) of the bars sum to 1. </span>
<span id="cb81-349"><a href="#cb81-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-350"><a href="#cb81-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-351"><a href="#cb81-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,  warning=FALSE, message=FALSE}</span></span>
<span id="cb81-352"><a href="#cb81-352" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4 </span></span>
<span id="cb81-353"><a href="#cb81-353" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 10</span></span>
<span id="cb81-354"><a href="#cb81-354" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Three types of histograms"</span></span>
<span id="cb81-355"><a href="#cb81-355" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-threehist</span></span>
<span id="cb81-356"><a href="#cb81-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-357"><a href="#cb81-357" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span>  Snodgrass <span class="sc">|&gt;</span> </span>
<span id="cb81-358"><a href="#cb81-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-359"><a href="#cb81-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Length) <span class="sc">+</span></span>
<span id="cb81-360"><a href="#cb81-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb81-361"><a href="#cb81-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span> </span>
<span id="cb81-362"><a href="#cb81-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"(a) Frequency histogram"</span>, </span>
<span id="cb81-363"><a href="#cb81-363" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Heights of the bars sum to n"</span>)</span>
<span id="cb81-364"><a href="#cb81-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-365"><a href="#cb81-365" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span>  Snodgrass <span class="sc">|&gt;</span> </span>
<span id="cb81-366"><a href="#cb81-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-367"><a href="#cb81-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Length) <span class="sc">+</span></span>
<span id="cb81-368"><a href="#cb81-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb81-369"><a href="#cb81-369" aria-hidden="true" tabindex="-1"></a>    <span class="at">bins =</span> <span class="dv">20</span>, </span>
<span id="cb81-370"><a href="#cb81-370" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(count <span class="sc">/</span> <span class="fu">sum</span>(count)))</span>
<span id="cb81-371"><a href="#cb81-371" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb81-372"><a href="#cb81-372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb81-373"><a href="#cb81-373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"(b) Relative frequency histogram"</span>,</span>
<span id="cb81-374"><a href="#cb81-374" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Heights sum to 100%"</span>) <span class="sc">+</span> </span>
<span id="cb81-375"><a href="#cb81-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent)</span>
<span id="cb81-376"><a href="#cb81-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-377"><a href="#cb81-377" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span>  Snodgrass <span class="sc">|&gt;</span> </span>
<span id="cb81-378"><a href="#cb81-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-379"><a href="#cb81-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Length) <span class="sc">+</span></span>
<span id="cb81-380"><a href="#cb81-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb81-381"><a href="#cb81-381" aria-hidden="true" tabindex="-1"></a>    <span class="at">bins =</span> <span class="dv">20</span>, </span>
<span id="cb81-382"><a href="#cb81-382" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(density))) <span class="sc">+</span></span>
<span id="cb81-383"><a href="#cb81-383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span> </span>
<span id="cb81-384"><a href="#cb81-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"(c) Density histogram"</span>,</span>
<span id="cb81-385"><a href="#cb81-385" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Heights x widths sum to 1"</span>)</span>
<span id="cb81-386"><a href="#cb81-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-387"><a href="#cb81-387" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb81-388"><a href="#cb81-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-389"><a href="#cb81-389" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span>
<span id="cb81-390"><a href="#cb81-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-391"><a href="#cb81-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-392"><a href="#cb81-392" aria-hidden="true" tabindex="-1"></a>If, instead of drawing blocks over the class intervals as in a histogram, we join the mid points of the tops of the bars, we obtain a display known as a **frequency polygon** . If we use relative frequencies, it is a **relative frequency polygon**; see @fig-hist3.</span>
<span id="cb81-393"><a href="#cb81-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-396"><a href="#cb81-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-397"><a href="#cb81-397" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-398"><a href="#cb81-398" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-hist3</span></span>
<span id="cb81-399"><a href="#cb81-399" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'A typical frequency polygon'</span></span>
<span id="cb81-400"><a href="#cb81-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-401"><a href="#cb81-401" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span> </span>
<span id="cb81-402"><a href="#cb81-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Length, <span class="at">y =</span> <span class="fu">after_stat</span>(density)) <span class="sc">+</span></span>
<span id="cb81-403"><a href="#cb81-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>( <span class="at">bins =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb81-404"><a href="#cb81-404" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-405"><a href="#cb81-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-406"><a href="#cb81-406" aria-hidden="true" tabindex="-1"></a>@fig-hist3a shows a kernel density plot, which is a method that produces a smoother density line. </span>
<span id="cb81-407"><a href="#cb81-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-408"><a href="#cb81-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-411"><a href="#cb81-411" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-412"><a href="#cb81-412" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-413"><a href="#cb81-413" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-hist3a</span></span>
<span id="cb81-414"><a href="#cb81-414" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'A typical smoothed density curve'</span></span>
<span id="cb81-415"><a href="#cb81-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-416"><a href="#cb81-416" aria-hidden="true" tabindex="-1"></a>Snodgrass <span class="sc">|&gt;</span> </span>
<span id="cb81-417"><a href="#cb81-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-418"><a href="#cb81-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(Length) <span class="sc">+</span> </span>
<span id="cb81-419"><a href="#cb81-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span> </span>
<span id="cb81-420"><a href="#cb81-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rug</span>(<span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">colour =</span> <span class="st">"darkorange2"</span>)</span>
<span id="cb81-421"><a href="#cb81-421" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-422"><a href="#cb81-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-423"><a href="#cb81-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-424"><a href="#cb81-424" aria-hidden="true" tabindex="-1"></a>::: {.content-visible unless-format="pdf"}</span>
<span id="cb81-425"><a href="#cb81-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-426"><a href="#cb81-426" aria-hidden="true" tabindex="-1"></a>Kernel Density Estimation (KDE) is generated by dropping a little mini-distribution, usually a normal curve, on each individual point and summing them up (@fig-kdegif).</span>
<span id="cb81-427"><a href="#cb81-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-428"><a href="#cb81-428" aria-hidden="true" tabindex="-1"></a><span class="al">![A demonstration of kernel density estimation](../img/kde.gif)</span>{#fig-kdegif}</span>
<span id="cb81-429"><a href="#cb81-429" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-430"><a href="#cb81-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-431"><a href="#cb81-431" aria-hidden="true" tabindex="-1"></a>::: {.content-visible unless-format="html"}</span>
<span id="cb81-432"><a href="#cb81-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-433"><a href="#cb81-433" aria-hidden="true" tabindex="-1"></a>Kernel Density Estimation (KDE) is generated by dropping a little mini-distribution, usually a normal curve, on each individual point and summing them up (@fig-kdepng).</span>
<span id="cb81-434"><a href="#cb81-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-435"><a href="#cb81-435" aria-hidden="true" tabindex="-1"></a><span class="al">![A demonstration of kernel density estimation; there's a coloured normal kernel for each of the data points, and they sum to the grey density.](../img/kde.png)</span>{#fig-kdepng}</span>
<span id="cb81-436"><a href="#cb81-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-437"><a href="#cb81-437" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb81-438"><a href="#cb81-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-439"><a href="#cb81-439" aria-hidden="true" tabindex="-1"></a>These smooth plots are also useful to see the type of skewness involved, multimodality (several peaks) and unusual observations (or outliers). The disadvantage is that we may over-smooth and mask some of the subgrouping patterns; see @fig-hist4. Even though the two distributions appear to be similar, the length distribution for the Inside group has a larger mean/median etc (called the location parameters).</span>
<span id="cb81-440"><a href="#cb81-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-443"><a href="#cb81-443" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-444"><a href="#cb81-444" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-445"><a href="#cb81-445" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-hist4</span></span>
<span id="cb81-446"><a href="#cb81-446" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Identification of Subgrouping'</span></span>
<span id="cb81-447"><a href="#cb81-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-448"><a href="#cb81-448" aria-hidden="true" tabindex="-1"></a>Snodgrass <span class="sc">|&gt;</span> </span>
<span id="cb81-449"><a href="#cb81-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-450"><a href="#cb81-450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Length, </span>
<span id="cb81-451"><a href="#cb81-451" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> Inside) <span class="sc">+</span> </span>
<span id="cb81-452"><a href="#cb81-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span>
<span id="cb81-453"><a href="#cb81-453" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-454"><a href="#cb81-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-455"><a href="#cb81-455" aria-hidden="true" tabindex="-1"></a><span class="fu">## Theoretical Distributions</span></span>
<span id="cb81-456"><a href="#cb81-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-457"><a href="#cb81-457" aria-hidden="true" tabindex="-1"></a>A histogram gives a general picture of the frequencies or relative frequencies of the data. If an observation is taken at random from the population from which the sample was drawn, the chance of it falling in any one of the class intervals should be approximately proportional to the area of the block over that interval (not exactly proportional because the histogram was only based on a sample from the population, not the population itself).</span>
<span id="cb81-458"><a href="#cb81-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-459"><a href="#cb81-459" aria-hidden="true" tabindex="-1"></a>If we could draw a histogram for the whole population, then the probabilities would be exact. The relative frequencies form a probability distribution and if the class intervals are small enough the tops of the bars of the histogram would often approximate a smooth curve such as the density plot. In many cases this smooth curve is almost symmetrical with a rounded peak at the centre. One particular shape, fitting a certain mathematical formula, is a very good approximation to many sets of data. For instance, heights of people, weights of animals or yields of wheat all follow this distribution fairly well (although theoretically the distribution has an infinite range of possible values). One of the widely used *theoretical* distribution is called the *Normal* or *Gaussian* distribution but we will not bore you with its formula. However, most software can compute the tail areas (probabilities) under theoretical distributions. We shall study this distribution in greater detail in a Chapter 3. For the moment let us note that our EDA techniques should provide us with information about the parameters of the distribution, and we also want graphical techniques that display the continuous nature of the data.</span>
<span id="cb81-460"><a href="#cb81-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-461"><a href="#cb81-461" aria-hidden="true" tabindex="-1"></a>Discrete data also have probability distributions and the bar graph gives a general picture of its shape. One commonly occurring discrete theoretical distribution is known as the **Poisson distribution** and approximates reasonably well the numbers of road accidents over a fixed time period. The main feature of a Poisson distribution is that there is a peak at the nearest integer below or equal to the average, and then a steady falling off. The mean is a parameter of the model, so we want our exploratory techniques to tell us about the mean, and to help us decide whether or not the Poisson model is appropriate for a given set of data. Theoretically, possible values are any whole positive numbers, but large numbers of accidents are very unlikely. Again, any graphical method we use must properly display the discrete nature of Poisson data. The other commonly adopted discrete distribution is the binomial distribution. This distribution is valid when the individual outcomes are classified into two categories such as Success and Failure.</span>
<span id="cb81-462"><a href="#cb81-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-463"><a href="#cb81-463" aria-hidden="true" tabindex="-1"></a><span class="fu"># Summary Statistics and their display</span></span>
<span id="cb81-464"><a href="#cb81-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-465"><a href="#cb81-465" aria-hidden="true" tabindex="-1"></a>For a small to moderate size batch of numbers, the stem-and-leaf display may reveal at a glance all of the peculiarities in the data. However it is useful, particularly for large batches, to calculate some statistics which capture the main features of the data. These are called **summary statistics** and they help us to gain an overall picture without being distracted by some individual peculiarities. You must be familiar with the common summary statistics such as mean, median, standard deviation etc.</span>
<span id="cb81-466"><a href="#cb81-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-467"><a href="#cb81-467" aria-hidden="true" tabindex="-1"></a>The <span class="in">`R`</span> default function <span class="in">`summary()`</span> gives the mean, median, lower and upper quartiles, minimum, and maximum for a variable) as well as for a dataframe) For the length variable in our *Snodgrass* dataset, we obtain this default summary as</span>
<span id="cb81-468"><a href="#cb81-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-469"><a href="#cb81-469" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE}</span></span>
<span id="cb81-470"><a href="#cb81-470" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Snodgrass<span class="sc">$</span>Length)</span>
<span id="cb81-471"><a href="#cb81-471" aria-hidden="true" tabindex="-1"></a><span class="co"># Try summary(Snodgrass)</span></span>
<span id="cb81-472"><a href="#cb81-472" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-473"><a href="#cb81-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-474"><a href="#cb81-474" aria-hidden="true" tabindex="-1"></a>We need used <span class="in">`R`</span> functions such as <span class="in">`sd()`</span> to obtain the standard deviation etc. Packages such as <span class="in">`psych`</span> contain functions to get enhanced summaries. Try</span>
<span id="cb81-475"><a href="#cb81-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-476"><a href="#cb81-476" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE, results='hide'}</span></span>
<span id="cb81-477"><a href="#cb81-477" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb81-478"><a href="#cb81-478" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb81-479"><a href="#cb81-479" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(Snodgrass<span class="sc">$</span>Length)</span>
<span id="cb81-480"><a href="#cb81-480" aria-hidden="true" tabindex="-1"></a><span class="fu">describeBy</span>(Snodgrass<span class="sc">$</span>Length, <span class="at">group=</span>Snodgrass<span class="sc">$</span>Inside)</span>
<span id="cb81-481"><a href="#cb81-481" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-482"><a href="#cb81-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-483"><a href="#cb81-483" aria-hidden="true" tabindex="-1"></a>For EDA purposes, @tukey1977 suggested to generate further positional summaries using the concept of median. The sorted (smallest to largest) Length data from the *Snodgrass* dataset was presented earlier for discussing the stem plot. In total $n = 91$ house pits were present, so that the **median** Length is the $46^{\text th}$ value and equals <span class="in">`r median(Snodgrass$Length)`</span>. Notice that the median is in the middle of the distribution having 45 points on either side.</span>
<span id="cb81-484"><a href="#cb81-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-485"><a href="#cb81-485" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE}</span></span>
<span id="cb81-486"><a href="#cb81-486" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(Snodgrass<span class="sc">$</span>Length)</span>
<span id="cb81-487"><a href="#cb81-487" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-488"><a href="#cb81-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-489"><a href="#cb81-489" aria-hidden="true" tabindex="-1"></a><span class="fu">## Symmetry plots</span></span>
<span id="cb81-490"><a href="#cb81-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-491"><a href="#cb81-491" aria-hidden="true" tabindex="-1"></a>A symmetry plot is based on the distance of left and right side points. If the underlying distribution is symmetric, the points on the left and right side would be roughly equidistant from the median. For the length data, we obtain the symmetry plot after writing a little <span class="in">`R`</span> function as follows:</span>
<span id="cb81-492"><a href="#cb81-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-493"><a href="#cb81-493" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE}</span></span>
<span id="cb81-494"><a href="#cb81-494" aria-hidden="true" tabindex="-1"></a>symmetryplot <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb81-495"><a href="#cb81-495" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb81-496"><a href="#cb81-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(ggplot2)</span>
<span id="cb81-497"><a href="#cb81-497" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-498"><a href="#cb81-498" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(x)</span>
<span id="cb81-499"><a href="#cb81-499" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">length</span>(x) <span class="sc">%/%</span> <span class="dv">2</span></span>
<span id="cb81-500"><a href="#cb81-500" aria-hidden="true" tabindex="-1"></a>  sx <span class="ot">&lt;-</span> <span class="fu">sort</span>(x)</span>
<span id="cb81-501"><a href="#cb81-501" aria-hidden="true" tabindex="-1"></a>  dfm <span class="ot">&lt;-</span> <span class="fu">tibble</span>( </span>
<span id="cb81-502"><a href="#cb81-502" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> <span class="fu">median</span>(x) <span class="sc">-</span> sx[<span class="dv">1</span><span class="sc">:</span>m], </span>
<span id="cb81-503"><a href="#cb81-503" aria-hidden="true" tabindex="-1"></a>    <span class="at">Y =</span> <span class="fu">rev</span>(sx)[<span class="dv">1</span><span class="sc">:</span>m] <span class="sc">-</span> <span class="fu">median</span>(x)</span>
<span id="cb81-504"><a href="#cb81-504" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb81-505"><a href="#cb81-505" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-506"><a href="#cb81-506" aria-hidden="true" tabindex="-1"></a>  dfm <span class="sc">|&gt;</span> </span>
<span id="cb81-507"><a href="#cb81-507" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-508"><a href="#cb81-508" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>X, <span class="at">y=</span>Y)) <span class="sc">+</span> </span>
<span id="cb81-509"><a href="#cb81-509" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>X, <span class="at">y=</span>X)) <span class="sc">+</span> </span>
<span id="cb81-510"><a href="#cb81-510" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb81-511"><a href="#cb81-511" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Distance below median"</span>) <span class="sc">+</span> </span>
<span id="cb81-512"><a href="#cb81-512" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Distance above median"</span>)</span>
<span id="cb81-513"><a href="#cb81-513" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-514"><a href="#cb81-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-515"><a href="#cb81-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-516"><a href="#cb81-516" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE}</span></span>
<span id="cb81-517"><a href="#cb81-517" aria-hidden="true" tabindex="-1"></a><span class="fu">symmetryplot</span>(Snodgrass<span class="sc">$</span>Length)</span>
<span id="cb81-518"><a href="#cb81-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-519"><a href="#cb81-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-520"><a href="#cb81-520" aria-hidden="true" tabindex="-1"></a>The points do not follow the $45^\circ$ line where $Y=X$; divergence from this line indicates a lack of symmetry.</span>
<span id="cb81-521"><a href="#cb81-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-522"><a href="#cb81-522" aria-hidden="true" tabindex="-1"></a>If each half of the distribution is further divided in halves, we obtain the **fourths** or( **hinges**), as the medians for the lower and upper halves. The end points, the minimum and the maximum are called the lower and upper **extreme** values, respectively.</span>
<span id="cb81-523"><a href="#cb81-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-524"><a href="#cb81-524" aria-hidden="true" tabindex="-1"></a>The <span class="in">`R`</span> function obtains the set (minimum, lower hinge, median, upper hinge, maximum) in its function <span class="in">`fivenum`</span>.</span>
<span id="cb81-525"><a href="#cb81-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-526"><a href="#cb81-526" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE}</span></span>
<span id="cb81-527"><a href="#cb81-527" aria-hidden="true" tabindex="-1"></a><span class="co"># Five number summary</span></span>
<span id="cb81-528"><a href="#cb81-528" aria-hidden="true" tabindex="-1"></a><span class="fu">fivenum</span>(Snodgrass<span class="sc">$</span>Length)</span>
<span id="cb81-529"><a href="#cb81-529" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-530"><a href="#cb81-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-531"><a href="#cb81-531" aria-hidden="true" tabindex="-1"></a><span class="fu">## Box plots</span></span>
<span id="cb81-532"><a href="#cb81-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-533"><a href="#cb81-533" aria-hidden="true" tabindex="-1"></a>A **boxplot** (or sometimes a *box-and-whisker plot*) is a visual display of the five-number summary, which can be used to assess the skew in the data. The components of a boxplot are explained in @fig-boxplt.</span>
<span id="cb81-534"><a href="#cb81-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-535"><a href="#cb81-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-538"><a href="#cb81-538" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-539"><a href="#cb81-539" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb81-540"><a href="#cb81-540" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb81-541"><a href="#cb81-541" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb81-542"><a href="#cb81-542" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-boxplt</span></span>
<span id="cb81-543"><a href="#cb81-543" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Annotated boxplot"</span></span>
<span id="cb81-544"><a href="#cb81-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-545"><a href="#cb81-545" aria-hidden="true" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="fu">fivenum</span>(Snodgrass<span class="sc">$</span>Length)</span>
<span id="cb81-546"><a href="#cb81-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-547"><a href="#cb81-547" aria-hidden="true" tabindex="-1"></a>Snodgrass <span class="sc">|&gt;</span> </span>
<span id="cb81-548"><a href="#cb81-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-549"><a href="#cb81-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>Length) <span class="sc">+</span></span>
<span id="cb81-550"><a href="#cb81-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width=</span>.<span class="dv">15</span>, <span class="at">col=</span><span class="st">"darkorange2"</span>) <span class="sc">+</span> </span>
<span id="cb81-551"><a href="#cb81-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span>.<span class="dv">18</span>,.<span class="dv">18</span>) <span class="sc">+</span></span>
<span id="cb81-552"><a href="#cb81-552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fl">3.5</span>,<span class="fl">21.5</span>) <span class="sc">+</span></span>
<span id="cb81-553"><a href="#cb81-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb81-554"><a href="#cb81-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb81-555"><a href="#cb81-555" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>, </span>
<span id="cb81-556"><a href="#cb81-556" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.02</span>,.<span class="dv">1</span>,.<span class="dv">1</span>,.<span class="dv">1</span>, <span class="fl">0.03</span>),</span>
<span id="cb81-557"><a href="#cb81-557" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="fl">7.5</span>, fn), </span>
<span id="cb81-558"><a href="#cb81-558" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">c</span>(</span>
<span id="cb81-559"><a href="#cb81-559" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Min or</span><span class="sc">\n</span><span class="st">1.5*IQR"</span>, </span>
<span id="cb81-560"><a href="#cb81-560" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Outlier"</span>,</span>
<span id="cb81-561"><a href="#cb81-561" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Lower</span><span class="sc">\n</span><span class="st">hinge</span><span class="sc">\n</span><span class="st">Q1"</span>, </span>
<span id="cb81-562"><a href="#cb81-562" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Median</span><span class="sc">\n</span><span class="st">Q2"</span>, </span>
<span id="cb81-563"><a href="#cb81-563" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Upper</span><span class="sc">\n</span><span class="st">hinge</span><span class="sc">\n</span><span class="st">Q3"</span>,</span>
<span id="cb81-564"><a href="#cb81-564" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Max or</span><span class="sc">\n</span><span class="st">1.5*IQR"</span></span>
<span id="cb81-565"><a href="#cb81-565" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb81-566"><a href="#cb81-566" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb81-567"><a href="#cb81-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb81-568"><a href="#cb81-568" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> fn[<span class="dv">2</span>], <span class="at">xend =</span> fn[<span class="dv">4</span>],</span>
<span id="cb81-569"><a href="#cb81-569" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="sc">-</span>.<span class="dv">1</span>, <span class="at">yend =</span> <span class="sc">-</span>.<span class="dv">1</span>),</span>
<span id="cb81-570"><a href="#cb81-570" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">"inches"</span>), <span class="at">ends =</span> <span class="st">"both"</span>)</span>
<span id="cb81-571"><a href="#cb81-571" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb81-572"><a href="#cb81-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb81-573"><a href="#cb81-573" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb81-574"><a href="#cb81-574" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">-</span>.<span class="dv">125</span>, </span>
<span id="cb81-575"><a href="#cb81-575" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">mean</span>(fn[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="sc">+</span>.<span class="dv">3</span>),</span>
<span id="cb81-576"><a href="#cb81-576" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Inter-Quatile Range</span><span class="sc">\n</span><span class="st">(IQR)"</span></span>
<span id="cb81-577"><a href="#cb81-577" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb81-578"><a href="#cb81-578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb81-579"><a href="#cb81-579" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> fn[<span class="dv">2</span>], <span class="at">xend =</span> fn[<span class="dv">2</span>] <span class="sc">-</span> <span class="fl">1.5</span> <span class="sc">*</span> (fn[<span class="dv">4</span>] <span class="sc">-</span> fn[<span class="dv">2</span>]),</span>
<span id="cb81-580"><a href="#cb81-580" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="sc">-</span>.<span class="dv">05</span>, <span class="at">yend =</span> <span class="sc">-</span>.<span class="dv">05</span>),</span>
<span id="cb81-581"><a href="#cb81-581" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">"inches"</span>))</span>
<span id="cb81-582"><a href="#cb81-582" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb81-583"><a href="#cb81-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb81-584"><a href="#cb81-584" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb81-585"><a href="#cb81-585" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">-</span>.<span class="dv">06</span>,</span>
<span id="cb81-586"><a href="#cb81-586" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">mean</span>(<span class="fu">c</span>(fn[<span class="dv">2</span>], fn[<span class="dv">2</span>] <span class="sc">-</span> <span class="fl">1.5</span> <span class="sc">*</span> (fn[<span class="dv">4</span>] <span class="sc">-</span> fn[<span class="dv">2</span>])) ),</span>
<span id="cb81-587"><a href="#cb81-587" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"1.5 x IQR"</span></span>
<span id="cb81-588"><a href="#cb81-588" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-589"><a href="#cb81-589" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-590"><a href="#cb81-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-593"><a href="#cb81-593" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-594"><a href="#cb81-594" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb81-595"><a href="#cb81-595" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb81-596"><a href="#cb81-596" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Components of a boxplot'</span></span>
<span id="cb81-597"><a href="#cb81-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-598"><a href="#cb81-598" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">'images/boxplt.png'</span>)</span>
<span id="cb81-599"><a href="#cb81-599" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-600"><a href="#cb81-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-601"><a href="#cb81-601" aria-hidden="true" tabindex="-1"></a>The box shows the positions of the first and third quartiles, or "hinges", and the thick middle line shows the median. As 50% of the observations fall between the first and third quartiles, the position of the box is important and is the first thing that catches our eyes. If the median is in the centre of the box, this suggests that the distribution may be symmetric; if the median is near one end, the distribution is skewed. In particular, if the median is in the *right* side of the box, it implies that the middle 50% of the data are skewed to the *left*. For right skewed data, the median will be placed at the left end of the box (as against in the centre of the box).</span>
<span id="cb81-602"><a href="#cb81-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-603"><a href="#cb81-603" aria-hidden="true" tabindex="-1"></a>After having considered the 'centre' of a distribution, which we have measured by the median, and looked at where the bulk of the data lies, measured by the quartiles; then we are particularly interested in the strange, unusual values. They could be obvious mistakes (incorrectly coded, or decimal places in the wrong place, transposition of digits such as 91 instead of 19) or incorrect measurements or recording. These last two possibilities often occur before the data gets to the statistician so that it may be difficult to check whether these mistakes have occurred. Apart from obvious errors, we can only point to 'far out' values as being strange and we term them **'outliers'**. To help decide this matter, we define a few more terms, of which the most common one is the **interquartile range** or **IQR**, which is the distance between the first and third quartiles ( $Q3-Q1$ ). Any observation which is more than $1.5 \times IQR$ (sometimes called the "step") less than the first or more than the third quartile can be considered a *possible* outlier (@fig-boxplt. </span>
<span id="cb81-604"><a href="#cb81-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-605"><a href="#cb81-605" aria-hidden="true" tabindex="-1"></a>Boxplots are ideal for comparing a few groups of data because they give a visual summary of certain main features of the distributions but they are not as cluttered as other displays. Common sense must prevail, for there is a limit to the amount of information that the eye can take in. Up to 10 or 12 boxplots can be plotted, preferably on the same scale; more than 12 could be confusing.</span>
<span id="cb81-606"><a href="#cb81-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-607"><a href="#cb81-607" aria-hidden="true" tabindex="-1"></a>Shown in @fig-boxplt1 are the boxplots of <span class="in">`Length`</span> for the Inside-Outside groupings. Note that the boxplots have been constructed on the same scale; that is, they have common (<span class="in">`Length`</span>) axis.</span>
<span id="cb81-608"><a href="#cb81-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-611"><a href="#cb81-611" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-612"><a href="#cb81-612" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-613"><a href="#cb81-613" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-boxplt1</span></span>
<span id="cb81-614"><a href="#cb81-614" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Boxplots'</span></span>
<span id="cb81-615"><a href="#cb81-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-616"><a href="#cb81-616" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span> </span>
<span id="cb81-617"><a href="#cb81-617" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> Length, </span>
<span id="cb81-618"><a href="#cb81-618" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> Inside, </span>
<span id="cb81-619"><a href="#cb81-619" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> Inside) <span class="sc">+</span> </span>
<span id="cb81-620"><a href="#cb81-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb81-621"><a href="#cb81-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb81-622"><a href="#cb81-622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-623"><a href="#cb81-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-624"><a href="#cb81-624" aria-hidden="true" tabindex="-1"></a>The boxplots in @fig-boxplt1 show that the general shapes of the distributions of <span class="in">`Length`</span> are broadly similar. In each case, the median is near the centre of the box. The box of the <span class="in">`Outside`</span> group is entirely to the right of the box of the <span class="in">`Inside`</span> group, indicating that the distribution of <span class="in">`Length`</span> is higher for the <span class="in">`Outside`</span> group. We can also see that the <span class="in">`Inside`</span> group may have greater spread than the <span class="in">`Outside`</span> group.</span>
<span id="cb81-625"><a href="#cb81-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-626"><a href="#cb81-626" aria-hidden="true" tabindex="-1"></a><span class="fu">## Letter-value plots</span></span>
<span id="cb81-627"><a href="#cb81-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-628"><a href="#cb81-628" aria-hidden="true" tabindex="-1"></a>For large datasets, a summary based on five numbers may be overly simple, showing too many 'outliers' and obscuring some structure in the more extreme range of the data. @hofmann_letter-value_2017 describe an extension to the boxplot called the "letter-value plot". </span>
<span id="cb81-629"><a href="#cb81-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-630"><a href="#cb81-630" aria-hidden="true" tabindex="-1"></a>Like boxplots, letter-value plots include the median and the two middle fourths of the data. However, the whiskers are replaced by smaller boxes, representing ever-decreasing proportions of the data, such as eighths, sixteenths, etc., represented by letter values. The extent of this extra boxing depends on the quantity and shape of the data. </span>
<span id="cb81-631"><a href="#cb81-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-632"><a href="#cb81-632" aria-hidden="true" tabindex="-1"></a>Letter values are defined by their **depths**, or distances from the nearer edge of the ordered data.</span>
<span id="cb81-633"><a href="#cb81-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-634"><a href="#cb81-634" aria-hidden="true" tabindex="-1"></a><span class="in">`median`</span>: found at depth $d(M) = (n + 1)/2$ where $n$ is the number of observations</span>
<span id="cb81-635"><a href="#cb81-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-636"><a href="#cb81-636" aria-hidden="true" tabindex="-1"></a><span class="in">`fourths`</span>: found at depth $d(F) = <span class="sc">\{</span>\verb"int"<span class="co">[</span><span class="ot">d(M)</span><span class="co">]</span> + 1<span class="sc">\}</span>/2$ where $\verb"int[]"$ refers to the integer part function.</span>
<span id="cb81-637"><a href="#cb81-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-638"><a href="#cb81-638" aria-hidden="true" tabindex="-1"></a><span class="in">`eighths`</span>: found at depth $d(E) = <span class="sc">\{</span>\verb"int"<span class="co">[</span><span class="ot">d(F)</span><span class="co">]</span> + 1<span class="sc">\}</span>/2$</span>
<span id="cb81-639"><a href="#cb81-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-640"><a href="#cb81-640" aria-hidden="true" tabindex="-1"></a>Similarly if we had enough data, we could extend further</span>
<span id="cb81-641"><a href="#cb81-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-642"><a href="#cb81-642" aria-hidden="true" tabindex="-1"></a><span class="in">`sixteenths`</span>: found at depth $d(D) = <span class="sc">\{</span>\verb"int"<span class="co">[</span><span class="ot">d(E)</span><span class="co">]</span> + 1<span class="sc">\}</span>/2$</span>
<span id="cb81-643"><a href="#cb81-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-644"><a href="#cb81-644" aria-hidden="true" tabindex="-1"></a><span class="in">`thirty-seconds`</span>: found at depth $d(C) = <span class="sc">\{</span>\verb"int"<span class="co">[</span><span class="ot">d(D)</span><span class="co">]</span> + 1<span class="sc">\}</span>/2$</span>
<span id="cb81-645"><a href="#cb81-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-646"><a href="#cb81-646" aria-hidden="true" tabindex="-1"></a>and thus define points $B, A, Z, Y, X,$ and so on.</span>
<span id="cb81-647"><a href="#cb81-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-648"><a href="#cb81-648" aria-hidden="true" tabindex="-1"></a>Note the M, F and E could be termed measures of **location**. It is also helpful to have some measures of **spread** which indicate the variability in the distribution. One such measure, the **F-spread**, is the distance between the two F (fourths) values; that is, the inter-quartile range (IQR). Finally, the **range** is the distance between the two extreme points.</span>
<span id="cb81-649"><a href="#cb81-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-650"><a href="#cb81-650" aria-hidden="true" tabindex="-1"></a>Another useful measure of location is obtained by averaging the two hinges which is termed the **mid-fourth** (or **mid-F**). If the distribution were perfectly symmetrical, the mid-F would be the same as the median. If mid-F is smaller (larger) than the median, the distribution is skewed to the left (right). Note that the mid values can be found at any depths.</span>
<span id="cb81-651"><a href="#cb81-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-652"><a href="#cb81-652" aria-hidden="true" tabindex="-1"></a>See <span class="co">[</span><span class="ot">here</span><span class="co">](https://mgimond.github.io/ES218/letter_values.html)</span> for more details.</span>
<span id="cb81-653"><a href="#cb81-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-654"><a href="#cb81-654" aria-hidden="true" tabindex="-1"></a>Letter values are displayed as a graph called letter value plot; see @fig-LVplt1. This type of plot is a better display than a boxplot for <span class="in">`big data`</span> which tend to show many unusual points. Boxplots are suitable to moderate size datasets only. For large datasets, the skew may not be consistent within the data. The LV plot will show such anomalies in the skew patterns.</span>
<span id="cb81-655"><a href="#cb81-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-658"><a href="#cb81-658" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-659"><a href="#cb81-659" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-660"><a href="#cb81-660" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-LVplt1</span></span>
<span id="cb81-661"><a href="#cb81-661" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Letter-value plot for `length` data'</span></span>
<span id="cb81-662"><a href="#cb81-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-663"><a href="#cb81-663" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lvplot)</span>
<span id="cb81-664"><a href="#cb81-664" aria-hidden="true" tabindex="-1"></a><span class="fu">LVboxplot</span>(Snodgrass<span class="sc">$</span>Length, <span class="at">xlab =</span> <span class="st">"Length"</span>)</span>
<span id="cb81-665"><a href="#cb81-665" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-666"><a href="#cb81-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-667"><a href="#cb81-667" aria-hidden="true" tabindex="-1"></a>A letter value plot showing the eighths is shown in @fig-boxplt2. Note that this LV plot does not have a whisker, but the points falling outside the eighths are tagged.</span>
<span id="cb81-668"><a href="#cb81-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-671"><a href="#cb81-671" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-672"><a href="#cb81-672" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-673"><a href="#cb81-673" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-boxplt2</span></span>
<span id="cb81-674"><a href="#cb81-674" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Letter-value plots of `Length` by `Inside`'</span></span>
<span id="cb81-675"><a href="#cb81-675" aria-hidden="true" tabindex="-1"></a><span class="fu">LVboxplot</span>(Snodgrass<span class="sc">$</span>Length <span class="sc">~</span> Snodgrass<span class="sc">$</span>Inside, <span class="at">xlab =</span> <span class="st">"Length"</span>)</span>
<span id="cb81-676"><a href="#cb81-676" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-677"><a href="#cb81-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-678"><a href="#cb81-678" aria-hidden="true" tabindex="-1"></a>If we compare @fig-boxplt1 with @fig-boxplt2, we can see that the whiskers have been replaced with more 'outliers' and two extra boxes. The middle boxes are the same; they show the first and third quartiles. The smaller, darker boxes in @fig-boxplt2 show the first and seventh eighths.</span>
<span id="cb81-679"><a href="#cb81-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-680"><a href="#cb81-680" aria-hidden="true" tabindex="-1"></a>@fig-lvggplot shows a <span class="in">`ggplot`</span> version of an LV plot for a big random data set.</span>
<span id="cb81-681"><a href="#cb81-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-684"><a href="#cb81-684" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-685"><a href="#cb81-685" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-686"><a href="#cb81-686" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-lvggplot</span></span>
<span id="cb81-687"><a href="#cb81-687" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'A ggplot letter-value plot'</span></span>
<span id="cb81-688"><a href="#cb81-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-689"><a href="#cb81-689" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb81-690"><a href="#cb81-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-691"><a href="#cb81-691" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lvplot)</span>
<span id="cb81-692"><a href="#cb81-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-693"><a href="#cb81-693" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb81-694"><a href="#cb81-694" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>( <span class="fu">rlnorm</span>(<span class="at">n=</span><span class="fl">1e4</span>, <span class="at">mean =</span> <span class="dv">10</span>) , </span>
<span id="cb81-695"><a href="#cb81-695" aria-hidden="true" tabindex="-1"></a>         <span class="fu">rnorm</span>(<span class="at">n=</span><span class="fl">1e4</span>, <span class="at">mean =</span> <span class="fl">5e5</span>, <span class="at">sd =</span> <span class="fl">1e5</span>) </span>
<span id="cb81-696"><a href="#cb81-696" aria-hidden="true" tabindex="-1"></a>         ),</span>
<span id="cb81-697"><a href="#cb81-697" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Log-normal(10,1)"</span>,<span class="st">"Normal(500k,100k)"</span>), <span class="at">each=</span><span class="fl">1e4</span>) <span class="sc">|&gt;</span> <span class="fu">factor</span>()</span>
<span id="cb81-698"><a href="#cb81-698" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb81-699"><a href="#cb81-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-700"><a href="#cb81-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">fill=</span><span class="fu">after_stat</span>(LV)) <span class="sc">+</span></span>
<span id="cb81-701"><a href="#cb81-701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_lv</span>() <span class="sc">+</span> </span>
<span id="cb81-702"><a href="#cb81-702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_lv</span>() <span class="sc">+</span></span>
<span id="cb81-703"><a href="#cb81-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb81-704"><a href="#cb81-704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb81-705"><a href="#cb81-705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>)</span>
<span id="cb81-706"><a href="#cb81-706" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-707"><a href="#cb81-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-708"><a href="#cb81-708" aria-hidden="true" tabindex="-1"></a><span class="fu"># Cumulative Frequency Graph and Quantiles</span></span>
<span id="cb81-709"><a href="#cb81-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-710"><a href="#cb81-710" aria-hidden="true" tabindex="-1"></a>When the data consists of individual points rather than grouped data, we first order the data from smallest to largest and we can plot the row numbers against these.</span>
<span id="cb81-711"><a href="#cb81-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-712"><a href="#cb81-712" aria-hidden="true" tabindex="-1"></a>For the Length data from the *Snodgrass* dataset, we have shown the ordered values earlier. If we assume that these are evenly spread throughout the distribution, these 91 values divide the distribution into 91 even parts each containing a relative frequency of 1/91 = `r 1/91`. In the absence of information about Length of other house pits, the above assumption seems reasonable. It would have even stronger justification if this sample of 91 were chosen at random from the population of the of all house pits, but this stretches the imagination somewhat as these 91 observations are just a chance archaeological find of what was preserved. Nevertheless, we have no real reason to consider that they are not representative of the whole population *Snodgrass* house pits.</span>
<span id="cb81-713"><a href="#cb81-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-714"><a href="#cb81-714" aria-hidden="true" tabindex="-1"></a>To find the cumulative relative frequency, we divide the column of row numbers by 91. There is a slight problem in that we do not know the smallest, and the largest Length. Hence we make an arbitrary decision that the smallest is likely to be <span class="in">`r min(Snodgrass$Length)`</span> feet with cumulative relative frequency of zero and the largest <span class="in">`r max(Snodgrass$Length)`</span> feet with a cumulative frequency of 1.</span>
<span id="cb81-715"><a href="#cb81-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-716"><a href="#cb81-716" aria-hidden="true" tabindex="-1"></a>With the Length data, there is a slight hitch in that there is duplication of the values. This is not really a problem, so long as we ignore the cumulative frequency in the table which corresponds to each first repeated value. The frequency jumps by one at the value of each observation except when there is a repetition in which case it jumps by the number of repetitions. Having obtained the cumulative relative frequencies, we can plot these against the ordered Length values. </span>
<span id="cb81-717"><a href="#cb81-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-720"><a href="#cb81-720" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-721"><a href="#cb81-721" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-722"><a href="#cb81-722" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-cumfrq</span></span>
<span id="cb81-723"><a href="#cb81-723" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Cumulative Relative Frequency Curve'</span></span>
<span id="cb81-724"><a href="#cb81-724" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span> </span>
<span id="cb81-725"><a href="#cb81-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(Length) <span class="sc">+</span> </span>
<span id="cb81-726"><a href="#cb81-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ecdf</span>()</span>
<span id="cb81-727"><a href="#cb81-727" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-728"><a href="#cb81-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-729"><a href="#cb81-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-730"><a href="#cb81-730" aria-hidden="true" tabindex="-1"></a>@fig-cumfrq shows the Cumulative Relative Frequency Curve. The procedure we described is a very basic one, and <span class="in">`R`</span> software will get a better one where we make more assumptions on how to relate the observed data to the cumulative relative frequencies.</span>
<span id="cb81-731"><a href="#cb81-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-732"><a href="#cb81-732" aria-hidden="true" tabindex="-1"></a>An important use of cumulative relative frequency graph is to find the **quantiles** of the distribution which is a general term for percentiles, deciles etc. For example, the $50^{\text th}$ percentile or the 5$^{\text th}$ decile (tenth) is the median which has 50% of the distribution up to, and including it. Any desired percentile can be found from the graph by drawing a horizontal line at the desired cumulative relative frequency and noting the value at which it cuts the curve.  @fig-cumfrq1 illustrates how the 30$^{\text th}$ percentile can be interpolated for the Length variable. It is desirable to use software to draw the cumulative relative frequency curves or estimate the quantiles.</span>
<span id="cb81-733"><a href="#cb81-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-736"><a href="#cb81-736" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-737"><a href="#cb81-737" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-738"><a href="#cb81-738" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-cumfrq1</span></span>
<span id="cb81-739"><a href="#cb81-739" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'ECDF Curve for Length data'</span></span>
<span id="cb81-740"><a href="#cb81-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-741"><a href="#cb81-741" aria-hidden="true" tabindex="-1"></a>q30 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(Snodgrass<span class="sc">$</span>Length, <span class="fl">0.3</span>)</span>
<span id="cb81-742"><a href="#cb81-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-743"><a href="#cb81-743" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span> </span>
<span id="cb81-744"><a href="#cb81-744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(Length) <span class="sc">+</span> </span>
<span id="cb81-745"><a href="#cb81-745" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ecdf</span>() <span class="sc">+</span> </span>
<span id="cb81-746"><a href="#cb81-746" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb81-747"><a href="#cb81-747" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> q30, </span>
<span id="cb81-748"><a href="#cb81-748" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb81-749"><a href="#cb81-749" aria-hidden="true" tabindex="-1"></a>        <span class="at">xend =</span> q30, </span>
<span id="cb81-750"><a href="#cb81-750" aria-hidden="true" tabindex="-1"></a>        <span class="at">yend =</span> .<span class="dv">3</span>),  </span>
<span id="cb81-751"><a href="#cb81-751" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour=</span><span class="dv">2</span>, </span>
<span id="cb81-752"><a href="#cb81-752" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length=</span><span class="fu">unit</span>(<span class="fl">0.30</span>,<span class="st">"cm"</span>), </span>
<span id="cb81-753"><a href="#cb81-753" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ends=</span><span class="st">"first"</span>)</span>
<span id="cb81-754"><a href="#cb81-754" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb81-755"><a href="#cb81-755" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb81-756"><a href="#cb81-756" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, </span>
<span id="cb81-757"><a href="#cb81-757" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> .<span class="dv">3</span>, </span>
<span id="cb81-758"><a href="#cb81-758" aria-hidden="true" tabindex="-1"></a>        <span class="at">xend =</span> q30, </span>
<span id="cb81-759"><a href="#cb81-759" aria-hidden="true" tabindex="-1"></a>        <span class="at">yend =</span> .<span class="dv">3</span>), </span>
<span id="cb81-760"><a href="#cb81-760" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour=</span><span class="dv">2</span>, </span>
<span id="cb81-761"><a href="#cb81-761" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length=</span><span class="fu">unit</span>(<span class="fl">0.30</span>,<span class="st">"cm"</span>))</span>
<span id="cb81-762"><a href="#cb81-762" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb81-763"><a href="#cb81-763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb81-764"><a href="#cb81-764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb81-765"><a href="#cb81-765" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"ECDF(Length)"</span>)</span>
<span id="cb81-766"><a href="#cb81-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-767"><a href="#cb81-767" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-768"><a href="#cb81-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-769"><a href="#cb81-769" aria-hidden="true" tabindex="-1"></a>The 25$^{\text th}$ percentile is known as the **lower quartile** and the 75$^{\text th}$ percentile is known as the **upper quartile**. The inter-quartile range (IQR) is defined as the difference between the upper and lower quartiles. The lower and upper quartiles will slightly differ from the lower and upper hinges for small data sets due to the differences in estimating the cumulative relative frequency function known as the empirical cumulative distribution function (**ECDF**).</span>
<span id="cb81-770"><a href="#cb81-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-771"><a href="#cb81-771" aria-hidden="true" tabindex="-1"></a>The <span class="in">`R`</span> function <span class="in">`quantile()`</span> will get the quantiles easily. The following output shows the percentiles for Length data.</span>
<span id="cb81-772"><a href="#cb81-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-775"><a href="#cb81-775" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-776"><a href="#cb81-776" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(Snodgrass<span class="sc">$</span>Length, <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>))</span>
<span id="cb81-777"><a href="#cb81-777" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-778"><a href="#cb81-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-779"><a href="#cb81-779" aria-hidden="true" tabindex="-1"></a><span class="fu">## Quantile-Quantile (Q-Q) Plot</span></span>
<span id="cb81-780"><a href="#cb81-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-781"><a href="#cb81-781" aria-hidden="true" tabindex="-1"></a>At times, two groups may have different numbers of observations but they may be similar in some ways and it may be appropriate to compare them. This comparison can be done in several ways but Q-Q plot is once such graph useful for such a comparison. The quantiles of the first batch is plotted against the quantiles of the second batch. A 45 degree $(Y=X)$ line is also drawn. If the points on a quantile-quantile plot fall along, or close to, the 45 degree line, then the two variables follow the same distribution; if they fall on a line parallel to the 45 degree line, the two variables follow similar distributions but one has a larger location parameter (say mean, or median) than the other; if the slope differs from the 45 degree line the variables have a similar distribution but have different scale parameters (say, standard deviations or F-spreads); if the plot is linear then the distributions of $Y$ and $X$ are different.</span>
<span id="cb81-782"><a href="#cb81-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-783"><a href="#cb81-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-786"><a href="#cb81-786" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-787"><a href="#cb81-787" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-788"><a href="#cb81-788" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-qq1</span></span>
<span id="cb81-789"><a href="#cb81-789" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Quantile-Quantile plot patterns'</span></span>
<span id="cb81-790"><a href="#cb81-790" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb81-791"><a href="#cb81-791" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb81-792"><a href="#cb81-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-793"><a href="#cb81-793" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12344</span>)</span>
<span id="cb81-794"><a href="#cb81-794" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb81-795"><a href="#cb81-795" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb81-796"><a href="#cb81-796" aria-hidden="true" tabindex="-1"></a>nq <span class="ot">&lt;-</span> <span class="dv">201</span></span>
<span id="cb81-797"><a href="#cb81-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-798"><a href="#cb81-798" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span> , nq, <span class="at">length.out =</span> <span class="dv">50</span>) <span class="sc">/</span> nq <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">/</span> nq</span>
<span id="cb81-799"><a href="#cb81-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-800"><a href="#cb81-800" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-801"><a href="#cb81-801" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">quantile</span>(X, p), <span class="at">y =</span> <span class="fu">quantile</span>(Y, p)) <span class="sc">+</span> </span>
<span id="cb81-802"><a href="#cb81-802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb81-803"><a href="#cb81-803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb81-804"><a href="#cb81-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"X &amp; Y roughly follow</span><span class="sc">\n</span><span class="st">the same distributions"</span>) <span class="sc">+</span> </span>
<span id="cb81-805"><a href="#cb81-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"X quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Y quantiles"</span>)</span>
<span id="cb81-806"><a href="#cb81-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-807"><a href="#cb81-807" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb81-808"><a href="#cb81-808" aria-hidden="true" tabindex="-1"></a>Y2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb81-809"><a href="#cb81-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-810"><a href="#cb81-810" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-811"><a href="#cb81-811" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">quantile</span>(X2, p), </span>
<span id="cb81-812"><a href="#cb81-812" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">quantile</span>(Y2, p)</span>
<span id="cb81-813"><a href="#cb81-813" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span> </span>
<span id="cb81-814"><a href="#cb81-814" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb81-815"><a href="#cb81-815" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb81-816"><a href="#cb81-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"The distribution of Y has</span><span class="sc">\n</span><span class="st">a larger location (mean/median)"</span>) <span class="sc">+</span> </span>
<span id="cb81-817"><a href="#cb81-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"X quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Y quantiles"</span>)</span>
<span id="cb81-818"><a href="#cb81-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-819"><a href="#cb81-819" aria-hidden="true" tabindex="-1"></a>X3 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb81-820"><a href="#cb81-820" aria-hidden="true" tabindex="-1"></a>Y3 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb81-821"><a href="#cb81-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-822"><a href="#cb81-822" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-823"><a href="#cb81-823" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">quantile</span>(X3, p), </span>
<span id="cb81-824"><a href="#cb81-824" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">quantile</span>(Y3, p)</span>
<span id="cb81-825"><a href="#cb81-825" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span> </span>
<span id="cb81-826"><a href="#cb81-826" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb81-827"><a href="#cb81-827" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb81-828"><a href="#cb81-828" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"The distribution of Y has</span><span class="sc">\n</span><span class="st">a larger scale (SD, F-spread etc)"</span>) <span class="sc">+</span> </span>
<span id="cb81-829"><a href="#cb81-829" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"X quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Y quantiles"</span>)</span>
<span id="cb81-830"><a href="#cb81-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-831"><a href="#cb81-831" aria-hidden="true" tabindex="-1"></a>X4 <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">100</span>, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb81-832"><a href="#cb81-832" aria-hidden="true" tabindex="-1"></a>Y4 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb81-833"><a href="#cb81-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-834"><a href="#cb81-834" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-835"><a href="#cb81-835" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">quantile</span>(X4, p), <span class="at">y =</span> <span class="fu">quantile</span>(Y4, p)) <span class="sc">+</span> </span>
<span id="cb81-836"><a href="#cb81-836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb81-837"><a href="#cb81-837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb81-838"><a href="#cb81-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"The distributions of  X and Y </span><span class="sc">\n</span><span class="st">are different"</span>) <span class="sc">+</span> </span>
<span id="cb81-839"><a href="#cb81-839" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"X quantiles"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Y quantiles"</span>)</span>
<span id="cb81-840"><a href="#cb81-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-841"><a href="#cb81-841" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, p3, p4, <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb81-842"><a href="#cb81-842" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-843"><a href="#cb81-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-844"><a href="#cb81-844" aria-hidden="true" tabindex="-1"></a>In @fig-qq1, different kinds of quantile-quantile plots are shown; note the following three cases in particular.</span>
<span id="cb81-845"><a href="#cb81-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-846"><a href="#cb81-846" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>$Y$ and $X$ follow similar distributions but the quantiles of $Y$ are a constant amount greater than the quantiles of $X$.</span>
<span id="cb81-847"><a href="#cb81-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-848"><a href="#cb81-848" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>$Y$ and $X$ follow similar distributions but the standard deviation of $Y$ is greater than that of $X$.</span>
<span id="cb81-849"><a href="#cb81-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-850"><a href="#cb81-850" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>$Y$ and $X$ follow different distributions.</span>
<span id="cb81-851"><a href="#cb81-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-852"><a href="#cb81-852" aria-hidden="true" tabindex="-1"></a>@fig-lenqq gives Q-Q plot comparing the Length of house pits for Inside and Outside groups. This Q-Q plot suggests that the two distributions are similar but the average Length is greater for the Inside dwellings.</span>
<span id="cb81-853"><a href="#cb81-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-856"><a href="#cb81-856" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-857"><a href="#cb81-857" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-858"><a href="#cb81-858" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-lenqq</span></span>
<span id="cb81-859"><a href="#cb81-859" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Quantile-Quantile plot of Length for Inside-Outside groups'</span></span>
<span id="cb81-860"><a href="#cb81-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-861"><a href="#cb81-861" aria-hidden="true" tabindex="-1"></a>nq <span class="ot">&lt;-</span> <span class="fu">length</span>(Snodgrass<span class="sc">$</span>Length)</span>
<span id="cb81-862"><a href="#cb81-862" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span> , nq, <span class="at">length.out =</span> <span class="dv">20</span>) <span class="sc">/</span> nq <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">/</span> nq</span>
<span id="cb81-863"><a href="#cb81-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-864"><a href="#cb81-864" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> Snodgrass <span class="sc">|&gt;</span> </span>
<span id="cb81-865"><a href="#cb81-865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Inside <span class="sc">==</span> <span class="st">"Inside"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb81-866"><a href="#cb81-866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Length)</span>
<span id="cb81-867"><a href="#cb81-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-868"><a href="#cb81-868" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Snodgrass <span class="sc">|&gt;</span> </span>
<span id="cb81-869"><a href="#cb81-869" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Inside <span class="sc">==</span> <span class="st">"Outside"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb81-870"><a href="#cb81-870" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Length)</span>
<span id="cb81-871"><a href="#cb81-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-872"><a href="#cb81-872" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-873"><a href="#cb81-873" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">quantile</span>(X, p), </span>
<span id="cb81-874"><a href="#cb81-874" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">quantile</span>(Y, p)</span>
<span id="cb81-875"><a href="#cb81-875" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span> </span>
<span id="cb81-876"><a href="#cb81-876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb81-877"><a href="#cb81-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb81-878"><a href="#cb81-878" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Length quantiles for Inside Group"</span>) <span class="sc">+</span> </span>
<span id="cb81-879"><a href="#cb81-879" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Length quantiles for Outside Group"</span>)</span>
<span id="cb81-880"><a href="#cb81-880" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-881"><a href="#cb81-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-882"><a href="#cb81-882" aria-hidden="true" tabindex="-1"></a>Note that the distribution of two variables $X$ and $Y$ can be compared in a number of ways using boxplots, overlaid ECDF plots etc.</span>
<span id="cb81-883"><a href="#cb81-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-884"><a href="#cb81-884" aria-hidden="true" tabindex="-1"></a><span class="fu"># Comparing Several Groups of Data</span></span>
<span id="cb81-885"><a href="#cb81-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-886"><a href="#cb81-886" aria-hidden="true" tabindex="-1"></a>In earlier sections we have seen briefly how to compare two batches of data using boxplots, Q-Q plot etc. Several boxplots can be presented in a single display so that the distributions of the variables can be compared. An example is shown in @fig-boxpl3. Note that we can instead make dotplots instead of boxplots shown in @fig-facetgrid.</span>
<span id="cb81-887"><a href="#cb81-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-890"><a href="#cb81-890" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-891"><a href="#cb81-891" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb81-892"><a href="#cb81-892" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-893"><a href="#cb81-893" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-boxpl3</span></span>
<span id="cb81-894"><a href="#cb81-894" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Comparing many batches'</span></span>
<span id="cb81-895"><a href="#cb81-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-896"><a href="#cb81-896" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb81-897"><a href="#cb81-897" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">"http://www.massey.ac.nz/~anhsmith/data/rangitikei.RData"</span>,</span>
<span id="cb81-898"><a href="#cb81-898" aria-hidden="true" tabindex="-1"></a>  <span class="at">destfile =</span> <span class="st">"rangitikei.RData"</span>)</span>
<span id="cb81-899"><a href="#cb81-899" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"rangitikei.RData"</span>)</span>
<span id="cb81-900"><a href="#cb81-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-901"><a href="#cb81-901" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rangitikei) <span class="sc">+</span> </span>
<span id="cb81-902"><a href="#cb81-902" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y=</span>people, <span class="at">x=</span>temp) <span class="sc">+</span> </span>
<span id="cb81-903"><a href="#cb81-903" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb81-904"><a href="#cb81-904" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb81-905"><a href="#cb81-905" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-906"><a href="#cb81-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-907"><a href="#cb81-907" aria-hidden="true" tabindex="-1"></a>By the term faceting, we mean in a trellis or matrix like layout for graphing. A facet grid of plots is a matrix of panels of graphs defined by row and/or column faceting variables. A simple row grid of jittered dotplots is shown in @fig-facetgrid. This display shows that more people visited Rangitikei river when the temperature is moderate than when it is too low or high.</span>
<span id="cb81-908"><a href="#cb81-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-911"><a href="#cb81-911" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-912"><a href="#cb81-912" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-913"><a href="#cb81-913" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-facetgrid</span></span>
<span id="cb81-914"><a href="#cb81-914" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Comparing many batches'</span></span>
<span id="cb81-915"><a href="#cb81-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-916"><a href="#cb81-916" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rangitikei) <span class="sc">+</span></span>
<span id="cb81-917"><a href="#cb81-917" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y=</span>people, <span class="at">x=</span><span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb81-918"><a href="#cb81-918" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span> </span>
<span id="cb81-919"><a href="#cb81-919" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(temp <span class="sc">~</span> .)</span>
<span id="cb81-920"><a href="#cb81-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-921"><a href="#cb81-921" aria-hidden="true" tabindex="-1"></a><span class="co"># Try  + geom_jitter() + facet_grid(temp ~ wind)</span></span>
<span id="cb81-922"><a href="#cb81-922" aria-hidden="true" tabindex="-1"></a><span class="co"># Try  + geom_jitter() + facet_grid( ~ temp+wind)</span></span>
<span id="cb81-923"><a href="#cb81-923" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-924"><a href="#cb81-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-925"><a href="#cb81-925" aria-hidden="true" tabindex="-1"></a>Plots can also be wrapped for better comparison and discovery of patterns and peculiarities. More <span class="in">`R`</span> instructions appear in the software handout and in course <span class="in">`Shiny`</span> apps.</span>
<span id="cb81-926"><a href="#cb81-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-927"><a href="#cb81-927" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exploring relationships</span></span>
<span id="cb81-928"><a href="#cb81-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-929"><a href="#cb81-929" aria-hidden="true" tabindex="-1"></a>Consider data which can be written as pairs ($X$, $Y$). The two groups of data ($X$ and $Y$) need not be in the same units but they are assumed to be related in some way. Scatterplots are useful in exploring the type of relationship between $X$ and $Y$.</span>
<span id="cb81-930"><a href="#cb81-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-933"><a href="#cb81-933" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-934"><a href="#cb81-934" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb81-935"><a href="#cb81-935" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">"http://www.massey.ac.nz/~anhsmith/data/testmarks.RData"</span>, </span>
<span id="cb81-936"><a href="#cb81-936" aria-hidden="true" tabindex="-1"></a>  <span class="at">destfile =</span> <span class="st">"testmarks.RData"</span>)</span>
<span id="cb81-937"><a href="#cb81-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-938"><a href="#cb81-938" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"testmarks.RData"</span>)</span>
<span id="cb81-939"><a href="#cb81-939" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-940"><a href="#cb81-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-941"><a href="#cb81-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-944"><a href="#cb81-944" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-945"><a href="#cb81-945" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-946"><a href="#cb81-946" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-sca1</span></span>
<span id="cb81-947"><a href="#cb81-947" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Scatter plot of English vs Maths scores'</span></span>
<span id="cb81-948"><a href="#cb81-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-949"><a href="#cb81-949" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(testmarks) <span class="sc">+</span></span>
<span id="cb81-950"><a href="#cb81-950" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y=</span>English, <span class="at">x=</span>Maths) <span class="sc">+</span> </span>
<span id="cb81-951"><a href="#cb81-951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb81-952"><a href="#cb81-952" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()</span>
<span id="cb81-953"><a href="#cb81-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-954"><a href="#cb81-954" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-955"><a href="#cb81-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-956"><a href="#cb81-956" aria-hidden="true" tabindex="-1"></a>The data in **testmarks.txt** consists of the records of 40 students, at a school, on standard tests of comprehension of English and Mathematics. The test marks data can be graphed plotting English test scores against Mathematics test scores. The resulting graph, known as the scatterplot, is shown as @fig-sca1. This plot enables us to see if there is a relationship between $X$ and $Y$.</span>
<span id="cb81-957"><a href="#cb81-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-958"><a href="#cb81-958" aria-hidden="true" tabindex="-1"></a>Here, the scatterplot shows a clear upward trend -- as the Mathematics mark increases so does the English mark, in general.</span>
<span id="cb81-959"><a href="#cb81-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-960"><a href="#cb81-960" aria-hidden="true" tabindex="-1"></a>There are a number of useful features that can be added to a scatterplot. The individual distributions of $X$ and $Y$ can be shown by adding appropriate graphical displays (e.g. boxplots) along the axes. If a number of the students have the same marks then it may be advisable to add a jitter as we discussed earlier.</span>
<span id="cb81-961"><a href="#cb81-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-964"><a href="#cb81-964" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-965"><a href="#cb81-965" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-966"><a href="#cb81-966" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-marginbp</span></span>
<span id="cb81-967"><a href="#cb81-967" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'English vs Maths scores'</span></span>
<span id="cb81-968"><a href="#cb81-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-969"><a href="#cb81-969" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggExtra)</span>
<span id="cb81-970"><a href="#cb81-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-971"><a href="#cb81-971" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(testmarks) <span class="sc">+</span> </span>
<span id="cb81-972"><a href="#cb81-972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y=</span>English, <span class="at">x=</span>Maths) <span class="sc">+</span></span>
<span id="cb81-973"><a href="#cb81-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb81-974"><a href="#cb81-974" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()</span>
<span id="cb81-975"><a href="#cb81-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-976"><a href="#cb81-976" aria-hidden="true" tabindex="-1"></a><span class="fu">ggMarginal</span>(p1, <span class="at">type=</span><span class="st">"boxplot"</span>)</span>
<span id="cb81-977"><a href="#cb81-977" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-978"><a href="#cb81-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-979"><a href="#cb81-979" aria-hidden="true" tabindex="-1"></a>In @fig-marginbp, it can be seen (with some effort) that each set of scores seems to be *uniformly* distributed along its axis, although the Maths marks exhibit gaps which may indicate different groups within the class.</span>
<span id="cb81-980"><a href="#cb81-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-981"><a href="#cb81-981" aria-hidden="true" tabindex="-1"></a>Finally, does the variability in English marks change as the Maths mark changes, or is it fairly constant, i.e. does the vertical height of the scatter change from left to right? In this case the variability appears to be fairly constant (we will see why this is important later).</span>
<span id="cb81-982"><a href="#cb81-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-983"><a href="#cb81-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-986"><a href="#cb81-986" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-987"><a href="#cb81-987" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-988"><a href="#cb81-988" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-sca2</span></span>
<span id="cb81-989"><a href="#cb81-989" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Scatterplot with a grouping variable'</span></span>
<span id="cb81-990"><a href="#cb81-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-991"><a href="#cb81-991" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rangitikei) <span class="sc">+</span></span>
<span id="cb81-992"><a href="#cb81-992" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> people, <span class="at">x =</span> vehicle, <span class="at">col =</span> loc, <span class="at">shape =</span> loc) <span class="sc">+</span> </span>
<span id="cb81-993"><a href="#cb81-993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb81-994"><a href="#cb81-994" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-995"><a href="#cb81-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-996"><a href="#cb81-996" aria-hidden="true" tabindex="-1"></a>If the data is known to be grouped, then this can be shown on the scatterplot by using different symbols for each group. The data file **Rangitikei.txt** gives the number of people making recreational use of the Rangitikei River and the number of vehicles seen at a particular location and time. The data were collected at two locations (location being a categorical variable). The effect of location, if any, on the number of people and vehicles can be seen on a scatterplot if we identify each plotted point with a different symbol (or colour) depending on the location (see @fig-sca2). There appears to be little effect of location on the number of people and vehicles seen.</span>
<span id="cb81-997"><a href="#cb81-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1000"><a href="#cb81-1000" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1001"><a href="#cb81-1001" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1002"><a href="#cb81-1002" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-marginbp1</span></span>
<span id="cb81-1003"><a href="#cb81-1003" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'People vs vehicle plots'</span></span>
<span id="cb81-1004"><a href="#cb81-1004" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb81-1005"><a href="#cb81-1005" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb81-1006"><a href="#cb81-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1007"><a href="#cb81-1007" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggExtra)</span>
<span id="cb81-1008"><a href="#cb81-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1009"><a href="#cb81-1009" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> rangitikei <span class="sc">|&gt;</span> </span>
<span id="cb81-1010"><a href="#cb81-1010" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-1011"><a href="#cb81-1011" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y=</span>people, <span class="at">x=</span>vehicle) <span class="sc">+</span> </span>
<span id="cb81-1012"><a href="#cb81-1012" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb81-1013"><a href="#cb81-1013" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"(A): All of the data"</span>)</span>
<span id="cb81-1014"><a href="#cb81-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1015"><a href="#cb81-1015" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> rangitikei <span class="sc">|&gt;</span> </span>
<span id="cb81-1016"><a href="#cb81-1016" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove the rows with highest value of 'people'</span></span>
<span id="cb81-1017"><a href="#cb81-1017" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(people <span class="sc">&lt;</span> <span class="fu">max</span>(people)) <span class="sc">|&gt;</span> </span>
<span id="cb81-1018"><a href="#cb81-1018" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb81-1019"><a href="#cb81-1019" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y=</span>people, <span class="at">x=</span>vehicle) <span class="sc">+</span> </span>
<span id="cb81-1020"><a href="#cb81-1020" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb81-1021"><a href="#cb81-1021" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"(B): Without observation #26"</span>)</span>
<span id="cb81-1022"><a href="#cb81-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1023"><a href="#cb81-1023" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(</span>
<span id="cb81-1024"><a href="#cb81-1024" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggMarginal</span>(p1, <span class="at">type=</span><span class="st">"boxplot"</span>), </span>
<span id="cb81-1025"><a href="#cb81-1025" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggMarginal</span>(p2, <span class="at">type=</span><span class="st">"boxplot"</span>), </span>
<span id="cb81-1026"><a href="#cb81-1026" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb81-1027"><a href="#cb81-1027" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1028"><a href="#cb81-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1029"><a href="#cb81-1029" aria-hidden="true" tabindex="-1"></a>@fig-marginbp2 shows the number of people against the number of vehicles seen as well as the distribution of each variable along the axes using boxplots (these are often referred to as *marginal distributions*). The first plot in @fig-marginbp2 (A) shows the scatter of all points, whereas the second one (B) shows the scatter with the very large value (Observation <span class="sc">\#</span>26) removed. In the first plot the outlier shows up quite clearly in both boxplots. In the second plot the boxplot associated with the variable 'people' still shows one point as an outlier, though this doesn't appear to be as extreme as the one in the first plot, and in the scatterplot the points fall close to a line which has a positive slope as is the case of @fig-marginbp2 (A). However, the distribution of each variable is skewed to the right.</span>
<span id="cb81-1030"><a href="#cb81-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1031"><a href="#cb81-1031" aria-hidden="true" tabindex="-1"></a>Note that the case which produced the outlier in both the marginal distributions did not produce a scatterplot value that was in any way unusual. While this might not surprise us (the relationship between people and vehicles might be expected to stay the same even for a location with large numbers of each), it follows that an outlier with respect to the underlying relationship between two variables will be different from an outlier in the marginal distribution sense. And such a value may not be an outlier in either marginal distribution. Look again at @fig-marginbp - there is one student with a high Maths mark but a low English mark. While neither mark is unusual in itself, the point stands out from the rest of the scatterplot because it is unusually high or low (i.e. up or down) on the plot. In general an outlier with respect to the relationship between $X$ and $Y$ is one whose $Y$ value is unusually large or small compared to other cases with similar $X$ values.</span>
<span id="cb81-1032"><a href="#cb81-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1035"><a href="#cb81-1035" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1036"><a href="#cb81-1036" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb81-1037"><a href="#cb81-1037" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">"http://www.massey.ac.nz/~anhsmith/data/horsehearts.RData"</span>,</span>
<span id="cb81-1038"><a href="#cb81-1038" aria-hidden="true" tabindex="-1"></a>  <span class="at">destfile =</span> <span class="st">"horsehearts.RData"</span>)</span>
<span id="cb81-1039"><a href="#cb81-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1040"><a href="#cb81-1040" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"horsehearts.RData"</span>)</span>
<span id="cb81-1041"><a href="#cb81-1041" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1042"><a href="#cb81-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1043"><a href="#cb81-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1046"><a href="#cb81-1046" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1047"><a href="#cb81-1047" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1048"><a href="#cb81-1048" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-marginbp2</span></span>
<span id="cb81-1049"><a href="#cb81-1049" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Weight vs Exterior Widths'</span></span>
<span id="cb81-1050"><a href="#cb81-1050" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb81-1051"><a href="#cb81-1051" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb81-1052"><a href="#cb81-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1053"><a href="#cb81-1053" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggExtra)</span>
<span id="cb81-1054"><a href="#cb81-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1055"><a href="#cb81-1055" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(horsehearts) <span class="sc">+</span> </span>
<span id="cb81-1056"><a href="#cb81-1056" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y=</span>WEIGHT, <span class="at">x=</span>EXTDIA) <span class="sc">+</span> </span>
<span id="cb81-1057"><a href="#cb81-1057" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb81-1058"><a href="#cb81-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1059"><a href="#cb81-1059" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p1 <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>)</span>
<span id="cb81-1060"><a href="#cb81-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1061"><a href="#cb81-1061" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(</span>
<span id="cb81-1062"><a href="#cb81-1062" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggMarginal</span>(p1, <span class="at">type=</span><span class="st">"density"</span>), </span>
<span id="cb81-1063"><a href="#cb81-1063" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggMarginal</span>(p2, <span class="at">type=</span><span class="st">"density"</span>), </span>
<span id="cb81-1064"><a href="#cb81-1064" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb81-1065"><a href="#cb81-1065" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1066"><a href="#cb81-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1067"><a href="#cb81-1067" aria-hidden="true" tabindex="-1"></a>Another example of a scatterplot is shown in @fig-marginbp2 which displays the weight of horses' hearts against their exterior widths in the systole phase (that is the contracted phase)(data set **horsehearts.txt**). The scatterplot indicates that a straight line would not fit the data well. On the other hand, there is some evidence the weights fall into one of two subgroups (with a value around 2.5kg being the cut off point). Scatterplots are particularly useful in pinpointing possible groupings of points so that the structure of the data is revealed which might otherwise go undetected in descriptive statistics calculated for the full data set.</span>
<span id="cb81-1068"><a href="#cb81-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1069"><a href="#cb81-1069" aria-hidden="true" tabindex="-1"></a>One way of quickly assessing whether a straight line fit is reasonable is to smooth the points in the plot using a LOWESS (LOcally WEighted Scatterplot Smoother) smoothed line. The lowess (also called loess) procedure is based on local sets of points (instead of the whole data set) at a given $x$ range, and fits a smoothed line to the data. The second scatterplot in @fig-marginbp2 shows the lowess smoother which confirms that there is curvature in the underlying relationship- possibly a cubic curve would fit this.</span>
<span id="cb81-1070"><a href="#cb81-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1071"><a href="#cb81-1071" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scatterplots and Correlation Coefficients</span></span>
<span id="cb81-1072"><a href="#cb81-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1073"><a href="#cb81-1073" aria-hidden="true" tabindex="-1"></a>We will use the data set **horsehearts.txt** of the weights of horses' hearts in relation to other heart measurements to illustrate the measurement of correlation. As we have seen before, scatterplots provide a good starting point for exploring the type of relationship between two variables. In @fig-scaqud, the weight, $Y$, is plotted against the exterior width $X$ (diastole phase in column 7 of **horsehearts.txt**). It is helpful to divide the scatterplot into four quarters, called quadrants, by drawing a line horizontally at the average $Y$ value or weight (2.235kg) and vertically at the average $X$ value (or diastole exterior width 14.13mm). The first quadrant is the top right hand side quarter. We move anti-clockwise for numbering the quadrants, and the bottom left hand side quadrant is called the third quadrant.</span>
<span id="cb81-1074"><a href="#cb81-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1075"><a href="#cb81-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1078"><a href="#cb81-1078" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1079"><a href="#cb81-1079" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb81-1080"><a href="#cb81-1080" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-scaqud</span></span>
<span id="cb81-1081"><a href="#cb81-1081" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Four quadrants of a scatter plot'</span></span>
<span id="cb81-1082"><a href="#cb81-1082" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb81-1083"><a href="#cb81-1083" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb81-1084"><a href="#cb81-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1085"><a href="#cb81-1085" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(horsehearts) <span class="sc">+</span> </span>
<span id="cb81-1086"><a href="#cb81-1086" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y=</span>WEIGHT, <span class="at">x=</span>EXTDIA) <span class="sc">+</span></span>
<span id="cb81-1087"><a href="#cb81-1087" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb81-1088"><a href="#cb81-1088" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fu">mean</span>(horsehearts<span class="sc">$</span>EXTDIA), <span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb81-1089"><a href="#cb81-1089" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fu">mean</span>(horsehearts<span class="sc">$</span>WEIGHT), <span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb81-1090"><a href="#cb81-1090" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()</span>
<span id="cb81-1091"><a href="#cb81-1091" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1092"><a href="#cb81-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1093"><a href="#cb81-1093" aria-hidden="true" tabindex="-1"></a>In @fig-scaqud, most of the points fall in the third and first quadrants which indicates that there is an increasing relationship between the two variables (as the length increases, the weight tends to increase which is not too surprising!).</span>
<span id="cb81-1094"><a href="#cb81-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1095"><a href="#cb81-1095" aria-hidden="true" tabindex="-1"></a>Although this scatterplot indicates a nonlinear relationship would fit better than a linear relationship, we will continue to use it for illustration. It is useful to have an objective measure of how strong a linear relationship is (as we have seen, stretching or compressing one or both axes can give different impressions). This measure is called the Pearsonian ***correlation coefficient*** between $X$ and $Y$ and is denoted by $r_{xy}$ or $r$ for short:</span>
<span id="cb81-1096"><a href="#cb81-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1097"><a href="#cb81-1097" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb81-1098"><a href="#cb81-1098" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb81-1099"><a href="#cb81-1099" aria-hidden="true" tabindex="-1"></a>r_{xy} &amp;= \frac{{\text {sum}(x - \bar x)(y - \bar y)}}{{\text{squareroot}<span class="co">[</span><span class="ot">\text {sum}(x - \bar x)^2  {\text{sum}}(y - \bar y)^2 </span><span class="co">]</span>}} <span class="sc">\\</span></span>
<span id="cb81-1100"><a href="#cb81-1100" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span></span>
<span id="cb81-1101"><a href="#cb81-1101" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{\sum (x-\bar{x})(y-\bar{y}) }{\sqrt{\sum (x-\bar{x})^{2}  \sum (y-\bar{y})^{2}  } } <span class="sc">\\</span></span>
<span id="cb81-1102"><a href="#cb81-1102" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span></span>
<span id="cb81-1103"><a href="#cb81-1103" aria-hidden="true" tabindex="-1"></a>&amp;=\frac{S_{xy} }{\sqrt{S_{xx} S_{yy} } }</span>
<span id="cb81-1104"><a href="#cb81-1104" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb81-1105"><a href="#cb81-1105" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb81-1106"><a href="#cb81-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1107"><a href="#cb81-1107" aria-hidden="true" tabindex="-1"></a>Here $S_{xx}=S_x^2$ is the variance of $X$, $S_{yy}=S_y^2$ is the variance of $Y$, and $S_{xy}$ is the covariance between $X$ and $Y$.</span>
<span id="cb81-1108"><a href="#cb81-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1109"><a href="#cb81-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1110"><a href="#cb81-1110" aria-hidden="true" tabindex="-1"></a>The (Pearsonian) correlation (coefficient) between WEIGHT and EXTDIA equals 0.759. Perfect correlation (+l) would occur if all points fell on a straight line in the first and third quadrants. Assuming a bivariate normal distribution, the null hypothesis that the true correlation coefficient $\rho _{xy} =0$ can be tested using the test statistic $$t = \frac{{r_{xy} }}{{\sqrt {\frac{{1 - r_{xy}^2 }}{{n - 2}}} }}$$ Statistical software programs directly give the $p$-value for this test. The estimated correlation coefficient of 0.759 for $(n-2)=44$ df is significant ($p$-value is close to zero). Testing of hypothesis related topics are covered in the next Chapter.</span>
<span id="cb81-1111"><a href="#cb81-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1112"><a href="#cb81-1112" aria-hidden="true" tabindex="-1"></a>The scatterplot indicates that there may be two groups of horses; whose hearts weigh about 2.3 kg or more and whose heart weights are less than 2.3 kg. If possible, one should try to establish whether there are two groups for some reason (perhaps age, sex or breed). If the points tended to concentrate in quadrants 2 and 4, this would indicate that the correlation between $Y$ and $X$ is negative (as $X$ increases, $Y$ tends to decrease). If the points were evenly scattered among the four quadrants, the correlation coefficient would be close to zero.</span>
<span id="cb81-1113"><a href="#cb81-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1116"><a href="#cb81-1116" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1117"><a href="#cb81-1117" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb81-1118"><a href="#cb81-1118" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb81-1119"><a href="#cb81-1119" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-corp</span></span>
<span id="cb81-1120"><a href="#cb81-1120" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Limitations of the correlation coefficient'</span></span>
<span id="cb81-1121"><a href="#cb81-1121" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb81-1122"><a href="#cb81-1122" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb81-1123"><a href="#cb81-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1124"><a href="#cb81-1124" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb81-1125"><a href="#cb81-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1126"><a href="#cb81-1126" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb81-1127"><a href="#cb81-1127" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">=</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.9</span>), <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="dv">1</span>))</span>
<span id="cb81-1128"><a href="#cb81-1128" aria-hidden="true" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(<span class="dv">300</span>, <span class="at">mu=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">Sigma=</span>Sigma)</span>
<span id="cb81-1129"><a href="#cb81-1129" aria-hidden="true" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(dfm)</span>
<span id="cb81-1130"><a href="#cb81-1130" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dfm)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"X"</span>, <span class="st">"Y"</span>)</span>
<span id="cb81-1131"><a href="#cb81-1131" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dfm, <span class="fu">aes</span>(<span class="at">x=</span>X, <span class="at">y=</span>Y))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"Positive correlation"</span>)<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>)</span>
<span id="cb81-1132"><a href="#cb81-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1133"><a href="#cb81-1133" aria-hidden="true" tabindex="-1"></a>Sigma<span class="ot">=</span><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.9</span>), <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.9</span>, <span class="dv">1</span>))</span>
<span id="cb81-1134"><a href="#cb81-1134" aria-hidden="true" tabindex="-1"></a>dfm<span class="ot">&lt;-</span><span class="fu">mvrnorm</span>(<span class="dv">300</span>, <span class="at">mu=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">Sigma=</span>Sigma)</span>
<span id="cb81-1135"><a href="#cb81-1135" aria-hidden="true" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(dfm)</span>
<span id="cb81-1136"><a href="#cb81-1136" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dfm)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"X"</span>, <span class="st">"Y"</span>)</span>
<span id="cb81-1137"><a href="#cb81-1137" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dfm, <span class="fu">aes</span>(<span class="at">x=</span>X, <span class="at">y=</span>Y))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"Negative correlation"</span>)<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>)</span>
<span id="cb81-1138"><a href="#cb81-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1139"><a href="#cb81-1139" aria-hidden="true" tabindex="-1"></a>Sigma<span class="ot">=</span><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb81-1140"><a href="#cb81-1140" aria-hidden="true" tabindex="-1"></a>dfm<span class="ot">&lt;-</span><span class="fu">mvrnorm</span>(<span class="dv">300</span>, <span class="at">mu=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">Sigma=</span>Sigma)</span>
<span id="cb81-1141"><a href="#cb81-1141" aria-hidden="true" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(dfm)</span>
<span id="cb81-1142"><a href="#cb81-1142" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dfm)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"X"</span>, <span class="st">"Y"</span>)</span>
<span id="cb81-1143"><a href="#cb81-1143" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dfm, <span class="fu">aes</span>(<span class="at">x=</span>X, <span class="at">y=</span>Y))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"Near zero correlation"</span>)<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>)</span>
<span id="cb81-1144"><a href="#cb81-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1145"><a href="#cb81-1145" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="at">length.out=</span><span class="dv">300</span>)</span>
<span id="cb81-1146"><a href="#cb81-1146" aria-hidden="true" tabindex="-1"></a>Y<span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>X <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>X<span class="sc">^</span><span class="fl">2.2</span><span class="sc">+</span><span class="fu">rlnorm</span>(<span class="dv">300</span>, <span class="fl">1.1</span>,<span class="fl">1.3</span>)</span>
<span id="cb81-1147"><a href="#cb81-1147" aria-hidden="true" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(X, Y))</span>
<span id="cb81-1148"><a href="#cb81-1148" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dfm)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"X"</span>, <span class="st">"Y"</span>)</span>
<span id="cb81-1149"><a href="#cb81-1149" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dfm, <span class="fu">aes</span>(<span class="at">x=</span>X, <span class="at">y=</span>Y))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"Correlation coefficient </span><span class="sc">\n</span><span class="st">does not capture </span><span class="sc">\n</span><span class="st">nonlinear relationships"</span>)<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>)</span>
<span id="cb81-1150"><a href="#cb81-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1151"><a href="#cb81-1151" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">120</span>, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb81-1152"><a href="#cb81-1152" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">120</span>, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb81-1153"><a href="#cb81-1153" aria-hidden="true" tabindex="-1"></a>X[<span class="dv">61</span><span class="sc">:</span><span class="dv">120</span>] <span class="ot">&lt;-</span> X[<span class="dv">61</span><span class="sc">:</span><span class="dv">120</span>]<span class="sc">+</span><span class="dv">150</span></span>
<span id="cb81-1154"><a href="#cb81-1154" aria-hidden="true" tabindex="-1"></a>Y[<span class="dv">61</span><span class="sc">:</span><span class="dv">120</span>] <span class="ot">&lt;-</span> Y[<span class="dv">61</span><span class="sc">:</span><span class="dv">120</span>]<span class="sc">+</span><span class="dv">30</span></span>
<span id="cb81-1155"><a href="#cb81-1155" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> X<span class="sc">/</span><span class="dv">30</span></span>
<span id="cb81-1156"><a href="#cb81-1156" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Y<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb81-1157"><a href="#cb81-1157" aria-hidden="true" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">X =</span> X, <span class="at">Y =</span> Y)</span>
<span id="cb81-1158"><a href="#cb81-1158" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dfm, <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y)) <span class="sc">+</span> <span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>)</span>
<span id="cb81-1159"><a href="#cb81-1159" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> p5 <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Correlation is </span><span class="sc">\n</span><span class="st">near zero within subgroups</span><span class="sc">\n</span><span class="st">Spurious correlation"</span>)</span>
<span id="cb81-1160"><a href="#cb81-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1161"><a href="#cb81-1161" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb81-1162"><a href="#cb81-1162" aria-hidden="true" tabindex="-1"></a>Sigma<span class="ot">=</span><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="fl">0.6</span>), <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="dv">3</span>))</span>
<span id="cb81-1163"><a href="#cb81-1163" aria-hidden="true" tabindex="-1"></a>dfm<span class="ot">&lt;-</span><span class="fu">mvrnorm</span>(<span class="dv">300</span>, <span class="at">mu=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">Sigma=</span>Sigma)</span>
<span id="cb81-1164"><a href="#cb81-1164" aria-hidden="true" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(dfm)</span>
<span id="cb81-1165"><a href="#cb81-1165" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dfm)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"X"</span>, <span class="st">"Y"</span>)</span>
<span id="cb81-1166"><a href="#cb81-1166" aria-hidden="true" tabindex="-1"></a>dfm<span class="sc">$</span>Y[<span class="dv">151</span><span class="sc">:</span><span class="dv">300</span>] <span class="ot">&lt;-</span> dfm<span class="sc">$</span>Y[<span class="dv">151</span><span class="sc">:</span><span class="dv">300</span>]<span class="sc">+</span><span class="dv">30</span></span>
<span id="cb81-1167"><a href="#cb81-1167" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dfm, <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y)) <span class="sc">+</span> <span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>)</span>
<span id="cb81-1168"><a href="#cb81-1168" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> p6 <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Correlation is </span><span class="sc">\n</span><span class="st">high within subgroups</span><span class="sc">\n</span><span class="st">Simpson paradox"</span>)</span>
<span id="cb81-1169"><a href="#cb81-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1170"><a href="#cb81-1170" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1,p2, p3, p4, p5, p6, <span class="at">ncol=</span><span class="dv">3</span>)</span>
<span id="cb81-1171"><a href="#cb81-1171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1172"><a href="#cb81-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1173"><a href="#cb81-1173" aria-hidden="true" tabindex="-1"></a>@fig-corp shows a number of possible plots of $Y$ against $X$ and their associated correlation coefficients. Notice that the correlation coefficient may be close to zero even though there is a strong pattern present. This is because the correlation coefficient only measures the strength of the *linear* relationship between two variables. In the presence of subgroups the correlation coefficient can become spurious or even be close to zero when there is indeed the correlation is high within the subgroup. Simpson (1951) demonstrated that relationships noted within a population may not hold and could be the opposite within all subgroups. This amalgamation paradox can happen to most summary statistical measures including the correlation coefficient.</span>
<span id="cb81-1174"><a href="#cb81-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1175"><a href="#cb81-1175" aria-hidden="true" tabindex="-1"></a>The other situation that is not shown in @fig-corp is that the correlation coefficient can be positive and a line would be a reasonable fit although the scatter diagram indicates that both $Y$ and $X$ have skewed distributions suggesting that transformations should be applied.</span>
<span id="cb81-1176"><a href="#cb81-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1177"><a href="#cb81-1177" aria-hidden="true" tabindex="-1"></a><span class="al">![Sign of the correlation coefficient](images/corpat.png)</span>{#fig-corpat}</span>
<span id="cb81-1178"><a href="#cb81-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1179"><a href="#cb81-1179" aria-hidden="true" tabindex="-1"></a>To see why the sign of $r$ indicates the direction of the relationship, consider @fig-corpat.</span>
<span id="cb81-1180"><a href="#cb81-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1181"><a href="#cb81-1181" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Regardless of which quadrant the point is in, the contribution to $S_{xx}$ and $S_{yy}$ is positive, as these are sums of squares.</span>
<span id="cb81-1182"><a href="#cb81-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1183"><a href="#cb81-1183" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>In the first quadrant the contribution of each point to the cross product $S_{xy}$ is $(+) \times (+)$, that is a positive amount. In the third quadrant, each contribution is $(-)\times (-)$, that is a positive amount. This is the reason that the correlation coefficient is positive if most points are in the first and third quadrants.</span>
<span id="cb81-1184"><a href="#cb81-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1185"><a href="#cb81-1185" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Points in the second and fourth quadrant contribute negative amounts, $(-)\times (+)$ or $(+)\times (-)$, to the cross product $S_{xy}$. If there are a considerable number of points in quadrants 2 and 4, the correlation coefficient will tend to be negative.</span>
<span id="cb81-1186"><a href="#cb81-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1187"><a href="#cb81-1187" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scatterplot and correlation Matrices</span></span>
<span id="cb81-1188"><a href="#cb81-1188" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1189"><a href="#cb81-1189" aria-hidden="true" tabindex="-1"></a>  When there are more than two variables of interest, it is possible to draw scatterplots of each pair of variables but this becomes a bewildering exercise as the number of variables increases. One way to keep track of these plots is to set them out in a scatterplot matrix as in @fig-matplt2 which is based on the data set **pinetree.txt** containing the circumference measurements of pine trees at four positions (Top, Third, Second and First) and in three areas of a forest. This plot also shows the simple correlation coefficients on the upper diagonal and smoothed density plots on the main diagonal of the matrix. This plot clearly shows that the variables are strongly related to each other. In particular, the Top circumference can be predicted reasonably well based on the bottom circumference. Even though the correlations are high, a quadratic model may fit better. @fig-matplt2 seems to show a non-random pattern in the way points appear on the plot. This may be due to the Area effect because the circumference data were collected from three different areas. @fig-matplt2 confirms that this is indeed the case.</span>
<span id="cb81-1190"><a href="#cb81-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1193"><a href="#cb81-1193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1194"><a href="#cb81-1194" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb81-1195"><a href="#cb81-1195" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">"http://www.massey.ac.nz/~anhsmith/data/pinetree.RData"</span>, </span>
<span id="cb81-1196"><a href="#cb81-1196" aria-hidden="true" tabindex="-1"></a>  <span class="at">destfile =</span> <span class="st">"pinetree.RData"</span>)</span>
<span id="cb81-1197"><a href="#cb81-1197" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"pinetree.RData"</span>)</span>
<span id="cb81-1198"><a href="#cb81-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1199"><a href="#cb81-1199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1200"><a href="#cb81-1200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1201"><a href="#cb81-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1204"><a href="#cb81-1204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1205"><a href="#cb81-1205" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1206"><a href="#cb81-1206" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb81-1207"><a href="#cb81-1207" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-matplt2</span></span>
<span id="cb81-1208"><a href="#cb81-1208" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Four quadrants of a scatter plot'</span></span>
<span id="cb81-1209"><a href="#cb81-1209" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb81-1210"><a href="#cb81-1210" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb81-1211"><a href="#cb81-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1212"><a href="#cb81-1212" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb81-1213"><a href="#cb81-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1214"><a href="#cb81-1214" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(pinetree, <span class="at">columns =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb81-1215"><a href="#cb81-1215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1216"><a href="#cb81-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1217"><a href="#cb81-1217" aria-hidden="true" tabindex="-1"></a>It is also possible to use the colour option as well as the subgroup-wise correlation coefficients. Try</span>
<span id="cb81-1218"><a href="#cb81-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1219"><a href="#cb81-1219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1220"><a href="#cb81-1220" aria-hidden="true" tabindex="-1"></a><span class="in">ggpairs(</span></span>
<span id="cb81-1221"><a href="#cb81-1221" aria-hidden="true" tabindex="-1"></a><span class="in">  pinetree, </span></span>
<span id="cb81-1222"><a href="#cb81-1222" aria-hidden="true" tabindex="-1"></a><span class="in">  columns = 2:5,</span></span>
<span id="cb81-1223"><a href="#cb81-1223" aria-hidden="true" tabindex="-1"></a><span class="in">  mapping = aes(colour = Area)</span></span>
<span id="cb81-1224"><a href="#cb81-1224" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb81-1225"><a href="#cb81-1225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1226"><a href="#cb81-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1227"><a href="#cb81-1227" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exploring bivariate distributions</span></span>
<span id="cb81-1228"><a href="#cb81-1228" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1229"><a href="#cb81-1229" aria-hidden="true" tabindex="-1"></a>  The two-dimensional or the **bivariate probability distribution** of $X$ and $Y$ can be displayed as a 2-d smoothed density plot or as a probability contour plot. @fig-matplt3 shows such plots. This figure rather suggests that there may be two separate joint probability distributions of Maths and English scores. This clue is not obtained in the scatter plot of English score against Maths score but only from the other three plots.</span>
<span id="cb81-1230"><a href="#cb81-1230" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1231"><a href="#cb81-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1234"><a href="#cb81-1234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1235"><a href="#cb81-1235" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1236"><a href="#cb81-1236" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-matplt3</span></span>
<span id="cb81-1237"><a href="#cb81-1237" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Exploring bivariate distributions'</span></span>
<span id="cb81-1238"><a href="#cb81-1238" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb81-1239"><a href="#cb81-1239" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb81-1240"><a href="#cb81-1240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1241"><a href="#cb81-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1242"><a href="#cb81-1242" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> testmarks<span class="sc">$</span>English</span>
<span id="cb81-1243"><a href="#cb81-1243" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> testmarks<span class="sc">$</span>Maths</span>
<span id="cb81-1244"><a href="#cb81-1244" aria-hidden="true" tabindex="-1"></a>def.par <span class="ot">=</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb81-1245"><a href="#cb81-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1246"><a href="#cb81-1246" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>),</span>
<span id="cb81-1247"><a href="#cb81-1247" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Maths Marks"</span>,</span>
<span id="cb81-1248"><a href="#cb81-1248" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"English Marks"</span>,</span>
<span id="cb81-1249"><a href="#cb81-1249" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Scatter plot of English Scores vs Maths Scores"</span>)</span>
<span id="cb81-1250"><a href="#cb81-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1251"><a href="#cb81-1251" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">=</span> <span class="fu">kde2d</span>(x, y, <span class="at">n =</span> <span class="dv">50</span>, <span class="at">lims =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">100</span>))</span>
<span id="cb81-1252"><a href="#cb81-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1253"><a href="#cb81-1253" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(f1,</span>
<span id="cb81-1254"><a href="#cb81-1254" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">"Maths Marks"</span>,</span>
<span id="cb81-1255"><a href="#cb81-1255" aria-hidden="true" tabindex="-1"></a>      <span class="at">ylab =</span> <span class="st">"English Marks"</span>,</span>
<span id="cb81-1256"><a href="#cb81-1256" aria-hidden="true" tabindex="-1"></a>      <span class="at">col=</span><span class="fu">gray</span>((<span class="dv">0</span><span class="sc">:</span><span class="dv">32</span>)<span class="sc">/</span><span class="dv">32</span>), <span class="at">main =</span> <span class="st">"Image Plot"</span>)</span>
<span id="cb81-1257"><a href="#cb81-1257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1258"><a href="#cb81-1258" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(f1, </span>
<span id="cb81-1259"><a href="#cb81-1259" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Maths Marks"</span>,</span>
<span id="cb81-1260"><a href="#cb81-1260" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"English Marks"</span>,</span>
<span id="cb81-1261"><a href="#cb81-1261" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Density contourPlot"</span>)</span>
<span id="cb81-1262"><a href="#cb81-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1263"><a href="#cb81-1263" aria-hidden="true" tabindex="-1"></a>op <span class="ot">=</span> <span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>)<span class="sc">+</span>.<span class="dv">1</span>)</span>
<span id="cb81-1264"><a href="#cb81-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1265"><a href="#cb81-1265" aria-hidden="true" tabindex="-1"></a><span class="fu">persp</span>(f1, <span class="at">phi =</span> <span class="dv">45</span>, <span class="at">theta =</span> <span class="dv">30</span>,</span>
<span id="cb81-1266"><a href="#cb81-1266" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">"Maths Marks"</span>, <span class="at">ylab =</span> <span class="st">"English Marks"</span>, <span class="at">zlab =</span> <span class="st">"density"</span>,</span>
<span id="cb81-1267"><a href="#cb81-1267" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"gray"</span>, <span class="at">shade =</span> .<span class="dv">5</span>, <span class="at">border =</span> <span class="cn">NA</span>,</span>
<span id="cb81-1268"><a href="#cb81-1268" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">"Perspective plot (density estimation)"</span>)</span>
<span id="cb81-1269"><a href="#cb81-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1270"><a href="#cb81-1270" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(op)</span>
<span id="cb81-1271"><a href="#cb81-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1272"><a href="#cb81-1272" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(def.par)</span>
<span id="cb81-1273"><a href="#cb81-1273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1274"><a href="#cb81-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1275"><a href="#cb81-1275" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```{r} --&gt;</span></span>
<span id="cb81-1276"><a href="#cb81-1276" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- p0 &lt;- testmarks |&gt;  --&gt;</span></span>
<span id="cb81-1277"><a href="#cb81-1277" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   ggplot() +  --&gt;</span></span>
<span id="cb81-1278"><a href="#cb81-1278" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   aes(x = Maths, y = English) --&gt;</span></span>
<span id="cb81-1279"><a href="#cb81-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1280"><a href="#cb81-1280" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- p1 &lt;- p0 + geom_point() --&gt;</span></span>
<span id="cb81-1281"><a href="#cb81-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1282"><a href="#cb81-1282" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- p2 &lt;- p0 + geom_bin2d() --&gt;</span></span>
<span id="cb81-1283"><a href="#cb81-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1284"><a href="#cb81-1284" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb81-1285"><a href="#cb81-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1286"><a href="#cb81-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1287"><a href="#cb81-1287" aria-hidden="true" tabindex="-1"></a>In summary, scatterplots may reveal many properties and peculiarities about the relationship of $Y$ to $X$, namely</span>
<span id="cb81-1288"><a href="#cb81-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1289"><a href="#cb81-1289" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Trends**: the overall trend may be positive or negative. It may be appropriate to fit a straight line or a curve.</span>
<span id="cb81-1290"><a href="#cb81-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1291"><a href="#cb81-1291" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Outliers**: points which appear to be unusual, or outliers, may be evident. In a scatterplot, the outlier need not be in the extreme scale of both $X$ and $Y$, and anything appearing peculiar or as a rogue point must be investigated.</span>
<span id="cb81-1292"><a href="#cb81-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1293"><a href="#cb81-1293" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Gaps** may be seen in the data which may indicate that different groups are present. On the other hand, if it is known that points belong to different groups, the points can be tagged with different symbols. The basic idea is to see whether different groups follow the same pattern or different patterns.</span>
<span id="cb81-1294"><a href="#cb81-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1295"><a href="#cb81-1295" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Variability** of $Y$ change with $X$, or may be fairly constant. **Clustering** of points with smaller variability when compared to rest of the points may also be revealed in some scatterplots.</span>
<span id="cb81-1296"><a href="#cb81-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1297"><a href="#cb81-1297" aria-hidden="true" tabindex="-1"></a>Both joint and marginal distributions of $X$ and $Y$ are important. We also consider the distribution of each variable separately, and explore whether they have symmetric distributions or not.</span>
<span id="cb81-1298"><a href="#cb81-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1299"><a href="#cb81-1299" aria-hidden="true" tabindex="-1"></a><span class="fu">## Higher dimensional data</span></span>
<span id="cb81-1300"><a href="#cb81-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1301"><a href="#cb81-1301" aria-hidden="true" tabindex="-1"></a>A short-cut to explore three numerical variables is to obtain a contour plot. In @fig-matplt3, the contours were the joint density of Maths and English marks. Instead, we can just use three numerical variables and show the third variable (Z) as a contour on a scatter plot of Y vs. X. What this means is that several combinations of X and Y can lead to the same Z. So we have to use some smoothing method or a model to obtain the contours and form a grid. The <span class="in">`R`</span> package *plotly* is rather simple and powerful to obtain dynamic or interactive plots. The plots produced with this package are colour optimised for viewing and hence they may not be the best for printing but good for EDA purposes. We can also hover over the graph and view the graphed data. After loading the pine tree data, try-</span>
<span id="cb81-1302"><a href="#cb81-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1305"><a href="#cb81-1305" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1306"><a href="#cb81-1306" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb81-1307"><a href="#cb81-1307" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb81-1308"><a href="#cb81-1308" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">type =</span> <span class="st">'contour'</span>, </span>
<span id="cb81-1309"><a href="#cb81-1309" aria-hidden="true" tabindex="-1"></a>        <span class="at">x=</span>pinetree<span class="sc">$</span>First, </span>
<span id="cb81-1310"><a href="#cb81-1310" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span>pinetree<span class="sc">$</span>Second, </span>
<span id="cb81-1311"><a href="#cb81-1311" aria-hidden="true" tabindex="-1"></a>        <span class="at">z=</span>pinetree<span class="sc">$</span>Top)</span>
<span id="cb81-1312"><a href="#cb81-1312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1313"><a href="#cb81-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1314"><a href="#cb81-1314" aria-hidden="true" tabindex="-1"></a>For the Snodgrass data, the contour plot of East (X) vs, South (Y) vs. Area (Z) is shown in @fig-cntrplt. This plot shows that bigger house pits are inside the X and Y axis show the geolocations.</span>
<span id="cb81-1315"><a href="#cb81-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1316"><a href="#cb81-1316" aria-hidden="true" tabindex="-1"></a><span class="al">![A contour plot for the Snodgrass data](images/ContourPlot.png)</span>{#fig-cntrplt}</span>
<span id="cb81-1317"><a href="#cb81-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1318"><a href="#cb81-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1319"><a href="#cb81-1319" aria-hidden="true" tabindex="-1"></a>A bubble plot is another option where a scatter plot shows the third variable as the size of the bubble on a scatter plot. This type of plot can be restrictive for some datasets depending on the variability involved in the third variable. @fig-bubble shows the location of the house pits and total Area. This plot not only gives the spatial view of the tribal area but indirectly reveals the clustering of house sizes.</span>
<span id="cb81-1320"><a href="#cb81-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1323"><a href="#cb81-1323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1324"><a href="#cb81-1324" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-bubble</span></span>
<span id="cb81-1325"><a href="#cb81-1325" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'A bubble plot for the Snodgrass data'</span></span>
<span id="cb81-1326"><a href="#cb81-1326" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Snodgrass) <span class="sc">+</span> </span>
<span id="cb81-1327"><a href="#cb81-1327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>East, <span class="at">y=</span>South, <span class="at">colour=</span>Area, <span class="at">size=</span>Area) <span class="sc">+</span> </span>
<span id="cb81-1328"><a href="#cb81-1328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb81-1329"><a href="#cb81-1329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1330"><a href="#cb81-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1331"><a href="#cb81-1331" aria-hidden="true" tabindex="-1"></a>Using the appropriate software, it is possible to explore three variables using a 3-D scatter plot. We explore the pinetree data in @fig-3d which clearly shows the strong relationships and the Area effect. The other forms of exploring 3 variables include 3-D surface plots.</span>
<span id="cb81-1332"><a href="#cb81-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1335"><a href="#cb81-1335" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1336"><a href="#cb81-1336" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-3d</span></span>
<span id="cb81-1337"><a href="#cb81-1337" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'A 3-D plot'</span></span>
<span id="cb81-1338"><a href="#cb81-1338" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb81-1339"><a href="#cb81-1339" aria-hidden="true" tabindex="-1"></a><span class="fu">cloud</span>(Top <span class="sc">~</span> First<span class="sc">+</span>Second, <span class="at">group=</span>Area, <span class="at">data=</span>pinetree)</span>
<span id="cb81-1340"><a href="#cb81-1340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1341"><a href="#cb81-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1342"><a href="#cb81-1342" aria-hidden="true" tabindex="-1"></a>R packages such as <span class="in">`rgl`</span> and <span class="in">`plotly`</span> allow rotations of axes for graphical exploration of the relationships among variables, detection of peculiar points etc. It is easy to miss the form of relationships if proper rotational exploration is not done. Try:</span>
<span id="cb81-1343"><a href="#cb81-1343" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1346"><a href="#cb81-1346" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1347"><a href="#cb81-1347" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgl)</span>
<span id="cb81-1348"><a href="#cb81-1348" aria-hidden="true" tabindex="-1"></a><span class="fu">plot3d</span>(Snodgrass<span class="sc">$</span>East, Snodgrass<span class="sc">$</span>South, Snodgrass<span class="sc">$</span>Area)</span>
<span id="cb81-1349"><a href="#cb81-1349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1350"><a href="#cb81-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1351"><a href="#cb81-1351" aria-hidden="true" tabindex="-1"></a><span class="in">`plotly`</span> is great for interactive 3d plots (though they only work with HTML, not PDF).</span>
<span id="cb81-1352"><a href="#cb81-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1355"><a href="#cb81-1355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1356"><a href="#cb81-1356" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(Snodgrass, <span class="at">x =</span> <span class="sc">~</span>East, <span class="at">y =</span> <span class="sc">~</span>South, <span class="at">z =</span> <span class="sc">~</span>Area) <span class="sc">|&gt;</span> </span>
<span id="cb81-1357"><a href="#cb81-1357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_markers</span>()</span>
<span id="cb81-1358"><a href="#cb81-1358" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1359"><a href="#cb81-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1360"><a href="#cb81-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1361"><a href="#cb81-1361" aria-hidden="true" tabindex="-1"></a>If we wish to examine the relationships between (three or more) variables we could do so with a conditioning plot, otherwise known as a **coplot**. A coplot is a scatterplot matrix where each panel in the matrix is a scatterplot of the same two variables, whose observations are restricted by the values of a third (and possibly a fourth) variable.</span>
<span id="cb81-1362"><a href="#cb81-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1363"><a href="#cb81-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1366"><a href="#cb81-1366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1367"><a href="#cb81-1367" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-coplt</span></span>
<span id="cb81-1368"><a href="#cb81-1368" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'A co-plot'</span></span>
<span id="cb81-1369"><a href="#cb81-1369" aria-hidden="true" tabindex="-1"></a><span class="fu">coplot</span>(Top<span class="sc">~</span> First <span class="sc">|</span> Second<span class="sc">*</span>Area, <span class="at">data =</span> pinetree)</span>
<span id="cb81-1370"><a href="#cb81-1370" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1371"><a href="#cb81-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1372"><a href="#cb81-1372" aria-hidden="true" tabindex="-1"></a>The coplot in @fig-coplt shows that pine trees are not maturing well in Area 3, given that fewer points are on the right hand side of the graph when compared to Areas 1 and 2.</span>
<span id="cb81-1373"><a href="#cb81-1373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1374"><a href="#cb81-1374" aria-hidden="true" tabindex="-1"></a>Obviously we cannot to visualise several dimensions easily but there are few shortcuts for multivariate data visualisation such as the Chernoff or cartoon faces plot. This type of plot is based on our ability to recognise features in human faces. This type of plot is suitable for small datasets and identify unusual observations, for example observation <span class="sc">\#</span>46 in *horsehearts* data shown in @fig-faceplot.</span>
<span id="cb81-1375"><a href="#cb81-1375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1378"><a href="#cb81-1378" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1379"><a href="#cb81-1379" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb81-1380"><a href="#cb81-1380" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-faceplot</span></span>
<span id="cb81-1381"><a href="#cb81-1381" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'A Cartoon Faces plot'</span></span>
<span id="cb81-1382"><a href="#cb81-1382" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb81-1383"><a href="#cb81-1383" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb81-1384"><a href="#cb81-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1385"><a href="#cb81-1385" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(aplpack)</span>
<span id="cb81-1386"><a href="#cb81-1386" aria-hidden="true" tabindex="-1"></a><span class="fu">faces</span>(horsehearts)</span>
<span id="cb81-1387"><a href="#cb81-1387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1388"><a href="#cb81-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1389"><a href="#cb81-1389" aria-hidden="true" tabindex="-1"></a>Exploration of higher dimensional data requires further theory. Reduction of dimensions and display of crucial information using newly generated variables based on the theory of multivariate statistics are the natural way to explore higher dimensional data. Many such approaches are taught mainly in 300 level papers. A couple of such methods are explained below:</span>
<span id="cb81-1390"><a href="#cb81-1390" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1391"><a href="#cb81-1391" aria-hidden="true" tabindex="-1"></a>  One of the tricks to handle multidimensional data is to reduce the number of dimensions using *principal components*. These are simply linear combinations of the original variables and may not have physical meaning. In some cases, we may be able to identify a latent variable that represents such a linear combination of variables. For example, <span class="in">`physical endurance`</span> is latent but can be measured indirectly using many variables such as time taken to run 100m, maximum weight lifted etc. The first principal component (PC) is found in such a way that it accounts for the most variation in the data. The second principal component is found independent of the first in such a way that it accounts for the most variation that is not explained by the first principal component. The following output shows that the first two components are sufficient to explain most (<span class="sc">\&gt;</span>98%) of the variation in the four numerical variables in the pinetree dataset.</span>
<span id="cb81-1392"><a href="#cb81-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1395"><a href="#cb81-1395" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1396"><a href="#cb81-1396" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pc</span></span>
<span id="cb81-1397"><a href="#cb81-1397" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: ''</span></span>
<span id="cb81-1398"><a href="#cb81-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1399"><a href="#cb81-1399" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(pinetree[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-1400"><a href="#cb81-1400" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb81-1401"><a href="#cb81-1401" aria-hidden="true" tabindex="-1"></a><span class="co"># Try autoplot(fit)</span></span>
<span id="cb81-1402"><a href="#cb81-1402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1403"><a href="#cb81-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1404"><a href="#cb81-1404" aria-hidden="true" tabindex="-1"></a>A biplot aims to show both the observations and variables in the same plot formed by the first two principal components. @fig-biplot shows the biplot for the pinetree variables and data.</span>
<span id="cb81-1405"><a href="#cb81-1405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1408"><a href="#cb81-1408" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1409"><a href="#cb81-1409" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-biplot</span></span>
<span id="cb81-1410"><a href="#cb81-1410" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'A biplot'</span></span>
<span id="cb81-1411"><a href="#cb81-1411" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb81-1412"><a href="#cb81-1412" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb81-1413"><a href="#cb81-1413" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit, <span class="at">loadings =</span> <span class="cn">TRUE</span>, <span class="at">loadings.label =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-1414"><a href="#cb81-1414" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1415"><a href="#cb81-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1416"><a href="#cb81-1416" aria-hidden="true" tabindex="-1"></a>For interpreting the biplot, consider the following patterns:</span>
<span id="cb81-1417"><a href="#cb81-1417" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1418"><a href="#cb81-1418" aria-hidden="true" tabindex="-1"></a><span class="ss">  1.  </span>If points that are close to each other, it means observations with similar values. So you can spot the odd ones.</span>
<span id="cb81-1419"><a href="#cb81-1419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1420"><a href="#cb81-1420" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>The correlation between variables is indicated by the cosine of the angle between vectors displayed for the variables. Highly correlated variables will point in the same direction. If variables are uncorrelated, they will be at right angles to each other. For the pine tree data, we notice high correlation. This has implications in model building. We may not need all of the three predictor variables of Top. More will follow in later Chapters.</span>
<span id="cb81-1421"><a href="#cb81-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1422"><a href="#cb81-1422" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>The cosine of the angle between a vector and an axis indicates the contribution of the corresponding variable to the axis dimension. Look particularly the X-axis that represents the first principal component. The variables contribute somewhat the same.</span>
<span id="cb81-1423"><a href="#cb81-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1424"><a href="#cb81-1424" aria-hidden="true" tabindex="-1"></a>Note that the biplot is not useful if the first two principal components account for only a small part of the overall variation. We can also examine relationship between the categorical factors and the principal components but this topic is skipped in this course.</span>
<span id="cb81-1425"><a href="#cb81-1425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1426"><a href="#cb81-1426" aria-hidden="true" tabindex="-1"></a><span class="fu"># Time series EDA</span></span>
<span id="cb81-1427"><a href="#cb81-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1428"><a href="#cb81-1428" aria-hidden="true" tabindex="-1"></a>A **Time Series** is an ordered sequence of observations of a variable(s) (often) made at equally spaced time points. Time series data may have internal structures such as trends, seasonality, cycles etc. Such internal structural variation is largely absent in randomly collected data which are observed one-at-a-time (called cross-section data). Time series data analysis is useful in business and economic forecasting, stock market analysis, quality control etc. The objective of time series analysis is to understand the structure that generated the time-oriented data, fit a model, monitor and forecast if necessary.</span>
<span id="cb81-1429"><a href="#cb81-1429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1430"><a href="#cb81-1430" aria-hidden="true" tabindex="-1"></a>Consider the value of \$20 notes (in NZ\$ millions) that were in the hands of the New Zealand public (as at last the Wednesday in March each year) for the time period 1968 onward available at the Reserve Bank of New Zealand website <span class="ot">&lt;https://www.rbnz.govt.nz/statistics/f3&gt;</span>. @fig-nzd20ts shows the time series plot of the \$20 notes series.</span>
<span id="cb81-1431"><a href="#cb81-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1432"><a href="#cb81-1432" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb81-1433"><a href="#cb81-1433" aria-hidden="true" tabindex="-1"></a><span class="co"># library(readxl)</span></span>
<span id="cb81-1434"><a href="#cb81-1434" aria-hidden="true" tabindex="-1"></a><span class="co"># #url &lt;- "https://www.rbnz.govt.nz/-/media/ReserveBank/Files/Statistics/tables/f3/hf3.xlsx"</span></span>
<span id="cb81-1435"><a href="#cb81-1435" aria-hidden="true" tabindex="-1"></a><span class="co"># destfile &lt;- "hf3.xlsx"</span></span>
<span id="cb81-1436"><a href="#cb81-1436" aria-hidden="true" tabindex="-1"></a><span class="co">#curl::curl_download(url, destfile)</span></span>
<span id="cb81-1437"><a href="#cb81-1437" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1438"><a href="#cb81-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1441"><a href="#cb81-1441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1442"><a href="#cb81-1442" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb81-1443"><a href="#cb81-1443" aria-hidden="true" tabindex="-1"></a>notes20 <span class="ot">&lt;-</span> <span class="fu">read_table</span>(</span>
<span id="cb81-1444"><a href="#cb81-1444" aria-hidden="true" tabindex="-1"></a>  <span class="st">"http://www.massey.ac.nz/~anhsmith/data/20dollar.txt"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb81-1445"><a href="#cb81-1445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(value)</span>
<span id="cb81-1446"><a href="#cb81-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1447"><a href="#cb81-1447" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1448"><a href="#cb81-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1451"><a href="#cb81-1451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1452"><a href="#cb81-1452" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1453"><a href="#cb81-1453" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb81-1454"><a href="#cb81-1454" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nzd20ts</span></span>
<span id="cb81-1455"><a href="#cb81-1455" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Time series plot of the value of NZD 20 notes in public circulation in NZ'</span></span>
<span id="cb81-1456"><a href="#cb81-1456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1457"><a href="#cb81-1457" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb81-1458"><a href="#cb81-1458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1459"><a href="#cb81-1459" aria-hidden="true" tabindex="-1"></a>NZnotes20 <span class="ot">&lt;-</span> notes20 <span class="sc">/</span> <span class="dv">1000</span>  <span class="co"># converting to millions</span></span>
<span id="cb81-1460"><a href="#cb81-1460" aria-hidden="true" tabindex="-1"></a>NZnotes20 <span class="ot">&lt;-</span> <span class="fu">ts</span>(NZnotes20, <span class="at">start=</span><span class="dv">1968</span>, <span class="at">frequency=</span><span class="dv">1</span>)</span>
<span id="cb81-1461"><a href="#cb81-1461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1462"><a href="#cb81-1462" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(NZnotes20, </span>
<span id="cb81-1463"><a href="#cb81-1463" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">"Year"</span>, </span>
<span id="cb81-1464"><a href="#cb81-1464" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab=</span><span class="st">"Value of $20 notes (millions)"</span>)</span>
<span id="cb81-1465"><a href="#cb81-1465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1466"><a href="#cb81-1466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1467"><a href="#cb81-1467" aria-hidden="true" tabindex="-1"></a>It is easy to see the 'growth effect' of time on the value of \$20 notes held by the public. The amount of \$20 bills held by the public is affected by various known and unknown factors which are correlated with time. This allows us to conveniently treat 'time' as the single explanatory variable representing several other factors (variables). We also note other types of structural variations such as mild cycles (in addition to the exponential trend in the beginning and then settling in the recent years) that are time oriented in @fig-nzd20ts.</span>
<span id="cb81-1468"><a href="#cb81-1468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1469"><a href="#cb81-1469" aria-hidden="true" tabindex="-1"></a>In order to study seasonal variation, yearly series such as \$20 bills series are inadequate. We will be needing a series observed in shorter term such as daily, weekly or monthly. The monthly credit card balances in New Zealand is available at <span class="ot">&lt;https://www.rbnz.govt.nz/statistics/c12&gt;</span>. This series begins from Dec 2004. We import this data first in <span class="in">`R`</span> /<span class="in">`RStudio`</span> and consider the (daily average) outstanding credit card balances (in million \$).</span>
<span id="cb81-1470"><a href="#cb81-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1473"><a href="#cb81-1473" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1474"><a href="#cb81-1474" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb81-1475"><a href="#cb81-1475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1476"><a href="#cb81-1476" aria-hidden="true" tabindex="-1"></a><span class="co"># library(readxl)</span></span>
<span id="cb81-1477"><a href="#cb81-1477" aria-hidden="true" tabindex="-1"></a><span class="co"># url &lt;- "https://www.rbnz.govt.nz/-/media/ReserveBank/Files/Statistics/tables/c12/hc12-daily-average-balances.xlsx"</span></span>
<span id="cb81-1478"><a href="#cb81-1478" aria-hidden="true" tabindex="-1"></a><span class="co"># destfile &lt;- "hc12_daily_average_balances.xlsx"</span></span>
<span id="cb81-1479"><a href="#cb81-1479" aria-hidden="true" tabindex="-1"></a><span class="co"># curl::curl_download(url, destfile)</span></span>
<span id="cb81-1480"><a href="#cb81-1480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1481"><a href="#cb81-1481" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb81-1482"><a href="#cb81-1482" aria-hidden="true" tabindex="-1"></a><span class="co"># download.file(url = "http://www.massey.ac.nz/~anhsmith/data/hc12_daily_average_balances.xlsx", destfile = "hc12_daily_average_balances.xlsx")</span></span>
<span id="cb81-1483"><a href="#cb81-1483" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb81-1484"><a href="#cb81-1484" aria-hidden="true" tabindex="-1"></a><span class="co"># hc12b &lt;- read_xlsx(</span></span>
<span id="cb81-1485"><a href="#cb81-1485" aria-hidden="true" tabindex="-1"></a><span class="co">#   "hc12_daily_average_balances.xlsx", </span></span>
<span id="cb81-1486"><a href="#cb81-1486" aria-hidden="true" tabindex="-1"></a><span class="co">#   skip = 4</span></span>
<span id="cb81-1487"><a href="#cb81-1487" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb81-1488"><a href="#cb81-1488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1489"><a href="#cb81-1489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1490"><a href="#cb81-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1491"><a href="#cb81-1491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1494"><a href="#cb81-1494" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1495"><a href="#cb81-1495" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1496"><a href="#cb81-1496" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb81-1497"><a href="#cb81-1497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1498"><a href="#cb81-1498" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"http://www.massey.ac.nz/~anhsmith/data/hc12_daily_average_balances.xlsx"</span></span>
<span id="cb81-1499"><a href="#cb81-1499" aria-hidden="true" tabindex="-1"></a>destfile <span class="ot">&lt;-</span> <span class="st">"hc12.xlsx"</span></span>
<span id="cb81-1500"><a href="#cb81-1500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1501"><a href="#cb81-1501" aria-hidden="true" tabindex="-1"></a>curl<span class="sc">::</span><span class="fu">curl_download</span>(url, destfile)</span>
<span id="cb81-1502"><a href="#cb81-1502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1503"><a href="#cb81-1503" aria-hidden="true" tabindex="-1"></a>hc12b <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(destfile, <span class="at">na =</span> <span class="st">"-"</span>, <span class="at">skip =</span> <span class="dv">4</span>)</span>
<span id="cb81-1504"><a href="#cb81-1504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1505"><a href="#cb81-1505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1506"><a href="#cb81-1506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1507"><a href="#cb81-1507" aria-hidden="true" tabindex="-1"></a>The time series plot of the outstanding credit card balances series is shown in @fig-float. This series shows strong trends as well as seasonality. In the next section, we will discuss how to assess the features of a time series further.</span>
<span id="cb81-1508"><a href="#cb81-1508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1511"><a href="#cb81-1511" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1512"><a href="#cb81-1512" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1513"><a href="#cb81-1513" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-float</span></span>
<span id="cb81-1514"><a href="#cb81-1514" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Time series plot of  outstanding credit card balances'</span></span>
<span id="cb81-1515"><a href="#cb81-1515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1516"><a href="#cb81-1516" aria-hidden="true" tabindex="-1"></a>credit.balance <span class="ot">&lt;-</span> hc12b <span class="sc">|&gt;</span> </span>
<span id="cb81-1517"><a href="#cb81-1517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(CRCD.MOA20) <span class="sc">|&gt;</span> </span>
<span id="cb81-1518"><a href="#cb81-1518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> </span>
<span id="cb81-1519"><a href="#cb81-1519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">start=</span><span class="fu">c</span>(<span class="dv">2000</span>,<span class="dv">7</span>), <span class="at">frequency=</span><span class="dv">12</span>)</span>
<span id="cb81-1520"><a href="#cb81-1520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1521"><a href="#cb81-1521" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">autoplot</span>(credit.balance, <span class="at">xlab=</span><span class="st">"Year"</span>, <span class="at">ylab=</span><span class="st">"Rate"</span>)</span>
<span id="cb81-1522"><a href="#cb81-1522" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1523"><a href="#cb81-1523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1524"><a href="#cb81-1524" aria-hidden="true" tabindex="-1"></a><span class="fu">## Autocorrelation</span></span>
<span id="cb81-1525"><a href="#cb81-1525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1526"><a href="#cb81-1526" aria-hidden="true" tabindex="-1"></a>Time series data are not often independent and there often exists a relationship between the current observation $X_t$ at time $t$ with the past observations $X_j$ $(j=t-1, t-2, \ldots, 1)$. The term *first order lag* refers to $X_{j-1}$ for $X_j$. In general the $k^\text {th}$ lag refers to a past observation of $k$ periods back. We may explore the time related linear dependency in time series data using lagplots. @fig-lplt is a lag plot for the NZ \$20 series.</span>
<span id="cb81-1527"><a href="#cb81-1527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1530"><a href="#cb81-1530" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1531"><a href="#cb81-1531" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1532"><a href="#cb81-1532" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-lplt</span></span>
<span id="cb81-1533"><a href="#cb81-1533" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Lag plot of NZD 20 notes series'</span></span>
<span id="cb81-1534"><a href="#cb81-1534" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb81-1535"><a href="#cb81-1535" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb81-1536"><a href="#cb81-1536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1537"><a href="#cb81-1537" aria-hidden="true" tabindex="-1"></a><span class="fu">gglagplot</span>(NZnotes20)</span>
<span id="cb81-1538"><a href="#cb81-1538" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1539"><a href="#cb81-1539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1540"><a href="#cb81-1540" aria-hidden="true" tabindex="-1"></a>This plot suggests that the time related dependency is rather strong for lower order $k$ but the lag effect diminishes when $k$ becomes large . This is a good thing because we can use recent lagged data as predictors in our models.</span>
<span id="cb81-1541"><a href="#cb81-1541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1542"><a href="#cb81-1542" aria-hidden="true" tabindex="-1"></a>By the term *autocorrelation* we mean the simple correlation between the observations but lagged back one or more time periods. For a given lag $k$, the **sample autocorrelation function** (SACF or simply **ACF**) is defined as</span>
<span id="cb81-1543"><a href="#cb81-1543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1544"><a href="#cb81-1544" aria-hidden="true" tabindex="-1"></a>$$r_{k} = \frac{ \sum \limits_{t=k+1}^N (y_{t}-\bar{y})(y_{t-k}-\bar{y})} {\sum \limits_{t=1}^T (y_{t}-\bar{y})^2}$$</span>
<span id="cb81-1545"><a href="#cb81-1545" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1546"><a href="#cb81-1546" aria-hidden="true" tabindex="-1"></a>  where $N$ is the length of the time series. SACFs can be used to make a tentative assessment of the terms or order of the model. @fig-acfplt is the plot of SACF values (called ACF plot or correlogram) for the NZ \$20 series.</span>
<span id="cb81-1547"><a href="#cb81-1547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1550"><a href="#cb81-1550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1551"><a href="#cb81-1551" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1552"><a href="#cb81-1552" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-acfplt</span></span>
<span id="cb81-1553"><a href="#cb81-1553" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'ACF plot of NZD 20 notes series'</span></span>
<span id="cb81-1554"><a href="#cb81-1554" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(NZnotes20)</span>
<span id="cb81-1555"><a href="#cb81-1555" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1556"><a href="#cb81-1556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1557"><a href="#cb81-1557" aria-hidden="true" tabindex="-1"></a>This graph shows that the autocorrelations decay to zero (implying that the value of \$20 notes in public hands positively depend on the values of \$20 notes held in the immediate past rather than the distant past). The significance of autocorrelations may be judged from the **95% confidence interval band**. More on this later.</span>
<span id="cb81-1558"><a href="#cb81-1558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1559"><a href="#cb81-1559" aria-hidden="true" tabindex="-1"></a>We also plot the partial autocorrelations instead of autocorrelations. Partial Autocorrelation Function (PACF) at a given time is without the linear effect of other lags. @fig-pacfplt shows the PACF plot for the '\$20 Notes' series. Only the first PACF is significant and not the rest. This means that the first lag is sufficient and the rest may not be needed for modelling.</span>
<span id="cb81-1560"><a href="#cb81-1560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1563"><a href="#cb81-1563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1564"><a href="#cb81-1564" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1565"><a href="#cb81-1565" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pacfplt</span></span>
<span id="cb81-1566"><a href="#cb81-1566" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'PACF plot of NZD 20 notes series'</span></span>
<span id="cb81-1567"><a href="#cb81-1567" aria-hidden="true" tabindex="-1"></a><span class="fu">ggPacf</span>(NZnotes20)</span>
<span id="cb81-1568"><a href="#cb81-1568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1569"><a href="#cb81-1569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1570"><a href="#cb81-1570" aria-hidden="true" tabindex="-1"></a>Both ACF and PACF plots are useful to assess the time series components which is discussed next.</span>
<span id="cb81-1571"><a href="#cb81-1571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1572"><a href="#cb81-1572" aria-hidden="true" tabindex="-1"></a><span class="fu">## Time Series Components of Variation</span></span>
<span id="cb81-1573"><a href="#cb81-1573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1574"><a href="#cb81-1574" aria-hidden="true" tabindex="-1"></a>The nature of structural variations in a time series are broadly classified under three major headings:</span>
<span id="cb81-1575"><a href="#cb81-1575" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1576"><a href="#cb81-1576" aria-hidden="true" tabindex="-1"></a><span class="fu">### Trend</span></span>
<span id="cb81-1577"><a href="#cb81-1577" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1578"><a href="#cb81-1578" aria-hidden="true" tabindex="-1"></a>The trend component is to represent long term positive (upward) or negative (downward) movement. See @fig-trendtype below which lists some of the parametric models for fitting the trend component:</span>
<span id="cb81-1579"><a href="#cb81-1579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1580"><a href="#cb81-1580" aria-hidden="true" tabindex="-1"></a><span class="al">![Trend types](images/8-2.png)</span>{#fig-trendtype}</span>
<span id="cb81-1581"><a href="#cb81-1581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1582"><a href="#cb81-1582" aria-hidden="true" tabindex="-1"></a>We will cover more on fitting models to capture the trend later on.</span>
<span id="cb81-1583"><a href="#cb81-1583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1584"><a href="#cb81-1584" aria-hidden="true" tabindex="-1"></a><span class="fu">### Seasonal</span></span>
<span id="cb81-1585"><a href="#cb81-1585" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1586"><a href="#cb81-1586" aria-hidden="true" tabindex="-1"></a>The seasonal component is to account for the periodic behaviour happening *within* a block (say Christmas time) of a given time period (say in a calendar year) but this periodic behaviour will repeat fairly regularly over time (say year after year). Seasonality is often present in business related time series data. EDA tools are useful for judging the presence of seasonality. A simple scatterplot of the response variable against time may reveal seasonality directly. @fig-uvplot is a time series plot of monthly means of Erythemal UV, the sunburn causing UV, measured at Lauder (45.0S, 169.7E), New Zealand (**uv.txt**).</span>
<span id="cb81-1587"><a href="#cb81-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1590"><a href="#cb81-1590" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1591"><a href="#cb81-1591" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1592"><a href="#cb81-1592" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb81-1593"><a href="#cb81-1593" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-uvplot</span></span>
<span id="cb81-1594"><a href="#cb81-1594" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Time series plot revealing seasonality'</span></span>
<span id="cb81-1595"><a href="#cb81-1595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1596"><a href="#cb81-1596" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb81-1597"><a href="#cb81-1597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1598"><a href="#cb81-1598" aria-hidden="true" tabindex="-1"></a>uv <span class="ot">&lt;-</span> <span class="fu">read_table</span>(<span class="st">"http://www.massey.ac.nz/~anhsmith/data/uv.txt"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb81-1599"><a href="#cb81-1599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(erythemal.uv) <span class="sc">|&gt;</span> </span>
<span id="cb81-1600"><a href="#cb81-1600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1990</span>, <span class="dv">01</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb81-1601"><a href="#cb81-1601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1602"><a href="#cb81-1602" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">autoplot</span>(uv, <span class="at">xlab=</span><span class="st">"Year"</span>, <span class="at">ylab=</span><span class="st">"Erythemal UV"</span>)</span>
<span id="cb81-1603"><a href="#cb81-1603" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1604"><a href="#cb81-1604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1605"><a href="#cb81-1605" aria-hidden="true" tabindex="-1"></a>Seasonality is more easily seen graphically when two or more grouping variables such as month is used to subset the data as has been done in @fig-uvmon. All tools of EDA covered in this Chapter such as boxplots etc will also be useful to explore seasonal effects. The autocorrelation plot is also useful for detecting seasonality.</span>
<span id="cb81-1606"><a href="#cb81-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1609"><a href="#cb81-1609" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1610"><a href="#cb81-1610" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1611"><a href="#cb81-1611" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-uvmon</span></span>
<span id="cb81-1612"><a href="#cb81-1612" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Month plot revealing seasonality'</span></span>
<span id="cb81-1613"><a href="#cb81-1613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1614"><a href="#cb81-1614" aria-hidden="true" tabindex="-1"></a><span class="co"># monthplot(uv) or</span></span>
<span id="cb81-1615"><a href="#cb81-1615" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsubseriesplot</span>(uv)</span>
<span id="cb81-1616"><a href="#cb81-1616" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1617"><a href="#cb81-1617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1618"><a href="#cb81-1618" aria-hidden="true" tabindex="-1"></a>A different version of the plot, known as season plot, can also be used; see @fig-sesplt drawn for the credit balances data. This plot shows the month related seasonal effects over the years. We can also assess whether the seasonal effect is the same for various years or not using this plot.</span>
<span id="cb81-1619"><a href="#cb81-1619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1622"><a href="#cb81-1622" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1623"><a href="#cb81-1623" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1624"><a href="#cb81-1624" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-sesplt</span></span>
<span id="cb81-1625"><a href="#cb81-1625" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Seasonal plot for credit balances series'</span></span>
<span id="cb81-1626"><a href="#cb81-1626" aria-hidden="true" tabindex="-1"></a><span class="fu">ggseasonplot</span>(credit.balance, <span class="at">year.labels=</span><span class="cn">TRUE</span>)</span>
<span id="cb81-1627"><a href="#cb81-1627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1628"><a href="#cb81-1628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1629"><a href="#cb81-1629" aria-hidden="true" tabindex="-1"></a>The ACF plot is also useful to assess seasonality. @fig-uvacfplt shows a scallop pattern which is attributed to seasonality.</span>
<span id="cb81-1630"><a href="#cb81-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1633"><a href="#cb81-1633" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1634"><a href="#cb81-1634" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1635"><a href="#cb81-1635" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-uvacfplt</span></span>
<span id="cb81-1636"><a href="#cb81-1636" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'ACF plot of uv series'</span></span>
<span id="cb81-1637"><a href="#cb81-1637" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(uv)</span>
<span id="cb81-1638"><a href="#cb81-1638" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1639"><a href="#cb81-1639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1640"><a href="#cb81-1640" aria-hidden="true" tabindex="-1"></a><span class="in">`Spectral plot`</span> is another graphical technique for examining cyclic structure of variation in time series data. This plot is based on a sinusoidal model. The cycle frequency is expressed per unit of time where a unit of time is the distance between 2 time series points. A frequency of 0.5 means a cycle of 2 time series data points. Methods are available to determine the amplitude and the dominant frequency etc under the sinusoidal model.</span>
<span id="cb81-1641"><a href="#cb81-1641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1642"><a href="#cb81-1642" aria-hidden="true" tabindex="-1"></a><span class="fu">### Error</span></span>
<span id="cb81-1643"><a href="#cb81-1643" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1644"><a href="#cb81-1644" aria-hidden="true" tabindex="-1"></a>  This component of the time series is to account for the random or irregular movement in the series. Ideally the plot of errors should not show any time effect; for example plotting a set of random normal data will not show any of the systematic time related components, see @fig-whtnoise. Such a series is called a <span class="in">`white noise`</span> series.</span>
<span id="cb81-1645"><a href="#cb81-1645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1648"><a href="#cb81-1648" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1649"><a href="#cb81-1649" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1650"><a href="#cb81-1650" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-whtnoise</span></span>
<span id="cb81-1651"><a href="#cb81-1651" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Time series plot of random normal data'</span></span>
<span id="cb81-1652"><a href="#cb81-1652" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb81-1653"><a href="#cb81-1653" aria-hidden="true" tabindex="-1"></a>whtnoise <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">rnorm</span>(<span class="dv">120</span>), <span class="at">start=</span><span class="dv">1</span>, <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb81-1654"><a href="#cb81-1654" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">autoplot</span>(whtnoise, </span>
<span id="cb81-1655"><a href="#cb81-1655" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xlab=</span><span class="st">"time"</span>, </span>
<span id="cb81-1656"><a href="#cb81-1656" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ylab=</span><span class="st">"N(0,1) random data"</span>)</span>
<span id="cb81-1657"><a href="#cb81-1657" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1658"><a href="#cb81-1658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1659"><a href="#cb81-1659" aria-hidden="true" tabindex="-1"></a>The ACF plot of our white noise series is shown in @fig-acwhtnoise. As you would expected, the ACFs are small in size and not significant. The ACFs also do not die out in any systematic pattern too.</span>
<span id="cb81-1660"><a href="#cb81-1660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1663"><a href="#cb81-1663" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1664"><a href="#cb81-1664" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1665"><a href="#cb81-1665" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-acwhtnoise</span></span>
<span id="cb81-1666"><a href="#cb81-1666" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'ACF plot of random normal data'</span></span>
<span id="cb81-1667"><a href="#cb81-1667" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(whtnoise)</span>
<span id="cb81-1668"><a href="#cb81-1668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1669"><a href="#cb81-1669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1670"><a href="#cb81-1670" aria-hidden="true" tabindex="-1"></a>It is the practice to assume a typical structural interrelationship between the trend, seasonal or cyclical components of a time series. This may be done using an **additive model** for the observation at time $t$ say $X_t$ as</span>
<span id="cb81-1671"><a href="#cb81-1671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1672"><a href="#cb81-1672" aria-hidden="true" tabindex="-1"></a>$X_t$ = **Trend + Seasonal + Error**</span>
<span id="cb81-1673"><a href="#cb81-1673" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1674"><a href="#cb81-1674" aria-hidden="true" tabindex="-1"></a>  or, using the multiplicative model,</span>
<span id="cb81-1675"><a href="#cb81-1675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1676"><a href="#cb81-1676" aria-hidden="true" tabindex="-1"></a>$X_t$ = Trend $\times$ Seasonal + Error.</span>
<span id="cb81-1677"><a href="#cb81-1677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1678"><a href="#cb81-1678" aria-hidden="true" tabindex="-1"></a>The **multiplicative model** takes the interaction between the components into account whereas the additive model assumes independence of the components. We have not explicitly considered the cyclical component of variation in the models and assume that the either the trend or the seasonal part of the model will include it.</span>
<span id="cb81-1679"><a href="#cb81-1679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1680"><a href="#cb81-1680" aria-hidden="true" tabindex="-1"></a>Consider the UV series, which is a short time series. Hence this series may not reveal secular (long term) trend or cycles. @fig-clasdecomp shows the decomposition done for the UV series. While this plot is useful in revealing the seasonality, trend component is probably over-fitted.</span>
<span id="cb81-1681"><a href="#cb81-1681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1682"><a href="#cb81-1682" aria-hidden="true" tabindex="-1"></a>The associated standard error bars also appear on the RHS side of the plot and the trend estimation is done poorly after all.</span>
<span id="cb81-1683"><a href="#cb81-1683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1686"><a href="#cb81-1686" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1687"><a href="#cb81-1687" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1688"><a href="#cb81-1688" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-clasdecomp</span></span>
<span id="cb81-1689"><a href="#cb81-1689" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Classical decomposition for UV data'</span></span>
<span id="cb81-1690"><a href="#cb81-1690" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb81-1691"><a href="#cb81-1691" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb81-1692"><a href="#cb81-1692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1693"><a href="#cb81-1693" aria-hidden="true" tabindex="-1"></a>uv <span class="sc">|&gt;</span> </span>
<span id="cb81-1694"><a href="#cb81-1694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">decompose</span>(<span class="at">type=</span><span class="st">"additive"</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb81-1695"><a href="#cb81-1695" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">autoplot</span>() <span class="sc">+</span> </span>
<span id="cb81-1696"><a href="#cb81-1696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>)</span>
<span id="cb81-1697"><a href="#cb81-1697" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1698"><a href="#cb81-1698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1699"><a href="#cb81-1699" aria-hidden="true" tabindex="-1"></a>The classical decomposition done for the credit card balances data is shown in @fig-clasdecomp1. For this series, the trend component is strong and estimated well. The seasonal component is weaker and not estimated well at all.</span>
<span id="cb81-1700"><a href="#cb81-1700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1703"><a href="#cb81-1703" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1704"><a href="#cb81-1704" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb81-1705"><a href="#cb81-1705" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-clasdecomp1</span></span>
<span id="cb81-1706"><a href="#cb81-1706" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Classical decomposition for credit data'</span></span>
<span id="cb81-1707"><a href="#cb81-1707" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb81-1708"><a href="#cb81-1708" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb81-1709"><a href="#cb81-1709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1710"><a href="#cb81-1710" aria-hidden="true" tabindex="-1"></a>credit.balance <span class="sc">|&gt;</span> </span>
<span id="cb81-1711"><a href="#cb81-1711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">decompose</span>(<span class="at">type=</span><span class="st">"additive"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb81-1712"><a href="#cb81-1712" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">autoplot</span>() <span class="sc">+</span> </span>
<span id="cb81-1713"><a href="#cb81-1713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>)</span>
<span id="cb81-1714"><a href="#cb81-1714" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1715"><a href="#cb81-1715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1716"><a href="#cb81-1716" aria-hidden="true" tabindex="-1"></a>There are many approaches to decomposing the components of a time series. Some are designed to improve forecasting. These methods are covered in higher level statistics courses.</span>
<span id="cb81-1717"><a href="#cb81-1717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1718"><a href="#cb81-1718" aria-hidden="true" tabindex="-1"></a>By the term *detrending*, we mean the process of removing the trend from a time series. This can be model based. For example, we may fit a S-type logistic model and the residuals of this model is called the detrended series, which mainly contains the seasonal and error components of variation. The other approach to detrending is to apply differencing which is discussed later on. There are also nonparametric approaches to fitting trends. For example, the moving average smoothing (discussed in a later Chapter) can be treated as fit (filter) and the residuals after smoothing can be regarded as detrended data.</span>
<span id="cb81-1719"><a href="#cb81-1719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1720"><a href="#cb81-1720" aria-hidden="true" tabindex="-1"></a>By the term *deseasoning* we mean the process of removing the seasonal component of the variation in a time series. For example, we may use a regression approach to deseason the series after fitting the model with seasonal indicator variables. We may also use seasonal differencing or use trigonometric functions for deseasoning.</span>
<span id="cb81-1721"><a href="#cb81-1721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1722"><a href="#cb81-1722" aria-hidden="true" tabindex="-1"></a>It is not always easy to completely separate trends from seasonal effect but time series decomposition helps us to understand the underlying complexities.</span>
<span id="cb81-1723"><a href="#cb81-1723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1724"><a href="#cb81-1724" aria-hidden="true" tabindex="-1"></a><span class="in">`R`</span> packages are available for exploring spatial data, particularly for integrating with maps. Some software programs also employ audio to augment exploration of higher dimensional data. Plots for EDA are introduced at an introductory level in this Chapter but there are many dedicated <span class="in">`R`</span> packages available for conducting EDA in a specialised area such as finance or ecology.</span>
<span id="cb81-1725"><a href="#cb81-1725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1726"><a href="#cb81-1726" aria-hidden="true" tabindex="-1"></a><span class="fu"># Summary</span></span>
<span id="cb81-1727"><a href="#cb81-1727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1728"><a href="#cb81-1728" aria-hidden="true" tabindex="-1"></a>The first step in EDA is to familiarise oneself with the data. The dataset should be checked for errors. This is particularly important if this is to be the first time the data will be analysed. It is essential to know story behind the data such as the objectives for the collection of the data, and in what way was it collected etc. The answers to these questions should provide the focus for our own analysis of the data; i.e. what questions do we want to be able answer by our analysis of the data. Note that data may not always contain an answer to the questions we may have.</span>
<span id="cb81-1729"><a href="#cb81-1729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1730"><a href="#cb81-1730" aria-hidden="true" tabindex="-1"></a>Our exploratory analysis now proceeds by attempting to understand the structure and peculiarities of the dataset. In particular, we may be interested in: numerical summaries or tabular display that present an overall summary of the data; graphical displays that describe the distribution of variables; graphical comparisons of different groups in the data; scatterplots or scatterplot matrices that reveal trends or relationships and other patterns between variables; and any interesting or outlying points in the data. The main thing in choosing graphics is that they should be simple and informative -not saying too much or too little, and not misleading. You should be able to say something meaningful on the basis of each graph.</span>
<span id="cb81-1731"><a href="#cb81-1731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1732"><a href="#cb81-1732" aria-hidden="true" tabindex="-1"></a>Based on the EDA evidence, one or more candidate statistical models are fitted. These models are further improved or validated. After the analysis is complete, we need to be able to communicate our findings, clearly, accurately, effectively, and honestly, to any interested audience.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>